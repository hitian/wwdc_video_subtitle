1
00:00:17,618 --> 00:00:20,754
<c.magenta>（StoreKit新特性）</c>

2
00:00:20,954 --> 00:00:21,788
<c.magenta>大家早上好</c>

3
00:00:27,160 --> 00:00:28,762
<c.magenta>欢迎来参加</c>

4
00:00:29,162 --> 00:00:32,432
<c.magenta>我叫Pete Hare 我是Apple App Store</c>

5
00:00:33,800 --> 00:00:37,037
<c.magenta>程序内购买代表了收入的一大部分</c>

6
00:00:37,104 --> 00:00:38,572
<c.magenta>也就是由App Store中的</c>

7
00:00:38,639 --> 00:00:42,142
<c.magenta>为了实现程序内购买</c>

8
00:00:42,209 --> 00:00:44,211
<c.magenta>在这过程中</c>

9
00:00:44,278 --> 00:00:47,514
<c.magenta>对你和你的生意来说变得越来越重要了</c>

10
00:00:48,382 --> 00:00:50,350
<c.magenta>我们在研究</c>

11
00:00:50,417 --> 00:00:51,618
<c.magenta>以更加高效的方式</c>

12
00:00:51,818 --> 00:00:53,120
<c.magenta>我们今天会向你们介绍</c>

13
00:00:53,187 --> 00:00:55,222
<c.magenta>一些关于StoreKit框架的改进</c>

14
00:00:55,756 --> 00:00:58,125
<c.magenta>StoreKit就是用来</c>

15
00:00:58,192 --> 00:01:00,527
<c.magenta>它还可以实现其他一些</c>

16
00:00:58,192 --> 00:01:00,527
<c.magenta>它还可以实现其他一些</c>

17
00:01:00,827 --> 00:01:02,729
<c.magenta>我们还在iOS 11中</c>

18
00:01:03,730 --> 00:01:05,165
<c.magenta>首先 你现在可以</c>

19
00:01:05,232 --> 00:01:08,268
<c.magenta>可以直接在App Store应用中</c>

20
00:01:08,602 --> 00:01:12,472
<c.magenta>用户可以购买程序内购买</c>

21
00:01:13,740 --> 00:01:16,643
<c.magenta>其次 我们会介绍一些关于订阅的改进</c>

22
00:01:16,743 --> 00:01:18,145
<c.magenta>自动续订流</c>

23
00:01:18,378 --> 00:01:21,014
<c.magenta>我们有了新的服务器用于订阅通知</c>

24
00:01:21,281 --> 00:01:22,649
<c.magenta>这会让你轻松许多</c>

25
00:01:22,716 --> 00:01:25,052
<c.magenta>如果你要处理自动续订的话</c>

26
00:01:29,056 --> 00:01:32,159
<c.magenta>我们还会介绍一些</c>

27
00:01:32,326 --> 00:01:33,827
<c.magenta>当你在进行服务端管理的时候</c>

28
00:01:33,894 --> 00:01:35,495
<c.magenta>这会让你们有更深刻的见解</c>

29
00:01:35,562 --> 00:01:36,797
<c.magenta>对于某些商业问题</c>

30
00:01:36,864 --> 00:01:39,533
<c.magenta>像是个体用户以及他们的订阅状态</c>

31
00:01:40,934 --> 00:01:42,069
<c.magenta>我们在今年早些时候还引入了</c>

32
00:01:42,135 --> 00:01:45,072
<c.magenta>可以让你回复</c>

33
00:01:45,639 --> 00:01:47,407
<c.magenta>除此之外 我们还有些新的改进</c>

34
00:01:47,541 --> 00:01:49,776
<c.magenta>是关于你请求评分和评论的</c>

35
00:01:50,878 --> 00:01:52,846
<c.magenta>在我们介绍这些新功能之前</c>

36
00:01:53,013 --> 00:01:56,216
<c.magenta>我想先概述一下程序内购买的整个流程</c>

37
00:01:56,283 --> 00:01:59,086
<c.magenta>让我们看下</c>

38
00:02:01,355 --> 00:02:03,090
<c.magenta>程序内购买没有太多的变化</c>

39
00:02:03,156 --> 00:02:04,725
<c.magenta>它们在iOS 3中出现</c>

40
00:02:05,392 --> 00:02:08,529
<c.magenta>程序内购买可以让你售卖数字内容</c>

41
00:02:08,595 --> 00:02:10,030
<c.magenta>或者是你应用中的某个服务</c>

42
00:02:10,731 --> 00:02:12,766
<c.magenta>当提到实物的产品或是服务时</c>

43
00:02:12,966 --> 00:02:14,601
<c.magenta>那就不是太适合用程序内购买</c>

44
00:02:14,668 --> 00:02:16,170
<c.magenta>我们提供像是</c>

45
00:02:16,336 --> 00:02:18,005
<c.magenta>你也可以实现自己的支付系统</c>

46
00:02:18,071 --> 00:02:19,940
<c.magenta>来实现出售实物产品</c>

47
00:02:20,073 --> 00:02:23,210
<c.magenta>但是提到数字业务的时候</c>

48
00:02:24,945 --> 00:02:27,614
<c.magenta>你可以使用四种不同类型的程序内购买</c>

49
00:02:28,615 --> 00:02:30,384
<c.magenta>首先 我们有可消耗的产品</c>

50
00:02:30,817 --> 00:02:31,818
<c.magenta>这类程序内购买</c>

51
00:02:31,885 --> 00:02:34,087
<c.magenta>就是可以被消耗的程序内购买</c>

52
00:02:34,154 --> 00:02:36,290
<c.magenta>顾名思义 并且可以被用户用尽</c>

53
00:02:36,356 --> 00:02:40,694
<c.magenta>这可能是某个游戏中的金币</c>

54
00:02:40,894 --> 00:02:44,198
<c.magenta>它在后续的购买恢复</c>

55
00:02:45,199 --> 00:02:48,068
<c.magenta>第二类是不可消耗的产品</c>

56
00:02:49,536 --> 00:02:50,871
<c.magenta>它和可消耗的产品有点不同</c>

57
00:02:50,938 --> 00:02:52,039
<c.magenta>就在于它是可保留的</c>

58
00:02:52,105 --> 00:02:54,374
<c.magenta>它可能更适合像是</c>

59
00:02:54,441 --> 00:02:56,243
<c.magenta>解锁你应用的专业功能</c>

60
00:02:56,310 --> 00:02:58,779
<c.magenta>或是下载某个游戏的关卡包</c>

61
00:03:00,547 --> 00:03:02,816
<c.magenta>我们还提供了两种不同类别的订阅产品</c>

62
00:03:02,883 --> 00:03:05,352
<c.magenta>我们有非续订的订阅</c>

63
00:03:06,019 --> 00:03:06,920
<c.magenta>顾名思义</c>

64
00:03:06,987 --> 00:03:08,255
<c.magenta>这类订阅产品</c>

65
00:03:08,322 --> 00:03:11,558
<c.magenta>不会在账单周期结束的时候</c>

66
00:03:11,692 --> 00:03:12,659
<c.magenta>你可以把这类产品看成是</c>

67
00:03:12,726 --> 00:03:15,529
<c.magenta>某个有过期时间的可消耗产品</c>

68
00:03:16,630 --> 00:03:19,366
<c.magenta>最后一类就是可自动续订的订阅</c>

69
00:03:20,133 --> 00:03:23,170
<c.magenta>去年我们将可自动续订的</c>

70
00:03:23,237 --> 00:03:25,539
<c.magenta>更广的范畴</c>

71
00:03:25,606 --> 00:03:26,907
<c.magenta>且我们已看到一些很棒的应用了</c>

72
00:03:27,841 --> 00:03:30,878
<c.magenta>在本次演讲中</c>

73
00:03:30,944 --> 00:03:32,713
<c.magenta>绝大部分是可消耗的和不可消耗的</c>

74
00:03:32,946 --> 00:03:35,449
<c.magenta>我们会更详细地介绍订阅</c>

75
00:03:35,516 --> 00:03:37,184
<c.magenta>在今天下午的高级演讲中</c>

76
00:03:37,351 --> 00:03:39,720
<c.magenta>它会于下午1:50</c>

77
00:03:39,786 --> 00:03:41,288
<c.magenta>所以如果你要处理订阅</c>

78
00:03:41,355 --> 00:03:43,056
<c.magenta>在特定的服务端环境的话</c>

79
00:03:43,123 --> 00:03:44,691
<c.magenta>我强烈建议你去参加那场演讲</c>

80
00:03:44,758 --> 00:03:46,693
<c.magenta>我们会在那介绍一些很棒的新改进</c>

81
00:03:48,095 --> 00:03:51,064
<c.magenta>让我们看下如何在你的应用中</c>

82
00:03:51,932 --> 00:03:55,903
<c.magenta>它会从加载你应用中的</c>

83
00:03:56,303 --> 00:03:58,305
<c.magenta>我们一会儿会介绍各步的更多细节</c>

84
00:03:58,372 --> 00:03:59,573
<c.magenta>但现在我就是给你们做个大体介绍</c>

85
00:04:01,008 --> 00:04:02,209
<c.magenta>使用这些程序内购买标识符</c>

86
00:04:02,276 --> 00:04:05,078
<c.magenta>你就从App Store</c>

87
00:04:05,679 --> 00:04:08,482
<c.magenta>在你获取了产品的本地化信息之后</c>

88
00:04:08,916 --> 00:04:11,285
<c.magenta>你就可以将程序内购买的</c>

89
00:04:12,085 --> 00:04:15,889
<c.magenta>这就可以让用户点击购买按钮</c>

90
00:04:16,190 --> 00:04:18,825
<c.magenta>然后就取决于你什么时候</c>

91
00:04:20,560 --> 00:04:24,264
<c.magenta>然后用户就可以选择</c>

92
00:04:24,831 --> 00:04:28,068
<c.magenta>然后就由你来处理</c>

93
00:04:29,903 --> 00:04:33,207
<c.magenta>在交易被处理后</c>

94
00:04:33,273 --> 00:04:35,342
<c.magenta>让用户可用这个程序内购买</c>

95
00:04:36,343 --> 00:04:39,079
<c.magenta>最后一步就是要结束交易</c>

96
00:04:40,113 --> 00:04:43,417
<c.magenta>让我们开始介绍第一步</c>

97
00:04:46,019 --> 00:04:48,655
<c.magenta>程序内购买标识符其实就是些产品信息</c>

98
00:04:48,722 --> 00:04:50,357
<c.magenta>也就是你在iTunes Connect中</c>

99
00:04:50,524 --> 00:04:52,593
<c.magenta>每个你卖的产品都有一个自己的标识符</c>

100
00:04:53,227 --> 00:04:54,828
<c.magenta>当提到将其加载到应用中时</c>

101
00:04:54,895 --> 00:04:56,163
<c.magenta>你可以通过几种方式实现</c>

102
00:04:56,230 --> 00:04:59,166
<c.magenta>首先 你可以直接将它们</c>

103
00:04:59,366 --> 00:05:01,368
<c.magenta>在这里 我有一个字符串数组</c>

104
00:04:59,366 --> 00:05:01,368
<c.magenta>在这里 我有一个字符串数组</c>

105
00:05:02,336 --> 00:05:05,305
<c.magenta>或者 当然了</c>

106
00:05:07,441 --> 00:05:08,842
<c.magenta>这些技术都可以使用</c>

107
00:05:08,909 --> 00:05:11,311
<c.magenta>但重要的是 你只有这个字符串集</c>

108
00:05:11,378 --> 00:05:13,881
<c.magenta>你只能使用这些程序内购买标识符</c>

109
00:05:13,947 --> 00:05:15,582
<c.magenta>来获取产品信息</c>

110
00:05:16,283 --> 00:05:17,251
<c.magenta>也就是下一步要做的</c>

111
00:05:19,052 --> 00:05:20,153
<c.magenta>如果你有了这些信息</c>

112
00:05:21,054 --> 00:05:23,690
<c.magenta>要加载产品的信息就很简单了</c>

113
00:05:23,757 --> 00:05:24,791
<c.magenta>让我们看看它的代码</c>

114
00:05:26,627 --> 00:05:28,595
<c.magenta>你获取了标识符集后</c>

115
00:05:28,762 --> 00:05:31,732
<c.magenta>你要将其传给</c>

116
00:05:32,733 --> 00:05:34,801
<c.magenta>为该请求设置一个代理</c>

117
00:05:34,968 --> 00:05:36,737
<c.magenta>然后使用这个开始方法来启动</c>

118
00:05:38,372 --> 00:05:40,707
<c.magenta>现在你已经在它上面</c>

119
00:05:40,774 --> 00:05:43,644
<c.magenta>所以你会在didReceiveResponse</c>

120
00:05:45,512 --> 00:05:48,148
<c.magenta>在这个回调函数中</c>

121
00:05:48,215 --> 00:05:51,818
<c.magenta>这个数组会与你所发送请求的</c>

122
00:05:52,519 --> 00:05:53,587
<c.magenta>现在你可以循环遍历这些产品</c>

123
00:05:53,654 --> 00:05:55,122
<c.magenta>我们会着重标出某些区域</c>

124
00:05:55,189 --> 00:05:57,758
<c.magenta>这些区域是包含于产品对象中的</c>

125
00:05:57,824 --> 00:06:01,195
<c.magenta>这里有该产品的本地化标题</c>

126
00:05:57,824 --> 00:06:01,195
<c.magenta>这里有该产品的本地化标题</c>

127
00:06:02,296 --> 00:06:05,799
<c.magenta>这还有关于商店中产品的</c>

128
00:06:05,866 --> 00:06:07,100
<c.magenta>也就是用户登录后得到的</c>

129
00:06:08,902 --> 00:06:11,338
<c.magenta>我们还有关于可下载内容的信息</c>

130
00:06:11,405 --> 00:06:13,373
<c.magenta>也就是可能和这个产品有关的信息</c>

131
00:06:15,242 --> 00:06:17,311
<c.magenta>而在这里更重要的一点 我要强调一下</c>

132
00:06:17,377 --> 00:06:20,247
<c.magenta>就是不应该将这时候返回的</c>

133
00:06:21,748 --> 00:06:23,984
<c.magenta>重要的是你要获得最新的产品信息</c>

134
00:06:24,084 --> 00:06:25,786
<c.magenta>通过定期执行这些请求</c>

135
00:06:25,986 --> 00:06:27,788
<c.magenta>因为像是汇率这些东西可能会波动</c>

136
00:06:27,921 --> 00:06:30,424
<c.magenta>用户可能会注销</c>

137
00:06:30,490 --> 00:06:31,758
<c.magenta>所以本地商店可能会变化</c>

138
00:06:31,859 --> 00:06:33,260
<c.magenta>请确保如你所需地</c>

139
00:06:33,327 --> 00:06:35,963
<c.magenta>从App Store</c>

140
00:06:36,029 --> 00:06:38,532
<c.magenta>且不要一直坚持使用这些</c>

141
00:06:39,900 --> 00:06:41,301
<c.magenta>但现在你有了SKProduct对象</c>

142
00:06:41,368 --> 00:06:44,705
<c.magenta>而且你已经准备好了</c>

143
00:06:45,606 --> 00:06:46,740
<c.magenta>当提到显示UI的时候</c>

144
00:06:46,807 --> 00:06:48,475
<c.magenta>当然了 这取决于你的应用</c>

145
00:06:48,542 --> 00:06:49,977
<c.magenta>每个应用都是有点不同的</c>

146
00:06:50,177 --> 00:06:52,179
<c.magenta>有关如何将产品呈现给用户</c>

147
00:06:54,448 --> 00:06:55,949
<c.magenta>这对于销售会产生巨大的影响</c>

148
00:06:56,016 --> 00:06:58,986
<c.magenta>我建议你们真的要</c>

149
00:06:59,419 --> 00:07:00,821
<c.magenta>如果你想了解关于这方面的更多信息</c>

150
00:06:59,419 --> 00:07:00,821
<c.magenta>如果你想了解关于这方面的更多信息</c>

151
00:07:00,888 --> 00:07:04,224
<c.magenta>在我们的开发者网站上</c>

152
00:07:04,291 --> 00:07:06,994
<c.magenta>这其中有些如何格式化这个页面的技巧</c>

153
00:07:07,160 --> 00:07:10,430
<c.magenta>以一种可以改善销售情况的方式</c>

154
00:07:12,399 --> 00:07:14,501
<c.magenta>有一个技巧是关于格式化产品价格的</c>

155
00:07:14,568 --> 00:07:16,370
<c.magenta>当提到产品价格的时候</c>

156
00:07:16,737 --> 00:07:19,473
<c.magenta>这就是你用来在UI中显示价格的技术</c>

157
00:07:19,540 --> 00:07:21,074
<c.magenta>创建一个数字格式化对象</c>

158
00:07:21,808 --> 00:07:24,077
<c.magenta>将数字的样式设定为汇率样式</c>

159
00:07:25,746 --> 00:07:28,081
<c.magenta>然后将本地场景</c>

160
00:07:28,148 --> 00:07:29,683
<c.magenta>这是个很重要的步骤</c>

161
00:07:29,850 --> 00:07:33,287
<c.magenta>因为如果你不这么做的话</c>

162
00:07:33,387 --> 00:07:35,822
<c.magenta>这可能和用户所登录的商店并不吻合</c>

163
00:07:35,989 --> 00:07:38,358
<c.magenta>用户可能登录的是中国商店</c>

164
00:07:38,792 --> 00:07:40,527
<c.magenta>但是设备是设为美式英文的</c>

165
00:07:40,694 --> 00:07:42,729
<c.magenta>对于所有的价格与汇率相关信息</c>

166
00:07:42,896 --> 00:07:44,898
<c.magenta>与它们在App Store中的</c>

167
00:07:45,199 --> 00:07:48,502
<c.magenta>所以请确保设置了数字格式化器</c>

168
00:07:49,269 --> 00:07:50,103
<c.magenta>而在你完成了操作后</c>

169
00:07:50,304 --> 00:07:52,372
<c.magenta>你可以从数字格式化器获得一个字符串</c>

170
00:07:52,673 --> 00:07:55,909
<c.magenta>这样你就得到了一个可以显示在</c>

171
00:07:59,279 --> 00:08:02,249
<c.magenta>还有一点是</c>

172
00:07:59,279 --> 00:08:02,249
<c.magenta>还有一点是</c>

173
00:08:02,316 --> 00:08:04,585
<c.magenta>你根本不需要转换汇率</c>

174
00:08:04,651 --> 00:08:06,553
<c.magenta>你可以让StoreKit来帮你实现</c>

175
00:08:06,720 --> 00:08:08,989
<c.magenta>你只要把数字和得到的价格本地场景</c>

176
00:08:09,056 --> 00:08:10,691
<c.magenta>交给数字格式化器就可以了</c>

177
00:08:12,426 --> 00:08:15,529
<c.magenta>接下来 在你显示了UI之后</c>

178
00:08:15,596 --> 00:08:18,532
<c.magenta>这里我们希望用户决定要</c>

179
00:08:18,599 --> 00:08:19,766
<c.magenta>他们点击了购买按钮</c>

180
00:08:20,133 --> 00:08:23,070
<c.magenta>现在就轮到你来向用户请求付款了</c>

181
00:08:23,770 --> 00:08:25,072
<c.magenta>这是个很简单的步骤</c>

182
00:08:25,138 --> 00:08:26,173
<c.magenta>只有几行代码</c>

183
00:08:26,640 --> 00:08:29,009
<c.magenta>你要把用户想买的SKProduct</c>

184
00:08:29,243 --> 00:08:33,580
<c.magenta>传给一个SKPayment初始化器</c>

185
00:08:34,214 --> 00:08:37,818
<c.magenta>然后你要把这个支付添加到</c>

186
00:08:39,385 --> 00:08:41,522
<c.magenta>在你将付款加到默认队列后</c>

187
00:08:42,155 --> 00:08:45,926
<c.magenta>用户就可以看到这个很漂亮的</c>

188
00:08:45,993 --> 00:08:47,327
<c.magenta>这是iOS 11中新加入的功能</c>

189
00:08:53,300 --> 00:08:55,502
<c.magenta>用户可以验证购买</c>

190
00:08:55,569 --> 00:08:58,572
<c.magenta>通过使用Touch ID</c>

191
00:08:59,039 --> 00:09:00,607
<c.magenta>我们觉得这是个有很大改进的设计</c>

192
00:08:59,039 --> 00:09:00,607
<c.magenta>我们觉得这是个有很大改进的设计</c>

193
00:09:00,674 --> 00:09:03,010
<c.magenta>这会极大地提升用户体验</c>

194
00:09:04,144 --> 00:09:05,579
<c.magenta>现在我想离题</c>

195
00:09:05,646 --> 00:09:08,081
<c.magenta>介绍一点关于检测非法活动的内容</c>

196
00:09:08,749 --> 00:09:12,019
<c.magenta>检测非法活动功能</c>

197
00:09:12,085 --> 00:09:15,455
<c.magenta>如果在这个流程中有什么可疑情况的话</c>

198
00:09:15,889 --> 00:09:19,193
<c.magenta>Apple有个先进的引擎来检测</c>

199
00:09:19,259 --> 00:09:21,061
<c.magenta>最理想情况就是在</c>

200
00:09:21,461 --> 00:09:24,998
<c.magenta>不过有的时候是在支付完成后</c>

201
00:09:25,065 --> 00:09:27,234
<c.magenta>它只能在已经出现了</c>

202
00:09:27,935 --> 00:09:31,305
<c.magenta>现在对于这种情况</c>

203
00:09:31,371 --> 00:09:32,406
<c.magenta>但是这不是个好办法</c>

204
00:09:32,472 --> 00:09:35,075
<c.magenta>所以我们现在想尝试</c>

205
00:09:35,142 --> 00:09:37,911
<c.magenta>来帮助我们能早一点发现这些非法活动</c>

206
00:09:38,478 --> 00:09:39,913
<c.magenta>现在我想做一个说明</c>

207
00:09:39,980 --> 00:09:42,816
<c.magenta>可以帮你们验证我刚才所说的内容</c>

208
00:09:44,418 --> 00:09:45,986
<c.magenta>比方说 我现在有三台设备</c>

209
00:09:46,353 --> 00:09:48,789
<c.magenta>三个用户用不同的</c>

210
00:09:49,489 --> 00:09:52,292
<c.magenta>这三个用户都在购买相同的金币产品</c>

211
00:09:52,426 --> 00:09:54,528
<c.magenta>从App Store中你的应用里</c>

212
00:09:55,295 --> 00:09:56,697
<c.magenta>这是个很普通的场景</c>

213
00:09:56,763 --> 00:09:58,632
<c.magenta>很多用户都会做很多次这样的操作</c>

214
00:09:58,699 --> 00:09:59,833
<c.magenta>全世界范围每天都会</c>

215
00:10:00,934 --> 00:10:03,203
<c.magenta>但是让我们再加点信息到这个问题中</c>

216
00:10:03,270 --> 00:10:04,771
<c.magenta>这会让问题大为不同</c>

217
00:10:05,105 --> 00:10:08,342
<c.magenta>比方说 这三个用户在你的应用中</c>

218
00:10:08,809 --> 00:10:12,079
<c.magenta>但是这些独立的ID</c>

219
00:10:12,145 --> 00:10:14,748
<c.magenta>你服务器上的一个相同的游戏账号</c>

220
00:10:15,449 --> 00:10:17,518
<c.magenta>这个场景突然就变得非常可疑了</c>

221
00:10:18,785 --> 00:10:21,922
<c.magenta>那么我们该如何在支付过程中</c>

222
00:10:22,089 --> 00:10:25,592
<c.magenta>我们想让你在支付步骤中</c>

223
00:10:26,326 --> 00:10:28,962
<c.magenta>这个标识符会用于</c>

224
00:10:29,263 --> 00:10:30,864
<c.magenta>所以如果你有服务器账号</c>

225
00:10:30,931 --> 00:10:32,766
<c.magenta>而某个用户作为特殊用户登录</c>

226
00:10:33,433 --> 00:10:35,802
<c.magenta>我们就会在这步中</c>

227
00:10:36,670 --> 00:10:38,472
<c.magenta>什么是不透明的标识符呢？</c>

228
00:10:39,239 --> 00:10:41,942
<c.magenta>我们不是想让你将</c>

229
00:10:42,009 --> 00:10:44,545
<c.magenta>我们已经知道该用户的Apple ID了</c>

230
00:10:44,745 --> 00:10:48,682
<c.magenta>我们不想知道该用户的用户名或者密码</c>

231
00:10:48,749 --> 00:10:49,950
<c.magenta>我们不想知道任何这些细节的信息</c>

232
00:10:50,017 --> 00:10:51,018
<c.magenta>我们建议你</c>

233
00:10:51,084 --> 00:10:54,521
<c.magenta>新建一个账户名的哈希值</c>

234
00:10:54,588 --> 00:10:57,858
<c.magenta>这样我们就可以用这个独一无二的</c>

235
00:10:57,991 --> 00:11:00,827
<c.magenta>在不同的Apple ID之间</c>

236
00:10:57,991 --> 00:11:00,827
<c.magenta>在不同的Apple ID之间</c>

237
00:11:01,962 --> 00:11:03,664
<c.magenta>想要实现这个功能真的很简单</c>

238
00:11:03,730 --> 00:11:04,798
<c.magenta>当你在创建SKPayment时</c>

239
00:11:04,865 --> 00:11:05,999
<c.magenta>也就是我们刚才看过的那个对象</c>

240
00:11:06,466 --> 00:11:07,534
<c.magenta>你只需要再多加一步</c>

241
00:11:07,601 --> 00:11:09,469
<c.magenta>就是设置应用的用户名</c>

242
00:11:10,003 --> 00:11:11,572
<c.magenta>这里你可以设置</c>

243
00:11:11,638 --> 00:11:13,607
<c.magenta>账户名的哈希值</c>

244
00:11:13,674 --> 00:11:15,809
<c.magenta>在此过程中更早地检测出非法的活动</c>

245
00:11:17,611 --> 00:11:19,179
<c.magenta>你只需要这么简单的一步</c>

246
00:11:19,246 --> 00:11:21,481
<c.magenta>就可以让你应用的支付行为更加安全</c>

247
00:11:23,650 --> 00:11:25,419
<c.magenta>在用户验证了支付行为后</c>

248
00:11:25,485 --> 00:11:27,588
<c.magenta>尽管信用卡已扣费</c>

249
00:11:27,654 --> 00:11:30,457
<c.magenta>什么时候处理来自</c>

250
00:11:31,225 --> 00:11:32,526
<c.magenta>我们看看这是什么样子的</c>

251
00:11:33,026 --> 00:11:35,095
<c.magenta>在你应用生命周期最开始的地方</c>

252
00:11:35,162 --> 00:11:36,129
<c.magenta>在这里 我所做的是</c>

253
00:11:36,630 --> 00:11:39,967
<c.magenta>实现了didFinishLaunching</c>

254
00:11:40,267 --> 00:11:44,204
<c.magenta>重要的是你要在SKPayment</c>

255
00:11:44,872 --> 00:11:47,274
<c.magenta>这里我所添加的是应用代理本身</c>

256
00:11:47,341 --> 00:11:49,510
<c.magenta>作为我的SKPayment</c>

257
00:11:49,576 --> 00:11:50,744
<c.magenta>但你可以使用其他对象</c>

258
00:11:50,811 --> 00:11:52,713
<c.magenta>如果你想监视这些交易的话</c>

259
00:11:52,913 --> 00:11:53,914
<c.magenta>这里很重要的一点是</c>

260
00:11:53,981 --> 00:11:57,084
<c.magenta>你要在应用的生命周期</c>

261
00:11:57,584 --> 00:12:00,587
<c.magenta>交易可能会在任何时间来到交易观察者</c>

262
00:11:57,584 --> 00:12:00,587
<c.magenta>交易可能会在任何时间来到交易观察者</c>

263
00:12:00,654 --> 00:12:02,856
<c.magenta>在你应用的生命周期中</c>

264
00:12:02,923 --> 00:12:04,925
<c.magenta>所以请确保在开始的时候</c>

265
00:12:05,959 --> 00:12:07,160
<c.magenta>在它被注册之后</c>

266
00:12:07,227 --> 00:12:09,897
<c.magenta>你就可以开始在回调函数中接收交易了</c>

267
00:12:10,797 --> 00:12:12,599
<c.magenta>这里是个由回调函数更新的交易</c>

268
00:12:12,666 --> 00:12:15,335
<c.magenta>这就是功能实现的中心</c>

269
00:12:16,103 --> 00:12:17,838
<c.magenta>你会接收到一个交易的数组</c>

270
00:12:17,905 --> 00:12:21,108
<c.magenta>你可以检查每个交易的交易状态</c>

271
00:12:21,909 --> 00:12:24,478
<c.magenta>你要找处于已购买状态的交易</c>

272
00:12:25,078 --> 00:12:27,314
<c.magenta>这就是StoreKit</c>

273
00:12:27,481 --> 00:12:31,818
<c.magenta>你可以检查下有效性</c>

274
00:12:33,187 --> 00:12:35,589
<c.magenta>这里还有些其他状态</c>

275
00:12:35,656 --> 00:12:38,392
<c.magenta>不过有一个状态我想讲一下</c>

276
00:12:39,860 --> 00:12:41,128
<c.magenta>某个交易会进入</c>

277
00:12:41,195 --> 00:12:43,964
<c.magenta>延迟状态 如果用户要求这么做的话</c>

278
00:12:44,731 --> 00:12:47,100
<c.magenta>小孩可能会请求购买某个程序内购买</c>

279
00:12:47,167 --> 00:12:50,838
<c.magenta>就会有个请求到达他们的父母那边</c>

280
00:12:51,271 --> 00:12:52,439
<c.magenta>而这一过程可能会间隔</c>

281
00:12:52,506 --> 00:12:55,042
<c.magenta>几秒 几分钟 几个星期</c>

282
00:12:55,108 --> 00:12:57,778
<c.magenta>重要的是</c>

283
00:12:57,845 --> 00:13:00,914
<c.magenta>在他们等待许可的时候</c>

284
00:12:57,845 --> 00:13:00,914
<c.magenta>在他们等待许可的时候</c>

285
00:13:00,981 --> 00:13:02,249
<c.magenta>让他们可一直用你的应用</c>

286
00:13:02,316 --> 00:13:03,483
<c.magenta>不要让他们卡在</c>

287
00:13:03,550 --> 00:13:06,253
<c.magenta>某些像是加载旋转这类界面上</c>

288
00:13:06,887 --> 00:13:08,222
<c.magenta>而这个支付会最终进入</c>

289
00:13:08,288 --> 00:13:09,890
<c.magenta>已购买状态</c>

290
00:13:09,957 --> 00:13:12,326
<c.magenta>你可以像其他的购买交易</c>

291
00:13:13,827 --> 00:13:16,029
<c.magenta>为了测试延迟交易</c>

292
00:13:16,096 --> 00:13:17,497
<c.magenta>我们提供了一个方法</c>

293
00:13:17,564 --> 00:13:19,499
<c.magenta>你可以创建一个可变支付对象</c>

294
00:13:20,167 --> 00:13:23,136
<c.magenta>你可以在这个对象上设置</c>

295
00:13:23,337 --> 00:13:25,806
<c.magenta>这在你用沙盒环境的时候很有效</c>

296
00:13:26,006 --> 00:13:27,975
<c.magenta>我们不会在本次演讲中过多介绍沙盒</c>

297
00:13:28,475 --> 00:13:29,710
<c.magenta>它在代码上是这样的</c>

298
00:13:31,011 --> 00:13:34,047
<c.magenta>你可以把simulates</c>

299
00:13:34,114 --> 00:13:37,351
<c.magenta>这就意味着在你测试程序内购买的时候</c>

300
00:13:37,451 --> 00:13:39,586
<c.magenta>这个交易就会进入</c>

301
00:13:39,686 --> 00:13:42,389
<c.magenta>一个更新的交易状态</c>

302
00:13:42,456 --> 00:13:45,292
<c.magenta>你可以测试下如何处理这些情况</c>

303
00:13:47,561 --> 00:13:50,030
<c.magenta>在你处理错误的时候</c>

304
00:13:50,097 --> 00:13:52,733
<c.magenta>此过程中的错误不尽相同</c>

305
00:13:53,300 --> 00:13:55,302
<c.magenta>这就意味着 你要仔细看错误代码</c>

306
00:13:55,369 --> 00:13:57,337
<c.magenta>也就是在交易过程中的错误代码</c>

307
00:13:57,704 --> 00:13:59,239
<c.magenta>所以别急着显示一个警告</c>

308
00:13:59,306 --> 00:14:02,576
<c.magenta>除非是很有必要</c>

309
00:13:59,306 --> 00:14:02,576
<c.magenta>除非是很有必要</c>

310
00:14:03,076 --> 00:14:05,879
<c.magenta>我们发现过</c>

311
00:14:05,979 --> 00:14:07,848
<c.magenta>这有个对应的错误代码</c>

312
00:14:08,382 --> 00:14:10,951
<c.magenta>你不需要给用户显示个警告来说</c>

313
00:14:11,018 --> 00:14:13,620
<c.magenta>他们既然点了取消按钮</c>

314
00:14:13,887 --> 00:14:15,088
<c.magenta>你不用再次告诉他们了</c>

315
00:14:16,623 --> 00:14:19,960
<c.magenta>同样重要的是你要尽可能地</c>

316
00:14:20,527 --> 00:14:22,462
<c.magenta>这就意味着 你不需要请求确认</c>

317
00:14:22,529 --> 00:14:25,332
<c.magenta>像是程序内购买这些事情</c>

318
00:14:25,399 --> 00:14:27,534
<c.magenta>我们有个新的支付表单</c>

319
00:14:27,601 --> 00:14:29,002
<c.magenta>你可交给StoreKit处理</c>

320
00:14:30,270 --> 00:14:33,407
<c.magenta>在交易进入支付状态后</c>

321
00:14:33,774 --> 00:14:36,310
<c.magenta>我提醒过你们</c>

322
00:14:36,476 --> 00:14:39,713
<c.magenta>我们要如何实现呢？</c>

323
00:14:39,780 --> 00:14:42,850
<c.magenta>我们要使用应用收据来实现这个功能</c>

324
00:14:44,151 --> 00:14:45,686
<c.magenta>这个应用收据很像是</c>

325
00:14:45,752 --> 00:14:47,654
<c.magenta>你从商店拿到的那种收据</c>

326
00:14:47,821 --> 00:14:50,357
<c.magenta>它就是支付的证据</c>

327
00:14:50,424 --> 00:14:53,293
<c.magenta>证明用户已经买了他们声称购买的东西</c>

328
00:14:53,961 --> 00:14:55,262
<c.magenta>在本例中</c>

329
00:14:55,329 --> 00:14:57,798
<c.magenta>它就是应用和程序内购买的可信记录</c>

330
00:14:57,865 --> 00:14:59,733
<c.magenta>就是出现在这个应用中的可信记录</c>

331
00:15:00,434 --> 00:15:01,969
<c.magenta>实际上每个应用都有应用收据</c>

332
00:15:02,035 --> 00:15:04,638
<c.magenta>因为它包含了</c>

333
00:15:04,738 --> 00:15:08,275
<c.magenta>甚至也包括了</c>

334
00:15:09,443 --> 00:15:11,445
<c.magenta>这个文档会保存在用户的设备上</c>

335
00:15:11,512 --> 00:15:13,580
<c.magenta>它由App Store颁布</c>

336
00:15:14,548 --> 00:15:16,383
<c.magenta>它还是个签过名的 可验证的文档</c>

337
00:15:16,450 --> 00:15:19,119
<c.magenta>所以你可以确保这个文档</c>

338
00:15:19,219 --> 00:15:22,556
<c.magenta>你可以用证书来验证文档的真实性</c>

339
00:15:23,690 --> 00:15:26,260
<c.magenta>最后 此收据是在该设备上</c>

340
00:15:26,326 --> 00:15:29,029
<c.magenta>这个收据文档不能跨设备共享</c>

341
00:15:29,296 --> 00:15:32,165
<c.magenta>而且它不能被一台设备上的</c>

342
00:15:33,433 --> 00:15:34,868
<c.magenta>为了保证这个文档</c>

343
00:15:34,935 --> 00:15:37,604
<c.magenta>也就是你用来检查交易的文档</c>

344
00:15:37,671 --> 00:15:39,506
<c.magenta>你可以进行收据有效性验证</c>

345
00:15:40,040 --> 00:15:42,109
<c.magenta>收据有效性验证可以通过多种方法实现</c>

346
00:15:42,843 --> 00:15:45,879
<c.magenta>你可以直接在用户的设备上</c>

347
00:15:45,946 --> 00:15:47,614
<c.magenta>然后你可以解锁相应的功能</c>

348
00:15:48,382 --> 00:15:51,051
<c.magenta>另一个方法是使用</c>

349
00:15:51,218 --> 00:15:53,287
<c.magenta>你可以把加密的收据数据</c>

350
00:15:53,353 --> 00:15:55,088
<c.magenta>发送到你的服务器上</c>

351
00:15:55,322 --> 00:15:57,791
<c.magenta>你可从那将其发送到</c>

352
00:15:58,025 --> 00:15:59,860
<c.magenta>在那我们会为你做一些检查</c>

353
00:16:01,261 --> 00:16:03,430
<c.magenta>我们不会详细介绍</c>

354
00:16:03,497 --> 00:16:04,865
<c.magenta>会介绍这些内容的演讲</c>

355
00:16:04,932 --> 00:16:06,834
<c.magenta>是在今天下午举办的高级演讲</c>

356
00:16:06,900 --> 00:16:10,137
<c.magenta>我会介绍如何从设备读取收据数据</c>

357
00:16:10,204 --> 00:16:13,440
<c.magenta>还有如何实现服务器到服务器的交换</c>

358
00:16:14,641 --> 00:16:17,945
<c.magenta>一旦你确认了某个收据是真实的文档</c>

359
00:16:18,245 --> 00:16:19,947
<c.magenta>你就可以读取交易</c>

360
00:16:20,047 --> 00:16:22,683
<c.magenta>并且确保在此过程中的交易</c>

361
00:16:22,749 --> 00:16:23,917
<c.magenta>会出现在收据上</c>

362
00:16:24,051 --> 00:16:26,086
<c.magenta>这就意味着你有了有效的购买</c>

363
00:16:26,153 --> 00:16:27,955
<c.magenta>可以接着进行下一步</c>

364
00:16:29,089 --> 00:16:31,625
<c.magenta>也就是为你的程序内购买</c>

365
00:16:31,925 --> 00:16:33,460
<c.magenta>很明显这是个重要的步骤</c>

366
00:16:34,027 --> 00:16:36,997
<c.magenta>可以让用户使用他们所购买的功能</c>

367
00:16:37,431 --> 00:16:39,733
<c.magenta>在这步中 你可能会下载些额外的内容</c>

368
00:16:39,800 --> 00:16:41,168
<c.magenta>且让用户可用这些内容</c>

369
00:16:42,069 --> 00:16:43,904
<c.magenta>如果你要下载程序内购买的内容</c>

370
00:16:43,971 --> 00:16:45,539
<c.magenta>有几种实现的方法</c>

371
00:16:47,274 --> 00:16:50,511
<c.magenta>Apple也给你们提供了两种</c>

372
00:16:50,611 --> 00:16:52,212
<c.magenta>我们有响应式的资源</c>

373
00:16:52,279 --> 00:16:54,581
<c.magenta>这个API是我们在几年前引入的</c>

374
00:16:54,882 --> 00:16:56,383
<c.magenta>还有一种是我刚才提到过的</c>

375
00:16:56,450 --> 00:16:58,952
<c.magenta>寄存的程序内购买可下载内容</c>

376
00:16:59,019 --> 00:17:01,321
<c.magenta>你可以把可下载内容关联到</c>

377
00:16:59,019 --> 00:17:01,321
<c.magenta>你可以把可下载内容关联到</c>

378
00:17:01,421 --> 00:17:06,026
<c.magenta>iTunes Connect上 这样就可以直接</c>

379
00:17:06,859 --> 00:17:10,263
<c.magenta>当然了 另一种方法就是</c>

380
00:17:10,464 --> 00:17:11,431
<c.magenta>这当然是可以的</c>

381
00:17:11,498 --> 00:17:13,200
<c.magenta>但是如果你这么做</c>

382
00:17:13,267 --> 00:17:15,602
<c.magenta>要使用合适的后台下载API</c>

383
00:17:15,669 --> 00:17:18,305
<c.magenta>这些API要使用NSURL会话</c>

384
00:17:18,405 --> 00:17:21,074
<c.magenta>不会被中断</c>

385
00:17:22,709 --> 00:17:24,111
<c.magenta>在你解锁了内容之后</c>

386
00:17:24,178 --> 00:17:27,647
<c.magenta>你可能是将专业版应用给了你的用户</c>

387
00:17:28,214 --> 00:17:29,917
<c.magenta>你就可以结束此次交易了</c>

388
00:17:29,983 --> 00:17:32,252
<c.magenta>这是实现程序内购买的最后一步</c>

389
00:17:32,786 --> 00:17:36,156
<c.magenta>重要的是</c>

390
00:17:36,223 --> 00:17:37,791
<c.magenta>即使有些是错误状态的</c>

391
00:17:37,891 --> 00:17:40,394
<c.magenta>你必须结束流中的所有交易</c>

392
00:17:40,694 --> 00:17:43,096
<c.magenta>其中也包括自动续订的情况</c>

393
00:17:43,163 --> 00:17:46,500
<c.magenta>所有可续订的订阅也会出现在这个流中</c>

394
00:17:46,567 --> 00:17:49,736
<c.magenta>对于其中任何要续订的账单周期</c>

395
00:17:49,803 --> 00:17:52,840
<c.magenta>你必须要确保所有此过程中的</c>

396
00:17:54,474 --> 00:17:57,477
<c.magenta>如果你没有结束交易的话</c>

397
00:17:57,544 --> 00:17:58,712
<c.magenta>它们就会一直不停弹出</c>

398
00:17:58,779 --> 00:18:01,715
<c.magenta>每次应用启动 调用了更新交易</c>

399
00:17:58,779 --> 00:18:01,715
<c.magenta>每次应用启动 调用了更新交易</c>

400
00:18:01,815 --> 00:18:03,483
<c.magenta>所以请确保你已经结束了它们</c>

401
00:18:03,550 --> 00:18:05,185
<c.magenta>而且将它们移出了支付队列</c>

402
00:18:05,752 --> 00:18:07,588
<c.magenta>事实上 对于自动续订的订阅</c>

403
00:18:07,654 --> 00:18:10,657
<c.magenta>我们会介绍些关于重试支付的功能</c>

404
00:18:10,824 --> 00:18:12,559
<c.magenta>该功能依赖于最新的知识</c>

405
00:18:12,626 --> 00:18:14,962
<c.magenta>也就是有关所有</c>

406
00:18:15,028 --> 00:18:19,399
<c.magenta>重要的是 你一定要把交易结束掉</c>

407
00:18:20,701 --> 00:18:23,036
<c.magenta>其实你只需要一行代码就可以结束交易</c>

408
00:18:23,103 --> 00:18:24,638
<c.magenta>所以你们没借口不结束交易了</c>

409
00:18:24,771 --> 00:18:27,474
<c.magenta>你只需要将交易传到</c>

410
00:18:27,674 --> 00:18:30,477
<c.magenta>这是SKPaymentQueue</c>

411
00:18:32,312 --> 00:18:34,481
<c.magenta>在你结束了交易之后</c>

412
00:18:34,781 --> 00:18:36,250
<c.magenta>这也就是最后一步来实现</c>

413
00:18:36,316 --> 00:18:37,951
<c.magenta>在设备上进行程序内购买</c>

414
00:18:38,051 --> 00:18:41,255
<c.magenta>现在用户就可以访问</c>

415
00:18:42,523 --> 00:18:44,291
<c.magenta>这里有些小技巧</c>

416
00:18:44,424 --> 00:18:47,361
<c.magenta>当你在进行应用审核的时候</c>

417
00:18:47,427 --> 00:18:49,930
<c.magenta>如果你有些非可消耗的</c>

418
00:18:49,997 --> 00:18:52,833
<c.magenta>或是在你的应用中自动续订的产品</c>

419
00:18:53,333 --> 00:18:55,369
<c.magenta>而且这个恢复按钮必须是个独立的按钮</c>

420
00:18:55,435 --> 00:18:57,004
<c.magenta>与真正的购买按钮区别开</c>

421
00:18:57,137 --> 00:18:59,406
<c.magenta>你可以把它放到应用中的设置里面</c>

422
00:18:59,473 --> 00:19:03,310
<c.magenta>它就是个用来让用户</c>

423
00:18:59,473 --> 00:19:03,310
<c.magenta>它就是个用来让用户</c>

424
00:19:03,377 --> 00:19:05,078
<c.magenta>它不仅仅是个备份工具</c>

425
00:19:05,145 --> 00:19:06,647
<c.magenta>人们经常用到这个功能</c>

426
00:19:06,713 --> 00:19:08,215
<c.magenta>比如他们可能有了个新的设备</c>

427
00:19:08,282 --> 00:19:09,650
<c.magenta>如果他们买了新的iPad</c>

428
00:19:09,850 --> 00:19:12,920
<c.magenta>他们想解锁已经在手机上买过的内容</c>

429
00:19:13,120 --> 00:19:15,389
<c.magenta>他们就可以使用</c>

430
00:19:15,455 --> 00:19:17,624
<c.magenta>所以你一定要有个恢复交易按钮</c>

431
00:19:17,691 --> 00:19:19,326
<c.magenta>在你应用的某个地方</c>

432
00:19:20,227 --> 00:19:22,262
<c.magenta>就如我所说的 它只能用于恢复</c>

433
00:19:22,329 --> 00:19:25,432
<c.magenta>非可消耗的 或是自动续订的产品交易</c>

434
00:19:25,899 --> 00:19:28,936
<c.magenta>如果你卖的是可消耗的产品</c>

435
00:19:29,002 --> 00:19:31,205
<c.magenta>你就得坚持这一点</c>

436
00:19:31,371 --> 00:19:32,472
<c.magenta>可能你有个游戏账户</c>

437
00:19:32,539 --> 00:19:34,575
<c.magenta>你可能将账户信息关联到了</c>

438
00:19:34,641 --> 00:19:35,876
<c.magenta>你自己服务器上的某处</c>

439
00:19:37,511 --> 00:19:40,247
<c.magenta>你们就可以用这个API来恢复它们</c>

440
00:19:41,114 --> 00:19:42,950
<c.magenta>你们要使用restore</c>

441
00:19:43,016 --> 00:19:44,518
<c.magenta>它是默认支付队列上的方法</c>

442
00:19:44,885 --> 00:19:48,188
<c.magenta>如果你调用这个方法</c>

443
00:19:48,255 --> 00:19:51,692
<c.magenta>重新出现在更新交易回调函数上</c>

444
00:19:51,992 --> 00:19:54,194
<c.magenta>你可以使用刚才讲过的同样流程</c>

445
00:19:54,695 --> 00:19:56,263
<c.magenta>检查它们是不是处于购买状态</c>

446
00:19:56,430 --> 00:19:58,999
<c.magenta>做收据有效性验证</c>

447
00:20:00,267 --> 00:20:03,003
<c.magenta>关于恢复已完成交易</c>

448
00:20:03,070 --> 00:20:04,671
<c.magenta>你可以理解交易是否结束了</c>

449
00:20:04,738 --> 00:20:06,707
<c.magenta>或者某个过程中是否有错误出现</c>

450
00:20:06,773 --> 00:20:08,408
<c.magenta>不过这里真正要做的是</c>

451
00:20:08,475 --> 00:20:11,778
<c.magenta>要保证将交易观察者</c>

452
00:20:11,845 --> 00:20:13,580
<c.magenta>这样你才可以处理所有交易</c>

453
00:20:13,647 --> 00:20:16,450
<c.magenta>在这些交易传入</c>

454
00:20:18,619 --> 00:20:21,655
<c.magenta>现在我们总结下刚才讲到的流程</c>

455
00:20:21,722 --> 00:20:22,856
<c.magenta>你一直要观察支付队列</c>

456
00:20:22,923 --> 00:20:24,458
<c.magenta>并且你要确保</c>

457
00:20:24,525 --> 00:20:26,393
<c.magenta>在你的应用声明周期中</c>

458
00:20:27,461 --> 00:20:30,664
<c.magenta>使用SKProducts请求</c>

459
00:20:30,764 --> 00:20:32,366
<c.magenta>这些本地化信息是有关</c>

460
00:20:32,533 --> 00:20:35,068
<c.magenta>并且使用这些信息</c>

461
00:20:35,269 --> 00:20:37,004
<c.magenta>使用这项技术还有</c>

462
00:20:37,070 --> 00:20:41,875
<c.magenta>来确保你的价格是以</c>

463
00:20:43,343 --> 00:20:47,247
<c.magenta>使用收据来验证支付是否真正完成了</c>

464
00:20:47,714 --> 00:20:49,449
<c.magenta>这是个重要的安全性步骤</c>

465
00:20:49,516 --> 00:20:51,685
<c.magenta>我们今天下午会再介绍</c>

466
00:20:52,452 --> 00:20:54,488
<c.magenta>你要记得把内容设成对用户是可用的</c>

467
00:20:54,555 --> 00:20:56,323
<c.magenta>保证他们能得到所买的东西</c>

468
00:20:57,925 --> 00:21:00,360
<c.magenta>然后在过程的最后结束交易</c>

469
00:20:57,925 --> 00:21:00,360
<c.magenta>然后在过程的最后结束交易</c>

470
00:21:00,427 --> 00:21:01,795
<c.magenta>请确保你调用了</c>

471
00:21:01,862 --> 00:21:03,430
<c.magenta>且传入了该交易对象</c>

472
00:21:03,764 --> 00:21:04,731
<c.magenta>然后就是在你应用的某处</c>

473
00:21:04,831 --> 00:21:06,633
<c.magenta>有个恢复按钮</c>

474
00:21:06,700 --> 00:21:09,837
<c.magenta>在设备上恢复已完成的交易</c>

475
00:21:10,871 --> 00:21:14,441
<c.magenta>这就是关于实现</c>

476
00:21:14,908 --> 00:21:16,143
<c.magenta>接下来 我们要讨论下</c>

477
00:21:16,410 --> 00:21:20,013
<c.magenta>在App Store应用中</c>

478
00:21:20,147 --> 00:21:21,215
<c.magenta>为了介绍关于这方面的更多内容</c>

479
00:21:21,281 --> 00:21:23,350
<c.magenta>我想有请Ross LeBeau</c>

480
00:21:33,460 --> 00:21:36,430
<c.magenta>大家好 我叫Ross</c>

481
00:21:37,164 --> 00:21:40,434
<c.magenta>我很激动今天能给你们介绍一下</c>

482
00:21:41,368 --> 00:21:43,036
<c.magenta>这就是推广程序内购买</c>

483
00:21:43,504 --> 00:21:45,205
<c.magenta>它可以让你有更广泛的受众</c>

484
00:21:45,272 --> 00:21:46,673
<c.magenta>让更多人知道你的应用</c>

485
00:21:49,176 --> 00:21:52,045
<c.magenta>在今天以前</c>

486
00:21:52,446 --> 00:21:54,214
<c.magenta>你的程序内购买就很难被找到</c>

487
00:21:55,516 --> 00:21:57,251
<c.magenta>但是从iOS 11开始</c>

488
00:21:57,317 --> 00:21:59,953
<c.magenta>你的程序内购买可直接</c>

489
00:22:00,854 --> 00:22:02,155
<c.magenta>它们可以在你的应用页面中被看到</c>

490
00:22:03,223 --> 00:22:04,958
<c.magenta>它们可以被编辑功能选用</c>

491
00:22:05,726 --> 00:22:07,461
<c.magenta>它们甚至还可以出现在搜索结果中</c>

492
00:22:08,695 --> 00:22:09,530
<c.magenta>不仅如此</c>

493
00:22:09,863 --> 00:22:12,966
<c.magenta>用户还可以直接从</c>

494
00:22:14,468 --> 00:22:17,538
<c.magenta>我们觉得这对于用户如何浏览</c>

495
00:22:19,673 --> 00:22:20,807
<c.magenta>它是如何运作的呢？</c>

496
00:22:21,675 --> 00:22:23,977
<c.magenta>推广你的程序内购买是很容易的</c>

497
00:22:24,378 --> 00:22:25,846
<c.magenta>你只需要做两件事</c>

498
00:22:26,980 --> 00:22:30,784
<c.magenta>首先 对于每个应用选择最多</c>

499
00:22:31,018 --> 00:22:33,554
<c.magenta>并且在iTunes Connect中</c>

500
00:22:34,454 --> 00:22:36,823
<c.magenta>然后 在你的应用中</c>

501
00:22:37,024 --> 00:22:39,259
<c.magenta>来处理从App Store</c>

502
00:22:40,027 --> 00:22:43,230
<c.magenta>在大多数情况下</c>

503
00:22:43,297 --> 00:22:45,532
<c.magenta>StoreKit会为你处理</c>

504
00:22:47,134 --> 00:22:47,968
<c.magenta>而且</c>

505
00:22:49,436 --> 00:22:50,304
<c.magenta>如果你需要的话</c>

506
00:22:51,538 --> 00:22:55,075
<c.magenta>你可以在本地重写</c>

507
00:22:56,043 --> 00:22:59,112
<c.magenta>这不是必须的操作</c>

508
00:23:01,181 --> 00:23:02,316
<c.magenta>我们已经介绍了很多关于</c>

509
00:23:02,382 --> 00:23:03,984
<c.magenta>如何设置</c>

510
00:23:04,051 --> 00:23:05,886
<c.magenta>在“iTunes Connect</c>

511
00:23:06,119 --> 00:23:08,822
<c.magenta>这场演讲是昨天举办的</c>

512
00:23:09,323 --> 00:23:12,693
<c.magenta>现在让我们看下如何处理你的交易信息</c>

513
00:23:12,759 --> 00:23:14,094
<c.magenta>它从App Store送到你手中时</c>

514
00:23:17,331 --> 00:23:20,767
<c.magenta>有个用户在App Store中</c>

515
00:23:22,069 --> 00:23:23,971
<c.magenta>StoreKit</c>

516
00:23:24,304 --> 00:23:26,406
<c.magenta>并且将有关此次交易的信息发送给你</c>

517
00:23:26,673 --> 00:23:30,410
<c.magenta>通过SKPaymentTransaction</c>

518
00:23:30,944 --> 00:23:33,180
<c.magenta>而且你已经有了一个</c>

519
00:23:33,247 --> 00:23:36,517
<c.magenta>该对象可以观察交易状态</c>

520
00:23:37,618 --> 00:23:39,786
<c.magenta>你可以将用来推广程序内购买的新代码</c>

521
00:23:39,853 --> 00:23:41,355
<c.magenta>放到你已有的代码旁边</c>

522
00:23:43,156 --> 00:23:45,692
<c.magenta>还有个好消息是</c>

523
00:23:46,760 --> 00:23:49,263
<c.magenta>App Store会下载你的应用</c>

524
00:23:49,863 --> 00:23:51,598
<c.magenta>在本例中 它不会自动被打开</c>

525
00:23:51,665 --> 00:23:54,134
<c.magenta>所以用户会收到一条通知</c>

526
00:23:54,468 --> 00:23:55,536
<c.magenta>当他们点击了通知时</c>

527
00:24:01,208 --> 00:24:02,409
<c.magenta>代码是什么样的呢？</c>

528
00:24:05,279 --> 00:24:08,348
<c.magenta>这就是所有你需要</c>

529
00:24:09,583 --> 00:24:13,420
<c.magenta>StoreKit会发送给你SKPayment队列</c>

530
00:24:13,554 --> 00:24:15,355
<c.magenta>也就是所有你处理交易要用的工具</c>

531
00:24:15,756 --> 00:24:18,292
<c.magenta>而且SKPayment已经设置好了</c>

532
00:24:19,826 --> 00:24:20,794
<c.magenta>当你返回真的时候</c>

533
00:24:21,628 --> 00:24:24,331
<c.magenta>就会给用户显示一个很漂亮的</c>

534
00:24:24,698 --> 00:24:26,066
<c.magenta>他们可以通过表单来完成交易</c>

535
00:24:26,266 --> 00:24:27,701
<c.magenta>这就是所有要做的内容了</c>

536
00:24:27,901 --> 00:24:28,836
<c.magenta>已经可以用这个功能了</c>

537
00:24:30,604 --> 00:24:33,240
<c.magenta>如果用户是处于某种中间状态呢？</c>

538
00:24:33,841 --> 00:24:34,708
<c.magenta>如果他们正在创建账户呢？</c>

539
00:24:34,775 --> 00:24:37,344
<c.magenta>如果他们已经解锁了</c>

540
00:24:39,980 --> 00:24:43,283
<c.magenta>如果是这样 你可以先暂停支付过程</c>

541
00:24:44,351 --> 00:24:47,087
<c.magenta>然后当用户准备好了</c>

542
00:24:47,855 --> 00:24:49,223
<c.magenta>你就只需将支付添加到支付队列中</c>

543
00:24:49,289 --> 00:24:51,191
<c.magenta>就像是对待普通的程序内购买那样</c>

544
00:24:52,226 --> 00:24:53,927
<c.magenta>重要的是你要添加的</c>

545
00:24:53,994 --> 00:24:55,362
<c.magenta>是在这个代理方法中发送给你的</c>

546
00:24:55,429 --> 00:24:57,364
<c.magenta>而不是为相同的产品再创建一个新的</c>

547
00:24:58,699 --> 00:25:01,168
<c.magenta>如果出于某种原因</c>

548
00:24:58,699 --> 00:25:01,168
<c.magenta>如果出于某种原因</c>

549
00:25:01,768 --> 00:25:04,004
<c.magenta>只需要返回假就可以了</c>

550
00:25:06,406 --> 00:25:08,542
<c.magenta>如果你要取消或者延迟某个支付</c>

551
00:25:08,909 --> 00:25:11,411
<c.magenta>你应该通过某种方式让用户知道</c>

552
00:25:12,145 --> 00:25:12,980
<c.magenta>你最好不要让这种情况发生</c>

553
00:25:13,046 --> 00:25:15,749
<c.magenta>就是用户点击了</c>

554
00:25:16,183 --> 00:25:17,985
<c.magenta>来购买你的应用 然后什么都没发生</c>

555
00:25:18,752 --> 00:25:20,954
<c.magenta>他们会认为这是个错误 那可不太好</c>

556
00:25:24,024 --> 00:25:27,327
<c.magenta>现在你已经把这些内容都设置好了</c>

557
00:25:28,595 --> 00:25:31,198
<c.magenta>你的程序内购买</c>

558
00:25:31,298 --> 00:25:34,835
<c.magenta>直到你提交了一个</c>

559
00:25:34,902 --> 00:25:37,070
<c.magenta>这样我们就知道你可以处理交易了</c>

560
00:25:38,572 --> 00:25:41,341
<c.magenta>我们创建了一个</c>

561
00:25:42,476 --> 00:25:45,913
<c.magenta>这个URL具有ITMS业务协议</c>

562
00:25:46,480 --> 00:25:49,283
<c.magenta>第一个参数是动作</c>

563
00:25:50,317 --> 00:25:51,451
<c.magenta>第二个参数是bundleID</c>

564
00:25:51,518 --> 00:25:53,387
<c.magenta>也就是你应用的bundleID</c>

565
00:25:54,521 --> 00:25:55,856
<c.magenta>最后一个参数是产品标识符</c>

566
00:25:55,923 --> 00:25:57,791
<c.magenta>你所填入的就是产品标识符</c>

567
00:25:57,858 --> 00:25:59,493
<c.magenta>也就是你想测试的</c>

568
00:26:01,461 --> 00:26:03,430
<c.magenta>在你像这样构建了这个URL之后</c>

569
00:26:03,897 --> 00:26:05,933
<c.magenta>你可以将它发送自己</c>

570
00:26:06,366 --> 00:26:08,802
<c.magenta>电子邮件 或是在设备上点击它都可以</c>

571
00:26:09,870 --> 00:26:12,406
<c.magenta>你能知道它是正常工作的</c>

572
00:26:13,240 --> 00:26:14,741
<c.magenta>然后你就可以从这开始测试了</c>

573
00:26:19,012 --> 00:26:21,748
<c.magenta>现在我们已经介绍了如何处理支付信息</c>

574
00:26:21,815 --> 00:26:23,016
<c.magenta>当它被从App Store中</c>

575
00:26:24,284 --> 00:26:25,886
<c.magenta>让我们来看下更高级的设置</c>

576
00:26:28,455 --> 00:26:31,225
<c.magenta>当你在iTunes Connect中</c>

577
00:26:31,792 --> 00:26:35,629
<c.magenta>你可以选择它们</c>

578
00:26:36,129 --> 00:26:38,031
<c.magenta>你还可以选择隐藏其中某些推广</c>

579
00:26:38,098 --> 00:26:39,233
<c.magenta>这样它们就根本不会显示了</c>

580
00:26:40,400 --> 00:26:42,236
<c.magenta>然后当你的应用在设备上运行的时候</c>

581
00:26:43,270 --> 00:26:46,640
<c.magenta>你可以在本地重写这些内容</c>

582
00:26:47,875 --> 00:26:51,044
<c.magenta>例如 如果你在开发一个竞速游戏</c>

583
00:26:51,111 --> 00:26:52,946
<c.magenta>你可能会隐藏某辆车</c>

584
00:26:53,013 --> 00:26:54,982
<c.magenta>直到用户解锁了这辆车才显示</c>

585
00:26:56,016 --> 00:26:56,917
<c.magenta>而当他们确实买了这辆车时</c>

586
00:26:58,285 --> 00:27:02,122
<c.magenta>你可以把这个程序内购买移到</c>

587
00:26:58,285 --> 00:27:02,122
<c.magenta>你可以把这个程序内购买移到</c>

588
00:27:02,756 --> 00:27:03,991
<c.magenta>这样他们就解锁了这辆车</c>

589
00:27:04,324 --> 00:27:06,326
<c.magenta>现在他们就可以看到</c>

590
00:27:06,426 --> 00:27:07,461
<c.magenta>出现在了列表的前面</c>

591
00:27:09,162 --> 00:27:11,632
<c.magenta>你要知道的是</c>

592
00:27:11,698 --> 00:27:13,267
<c.magenta>它们被本地保存在每台设备上</c>

593
00:27:15,836 --> 00:27:17,938
<c.magenta>所以如果你需要复制相同的行为</c>

594
00:27:18,138 --> 00:27:21,408
<c.magenta>你应该确保你的应用</c>

595
00:27:24,545 --> 00:27:27,080
<c.magenta>让我们看些实际的例子吧</c>

596
00:27:29,850 --> 00:27:31,818
<c.magenta>这里我们有个叫作</c>

597
00:27:32,386 --> 00:27:33,453
<c.magenta>我们开发了这个应用</c>

598
00:27:33,520 --> 00:27:38,091
<c.magenta>来帮助人们探索并到目的地去旅行</c>

599
00:27:40,394 --> 00:27:41,695
<c.magenta>这个应用不存在于App Store</c>

600
00:27:41,762 --> 00:27:42,930
<c.magenta>它仅为这次演示而开发</c>

601
00:27:43,864 --> 00:27:45,732
<c.magenta>这里我们要推广三个程序内购买</c>

602
00:27:45,799 --> 00:27:47,067
<c.magenta>我们有专业版订阅</c>

603
00:27:47,267 --> 00:27:49,269
<c.magenta>它会升级用户能看到的细致程度</c>

604
00:27:49,336 --> 00:27:50,370
<c.magenta>地图 还有路线</c>

605
00:27:51,138 --> 00:27:54,007
<c.magenta>我们还有钓鱼热点 和隐藏的沙滩包</c>

606
00:27:54,208 --> 00:27:57,144
<c.magenta>它会解锁更多相关主题的路线</c>

607
00:27:59,546 --> 00:28:01,114
<c.magenta>你可能想实现这个功能</c>

608
00:27:59,546 --> 00:28:01,114
<c.magenta>你可能想实现这个功能</c>

609
00:28:01,281 --> 00:28:04,151
<c.magenta>比如说某个用户已经购买了</c>

610
00:28:05,052 --> 00:28:06,854
<c.magenta>你要将这个程序内购买</c>

611
00:28:07,054 --> 00:28:10,157
<c.magenta>StoreKit或是App Store</c>

612
00:28:10,724 --> 00:28:12,860
<c.magenta>如果他们购买了这个程序内购买</c>

613
00:28:12,926 --> 00:28:14,494
<c.magenta>他们还是会在你的列表中看到它</c>

614
00:28:15,229 --> 00:28:16,263
<c.magenta>这可能不太合情理</c>

615
00:28:16,330 --> 00:28:17,464
<c.magenta>因为他们不能再买一次了</c>

616
00:28:18,599 --> 00:28:21,034
<c.magenta>你可以使用本地可视化</c>

617
00:28:21,101 --> 00:28:24,271
<c.magenta>重写来隐藏这个程序内购买</c>

618
00:28:24,338 --> 00:28:27,107
<c.magenta>然后他们就只能在你的应用页面中</c>

619
00:28:29,877 --> 00:28:31,144
<c.magenta>该功能的代码是什么样的呢？</c>

620
00:28:34,815 --> 00:28:38,552
<c.magenta>就像是这样 首先</c>

621
00:28:38,619 --> 00:28:40,754
<c.magenta>这样你就从服务器获得了最新的信息</c>

622
00:28:41,255 --> 00:28:43,957
<c.magenta>这里我们要获取的是关于</c>

623
00:28:45,626 --> 00:28:49,363
<c.magenta>然后 我们有个新的</c>

624
00:28:49,429 --> 00:28:51,965
<c.magenta>叫作</c>

625
00:28:52,900 --> 00:28:54,468
<c.magenta>你要获取默认的控制器</c>

626
00:28:56,136 --> 00:28:57,504
<c.magenta>然后将你的SKProduct传到</c>

627
00:28:57,571 --> 00:29:00,474
<c.magenta>updateStorePromotionVisibility</c>

628
00:28:57,571 --> 00:29:00,474
<c.magenta>updateStorePromotionVisibility</c>

629
00:29:00,908 --> 00:29:02,776
<c.magenta>还有你想设置的新可视性</c>

630
00:29:03,510 --> 00:29:05,179
<c.magenta>这里我们想将专业版订阅进行隐藏</c>

631
00:29:05,245 --> 00:29:06,547
<c.magenta>因为用户刚刚买了它</c>

632
00:29:08,482 --> 00:29:10,050
<c.magenta>就是这样了</c>

633
00:29:11,451 --> 00:29:13,887
<c.magenta>如果现在你想看看</c>

634
00:29:16,423 --> 00:29:18,325
<c.magenta>还是要从获取SKProduct开始</c>

635
00:29:18,525 --> 00:29:20,093
<c.magenta>这里让我们看下隐藏沙滩包</c>

636
00:29:21,428 --> 00:29:23,764
<c.magenta>把它传到fetch</c>

637
00:29:23,830 --> 00:29:24,831
<c.magenta>forProduct这个方法中</c>

638
00:29:25,832 --> 00:29:28,836
<c.magenta>我们可以发现 可视化被默认实现了</c>

639
00:29:29,136 --> 00:29:31,138
<c.magenta>这是因为我们还没有设置任何的重写</c>

640
00:29:31,738 --> 00:29:33,507
<c.magenta>这就意味着 它会隐藏或是显示</c>

641
00:29:33,574 --> 00:29:35,909
<c.magenta>取决于你在iTunes Connect</c>

642
00:29:39,780 --> 00:29:42,282
<c.magenta>我们已经介绍了重写可视性</c>

643
00:29:42,616 --> 00:29:43,717
<c.magenta>改变下顺序怎么样</c>

644
00:29:43,784 --> 00:29:45,819
<c.magenta>就是改变下你的程序内购买</c>

645
00:29:47,821 --> 00:29:49,323
<c.magenta>让我们回到</c>

646
00:29:51,225 --> 00:29:53,527
<c.magenta>你可能一直在看你的调查数据</c>

647
00:29:53,594 --> 00:29:56,363
<c.magenta>就会发现用户会去很多的沙滩</c>

648
00:29:57,431 --> 00:29:59,132
<c.magenta>这时候就可以把隐藏的沙滩移</c>

649
00:29:59,199 --> 00:30:02,569
<c.magenta>回列表的前面</c>

650
00:29:59,199 --> 00:30:02,569
<c.magenta>回列表的前面</c>

651
00:30:03,036 --> 00:30:04,905
<c.magenta>由于这是些他们感兴趣的东西</c>

652
00:30:04,972 --> 00:30:06,106
<c.magenta>他们可能会买它</c>

653
00:30:10,444 --> 00:30:14,281
<c.magenta>它的代码看起来和</c>

654
00:30:15,449 --> 00:30:18,886
<c.magenta>你要为每个想要重写的</c>

655
00:30:18,952 --> 00:30:20,521
<c.magenta>你想重写的是顺序</c>

656
00:30:20,587 --> 00:30:23,824
<c.magenta>我们会重写专业版订阅</c>

657
00:30:24,858 --> 00:30:27,895
<c.magenta>然后创建一个</c>

658
00:30:27,961 --> 00:30:30,163
<c.magenta>其顺序就是你想将它们重写的顺序</c>

659
00:30:30,631 --> 00:30:32,099
<c.magenta>我要把隐藏的沙滩移到最前面</c>

660
00:30:33,800 --> 00:30:37,404
<c.magenta>最后把这个数组传到</c>

661
00:30:38,872 --> 00:30:40,107
<c.magenta>这样就可以了 已经更新好了</c>

662
00:30:42,843 --> 00:30:45,179
<c.magenta>现在如果我们想看下已经设置好的重写</c>

663
00:30:46,213 --> 00:30:47,514
<c.magenta>这也是非常类似的</c>

664
00:30:48,448 --> 00:30:50,384
<c.magenta>你要获取storePromotionController</c>

665
00:30:50,651 --> 00:30:52,719
<c.magenta>还要使用</c>

666
00:30:54,388 --> 00:30:58,192
<c.magenta>这样我们就有了一个数组</c>

667
00:30:58,258 --> 00:30:59,793
<c.magenta>因为我们刚刚设置了它的重写</c>

668
00:31:01,828 --> 00:31:04,865
<c.magenta>你不需要用到数组中的每个程序内购买</c>

669
00:31:04,932 --> 00:31:06,233
<c.magenta>在你设置重写的时候</c>

670
00:31:06,333 --> 00:31:08,335
<c.magenta>你可以随意使用它们的子集</c>

671
00:31:09,002 --> 00:31:12,906
<c.magenta>如果你这么做的话</c>

672
00:31:13,674 --> 00:31:15,742
<c.magenta>以你表述重写的顺序进行排列</c>

673
00:31:16,176 --> 00:31:19,146
<c.magenta>你剩下的程序内购买会出现在它们后面</c>

674
00:31:19,213 --> 00:31:21,448
<c.magenta>跟你在iTunes Connect中</c>

675
00:31:23,116 --> 00:31:25,319
<c.magenta>你还可以从这个方法接收一个空数组</c>

676
00:31:25,719 --> 00:31:28,255
<c.magenta>这就意味着</c>

677
00:31:29,022 --> 00:31:32,726
<c.magenta>同样地</c>

678
00:31:32,926 --> 00:31:35,963
<c.magenta>这就相当于取消了所有的重写</c>

679
00:31:36,363 --> 00:31:39,466
<c.magenta>你可以将其看成是用了个重写的空集</c>

680
00:31:42,703 --> 00:31:45,272
<c.magenta>这就是用于推广程序内购买的所有代码</c>

681
00:31:46,139 --> 00:31:49,309
<c.magenta>新的代理方法和</c>

682
00:31:49,376 --> 00:31:51,478
<c.magenta>它们就在我们本周早些时候</c>

683
00:31:52,880 --> 00:31:55,883
<c.magenta>而顺序和可视性重写</c>

684
00:31:59,019 --> 00:32:00,888
<c.magenta>总结下推广程序内购买</c>

685
00:31:59,019 --> 00:32:00,888
<c.magenta>总结下推广程序内购买</c>

686
00:32:02,289 --> 00:32:03,657
<c.magenta>它可以让程序内购买更容易被找到</c>

687
00:32:03,724 --> 00:32:05,025
<c.magenta>通过将它们推广到</c>

688
00:32:06,293 --> 00:32:08,428
<c.magenta>你可以为每个应用选择最多20</c>

689
00:32:08,495 --> 00:32:09,897
<c.magenta>并在iTunes Connect中对它们进行设置</c>

690
00:32:11,265 --> 00:32:14,568
<c.magenta>然后用户就可在App Store中</c>

691
00:32:16,637 --> 00:32:18,639
<c.magenta>交易信息会被送到你的应用中</c>

692
00:32:18,705 --> 00:32:21,308
<c.magenta>在它通过新的代理方法自动打开的时候</c>

693
00:32:21,375 --> 00:32:23,844
<c.magenta>这些都发生在SKPayment</c>

694
00:32:25,646 --> 00:32:29,149
<c.magenta>最后 如果你想的话 你可以重写</c>

695
00:32:29,216 --> 00:32:32,186
<c.magenta>它们出现在应用页面上的顺序和可视性</c>

696
00:32:33,453 --> 00:32:34,488
<c.magenta>我很激动地想看看</c>

697
00:32:34,555 --> 00:32:36,657
<c.magenta>你们所有人会如何在应用中</c>

698
00:32:37,191 --> 00:32:39,193
<c.magenta>不过现在我还是将讲台交回给Pete</c>

699
00:32:48,068 --> 00:32:51,738
<c.magenta>谢谢 Ross 我迫不及待想试试</c>

700
00:32:51,805 --> 00:32:52,840
<c.magenta>看似是个不错的应用</c>

701
00:32:53,674 --> 00:32:56,310
<c.magenta>现在我们已经介绍了</c>

702
00:32:56,376 --> 00:32:58,011
<c.magenta>以及如何在App Store中</c>

703
00:32:58,278 --> 00:33:01,281
<c.magenta>让我们看下你可以用来跟</c>

704
00:32:58,278 --> 00:33:01,281
<c.magenta>让我们看下你可以用来跟</c>

705
00:33:02,549 --> 00:33:05,586
<c.magenta>在iOS 11中 我们有了这个</c>

706
00:33:06,186 --> 00:33:07,187
<c.magenta>这是个产品页面</c>

707
00:33:07,254 --> 00:33:11,358
<c.magenta>如果你向下滚动产品页面</c>

708
00:33:11,425 --> 00:33:13,327
<c.magenta>这里有个统一的评分</c>

709
00:33:13,794 --> 00:33:16,530
<c.magenta>用户可以滑动来切换不同的评论</c>

710
00:33:16,730 --> 00:33:20,534
<c.magenta>这样就可以阅读关于你</c>

711
00:33:20,667 --> 00:33:21,902
<c.magenta>这里有什么新东西呢？</c>

712
00:33:21,969 --> 00:33:23,904
<c.magenta>我们在这有一些新功能要介绍</c>

713
00:33:23,971 --> 00:33:27,341
<c.magenta>首先第一个 就是你现在可以选择</c>

714
00:33:27,541 --> 00:33:28,876
<c.magenta>当你发布应用的时候</c>

715
00:33:28,942 --> 00:33:30,844
<c.magenta>你可以选择要不要重置评分</c>

716
00:33:30,911 --> 00:33:33,914
<c.magenta>在原来 这样做会每次都重置你的评分</c>

717
00:33:33,981 --> 00:33:35,749
<c.magenta>而现在就完全取决于你了</c>

718
00:33:40,554 --> 00:33:42,523
<c.magenta>我们最近还加入了可以让你</c>

719
00:33:42,589 --> 00:33:44,157
<c.magenta>在App Store中</c>

720
00:33:44,224 --> 00:33:46,727
<c.magenta>现在你就可以和用户进行对话了</c>

721
00:33:47,561 --> 00:33:49,897
<c.magenta>还有些新的方法让你请求评分和评论</c>

722
00:33:49,963 --> 00:33:52,065
<c.magenta>它是通过SKStoreReviewController</c>

723
00:33:52,833 --> 00:33:56,270
<c.magenta>最后就是 我们在iOS 10.3中</c>

724
00:33:56,336 --> 00:33:59,273
<c.magenta>打开该链接就可以直接在</c>

725
00:34:00,507 --> 00:34:04,478
<c.magenta>我们还在iOS中加入了</c>

726
00:34:04,745 --> 00:34:05,746
<c.magenta>这看起来是什么样呢？</c>

727
00:34:06,013 --> 00:34:09,049
<c.magenta>现在用户可以在评论上</c>

728
00:34:09,116 --> 00:34:12,052
<c.magenta>这样他们就可以看到</c>

729
00:34:12,119 --> 00:34:13,920
<c.magenta>他们可将其标记为有帮助</c>

730
00:34:13,987 --> 00:34:17,024
<c.magenta>他们甚至可以直接在iOS 应用中</c>

731
00:34:19,359 --> 00:34:23,197
<c.magenta>我们是在iOS 10.3中</c>

732
00:34:23,263 --> 00:34:24,864
<c.magenta>而这个功能的反响是非常不错的</c>

733
00:34:25,264 --> 00:34:26,667
<c.magenta>我们觉得用户很喜欢该功能</c>

734
00:34:26,733 --> 00:34:29,536
<c.magenta>而且我们看到开发者真的</c>

735
00:34:29,703 --> 00:34:31,438
<c.magenta>当你回复某个用户评论时</c>

736
00:34:31,505 --> 00:34:33,507
<c.magenta>用户会在他们的设备上获得一条通知</c>

737
00:34:33,574 --> 00:34:35,708
<c.magenta>通知他们你有回复了</c>

738
00:34:36,143 --> 00:34:37,710
<c.magenta>他们还会收到一封邮件</c>

739
00:34:38,011 --> 00:34:40,647
<c.magenta>其中详细地写了关于他们评论的回复</c>

740
00:34:41,114 --> 00:34:42,114
<c.magenta>在这封邮件的最下面</c>

741
00:34:42,181 --> 00:34:43,417
<c.magenta>有一个链接</c>

742
00:34:43,516 --> 00:34:44,818
<c.magenta>可以让他们更新评论</c>

743
00:34:44,885 --> 00:34:45,953
<c.magenta>我们给了他们这个机会</c>

744
00:34:46,018 --> 00:34:47,254
<c.magenta>来点击该链接</c>

745
00:34:47,454 --> 00:34:49,590
<c.magenta>他们就有机会编辑他们的评分</c>

746
00:34:49,656 --> 00:34:51,525
<c.magenta>或者还会更改他们的评论</c>

747
00:34:52,092 --> 00:34:53,893
<c.magenta>并且我们发现在用户这么做的时候</c>

748
00:34:53,960 --> 00:34:56,597
<c.magenta>当他们在收到回复后更新评论的时候</c>

749
00:34:56,730 --> 00:35:00,434
<c.magenta>我们发现评论会平均增加</c>

750
00:34:56,730 --> 00:35:00,434
<c.magenta>我们发现评论会平均增加</c>

751
00:35:00,701 --> 00:35:04,238
<c.magenta>正如你所见</c>

752
00:35:04,304 --> 00:35:05,806
<c.magenta>这会让你的用户获得更棒的体验</c>

753
00:35:05,873 --> 00:35:08,876
<c.magenta>也会让你的应用</c>

754
00:35:09,776 --> 00:35:13,380
<c.magenta>有关这方面的更多信息</c>

755
00:35:13,614 --> 00:35:16,750
<c.magenta>回复评分 还有跟用户进行交流的</c>

756
00:35:17,184 --> 00:35:18,085
<c.magenta>我们也在</c>

757
00:35:18,151 --> 00:35:19,987
<c.magenta>昨天举办的“iTunes Connect</c>

758
00:35:20,053 --> 00:35:22,422
<c.magenta>如果你没有去听的话 我建议你们</c>

759
00:35:22,489 --> 00:35:23,891
<c.magenta>去看下那场演讲的视频</c>

760
00:35:25,826 --> 00:35:27,361
<c.magenta>在提到接收评论的时候</c>

761
00:35:27,427 --> 00:35:29,129
<c.magenta>现在你有几种方法可以实现这个功能</c>

762
00:35:29,196 --> 00:35:33,700
<c.magenta>你可以在SKStoreReviewController</c>

763
00:35:34,101 --> 00:35:35,302
<c.magenta>我们还提供了这个深度链接</c>

764
00:35:35,369 --> 00:35:37,938
<c.magenta>来让你直接在App Store中</c>

765
00:35:38,772 --> 00:35:41,341
<c.magenta>首先让我们看下</c>

766
00:35:41,408 --> 00:35:44,211
<c.magenta>这是我们在iOS 10.3中</c>

767
00:35:44,278 --> 00:35:46,947
<c.magenta>它提供了一个非常简洁美观的界面</c>

768
00:35:47,014 --> 00:35:49,950
<c.magenta>让用户可以不用离开你的应用就能评分</c>

769
00:35:50,017 --> 00:35:52,352
<c.magenta>现在他们可以点击星数</c>

770
00:35:52,519 --> 00:35:55,122
<c.magenta>对你的应用进行评分</c>

771
00:35:55,189 --> 00:35:57,791
<c.magenta>他们现在甚至不用离开你的应用</c>

772
00:35:58,859 --> 00:36:02,829
<c.magenta>如果你现在还在用其他的警告</c>

773
00:35:58,859 --> 00:36:02,829
<c.magenta>如果你现在还在用其他的警告</c>

774
00:36:02,896 --> 00:36:05,332
<c.magenta>我强烈建议你们开始使用这个API</c>

775
00:36:05,399 --> 00:36:06,400
<c.magenta>因为在未来某个时候</c>

776
00:36:06,466 --> 00:36:09,236
<c.magenta>我们会开始要求任何弹出框显示</c>

777
00:36:09,303 --> 00:36:13,106
<c.magenta>任何弹出请求评论</c>

778
00:36:13,440 --> 00:36:16,243
<c.magenta>对于使用这个API还有几个限制</c>

779
00:36:17,711 --> 00:36:19,680
<c.magenta>对于每台设备请求数是有限制的</c>

780
00:36:19,746 --> 00:36:23,717
<c.magenta>我们会限制用户被这些提醒轰炸的次数</c>

781
00:36:23,784 --> 00:36:26,787
<c.magenta>现在iOS 11中 用户可在</c>

782
00:36:26,854 --> 00:36:28,388
<c.magenta>他们可以进入App store设置</c>

783
00:36:28,755 --> 00:36:31,558
<c.magenta>点击下开关就可以将</c>

784
00:36:31,825 --> 00:36:33,560
<c.magenta>我们觉得这会是个不错的体验</c>

785
00:36:33,627 --> 00:36:35,295
<c.magenta>对于用户和开发者来说都是</c>

786
00:36:36,930 --> 00:36:39,099
<c.magenta>这里有些如何实现此功能的小技巧</c>

787
00:36:40,334 --> 00:36:43,537
<c.magenta>SKStoreReviewController是个弹出框</c>

788
00:36:43,604 --> 00:36:46,206
<c.magenta>所以你最好实现这个功能的时候</c>

789
00:36:46,273 --> 00:36:47,608
<c.magenta>是在某些用户交互的尾声</c>

790
00:36:47,674 --> 00:36:49,743
<c.magenta>可能是在用户已经完成了某项任务之后</c>

791
00:36:50,010 --> 00:36:52,746
<c.magenta>就可以借此机会</c>

792
00:36:52,813 --> 00:36:54,982
<c.magenta>不要在他们正在做什么事情时</c>

793
00:36:55,949 --> 00:36:58,719
<c.magenta>你也不适合用按钮来使用这个API</c>

794
00:36:58,785 --> 00:37:01,655
<c.magenta>因为你不能保证会有UI能呈现给用户</c>

795
00:36:58,785 --> 00:37:01,655
<c.magenta>因为你不能保证会有UI能呈现给用户</c>

796
00:37:01,855 --> 00:37:03,524
<c.magenta>基于我们刚才看到的那些限制</c>

797
00:37:04,024 --> 00:37:08,028
<c.magenta>所以通过你的应用中的嵌入式链接</c>

798
00:37:08,929 --> 00:37:11,031
<c.magenta>不过如果你真要这么做</c>

799
00:37:11,098 --> 00:37:12,366
<c.magenta>就是一行代码</c>

800
00:37:12,699 --> 00:37:14,434
<c.magenta>但你可把它包含到</c>

801
00:37:14,501 --> 00:37:17,471
<c.magenta>在本例中 我们在检查这个用户是不是</c>

802
00:37:17,538 --> 00:37:20,073
<c.magenta>那种我们想要请求写评论的用户</c>

803
00:37:21,074 --> 00:37:22,676
<c.magenta>如果我们确定他们是的话</c>

804
00:37:22,976 --> 00:37:25,279
<c.magenta>我们就可以调用</c>

805
00:37:25,345 --> 00:37:27,047
<c.magenta>的requestReview方法了</c>

806
00:37:27,281 --> 00:37:28,482
<c.magenta>你只需要调用这个方法</c>

807
00:37:28,549 --> 00:37:30,317
<c.magenta>该方法会将评分弹出框呈现给用户</c>

808
00:37:30,384 --> 00:37:32,252
<c.magenta>当他们在使用你的应用时</c>

809
00:37:34,855 --> 00:37:37,824
<c.magenta>另一种方法当然就是我刚才提到的</c>

810
00:37:39,059 --> 00:37:41,528
<c.magenta>它其实也是在</c>

811
00:37:41,595 --> 00:37:42,963
<c.magenta>不过我们现在会介绍一下它</c>

812
00:37:43,163 --> 00:37:46,133
<c.magenta>它会为你提供一个可以打开</c>

813
00:37:46,266 --> 00:37:48,702
<c.magenta>该链接可以立刻给你显示写评论的表单</c>

814
00:37:48,769 --> 00:37:51,004
<c.magenta>或是本例中这样对评论进行编辑</c>

815
00:37:51,638 --> 00:37:54,174
<c.magenta>它对于像是用户初始化动作</c>

816
00:37:54,241 --> 00:37:57,077
<c.magenta>在这里你可能想在应用中</c>

817
00:37:57,144 --> 00:37:59,980
<c.magenta>可能是你设置里的一个用来在</c>

818
00:38:00,314 --> 00:38:03,317
<c.magenta>这对于SKStoreReviewController</c>

819
00:38:03,383 --> 00:38:05,352
<c.magenta>你可以当它想成是完全相反的</c>

820
00:38:05,586 --> 00:38:07,788
<c.magenta>所以设置中的按钮更为合适</c>

821
00:38:07,855 --> 00:38:10,357
<c.magenta>或者是你应用中的某些嵌入内容</c>

822
00:38:10,424 --> 00:38:12,793
<c.magenta>因为它提供的是持续的体验</c>

823
00:38:12,860 --> 00:38:14,628
<c.magenta>可以保证会发生的操作</c>

824
00:38:15,529 --> 00:38:17,531
<c.magenta>然而 通过警告来使用并不合适</c>

825
00:38:17,598 --> 00:38:20,601
<c.magenta>我刚才提过</c>

826
00:38:20,667 --> 00:38:23,670
<c.magenta>请确保你已经开始用</c>

827
00:38:26,540 --> 00:38:28,475
<c.magenta>这就是你生成深度链接的方法</c>

828
00:38:29,443 --> 00:38:31,578
<c.magenta>这里你有应用页面的URL</c>

829
00:38:31,645 --> 00:38:33,514
<c.magenta>你可以从链接制作网站来在线获取</c>

830
00:38:33,580 --> 00:38:34,848
<c.magenta>如果你还不知道的话</c>

831
00:38:35,282 --> 00:38:37,084
<c.magenta>你可以把查询参数操作</c>

832
00:38:37,150 --> 00:38:38,986
<c.magenta>等于写评论</c>

833
00:38:39,453 --> 00:38:41,388
<c.magenta>这就意味着</c>

834
00:38:41,488 --> 00:38:43,257
<c.magenta>他们会看到这个写评论表单</c>

835
00:38:46,093 --> 00:38:48,195
<c.magenta>有关评分和评论的更多信息</c>

836
00:38:48,262 --> 00:38:49,696
<c.magenta>还有我们之前介绍过的今年的一些改变</c>

837
00:38:49,763 --> 00:38:52,432
<c.magenta>我建议你们去看下</c>

838
00:38:52,766 --> 00:38:54,001
<c.magenta>我们在那有更多关于这方面的信息</c>

839
00:38:55,736 --> 00:38:57,771
<c.magenta>我们今天介绍了几个新功能</c>

840
00:38:57,838 --> 00:38:59,239
<c.magenta>包括StoreKit新特性</c>

841
00:38:59,506 --> 00:39:01,708
<c.magenta>总结一下 我们介绍了</c>

842
00:38:59,506 --> 00:39:01,708
<c.magenta>总结一下 我们介绍了</c>

843
00:39:01,775 --> 00:39:03,810
<c.magenta>在你的应用中实现程序内购买的方法</c>

844
00:39:03,877 --> 00:39:06,246
<c.magenta>也就是实现程序内购买的七步流程</c>

845
00:39:06,580 --> 00:39:08,348
<c.magenta>Ross上台给你们介绍了</c>

846
00:39:08,415 --> 00:39:10,117
<c.magenta>你们可以用这些方法来推广程序内购买</c>

847
00:39:10,184 --> 00:39:11,285
<c.magenta>直接在App Store中</c>

848
00:39:11,351 --> 00:39:14,354
<c.magenta>你现就可以在用户浏览App Store</c>

849
00:39:15,355 --> 00:39:16,924
<c.magenta>我们介绍了新的</c>

850
00:39:16,990 --> 00:39:19,293
<c.magenta>新的评分和评论区域</c>

851
00:39:19,393 --> 00:39:20,794
<c.magenta>包括开发者的回复</c>

852
00:39:21,028 --> 00:39:22,930
<c.magenta>并且我们发现 使用了开发者回复后</c>

853
00:39:22,996 --> 00:39:24,398
<c.magenta>我们就会有很大的机会</c>

854
00:39:24,464 --> 00:39:27,201
<c.magenta>可以看到你的评分和评论有了改善</c>

855
00:39:27,367 --> 00:39:29,536
<c.magenta>同时还会获得更好的用户体验</c>

856
00:39:31,538 --> 00:39:35,108
<c.magenta>有关本场演讲的更多信息</c>

857
00:39:35,175 --> 00:39:36,577
<c.magenta>这是演讲303</c>

858
00:39:37,678 --> 00:39:40,280
<c.magenta>本场演讲还有一些相关的演讲</c>

859
00:39:40,347 --> 00:39:42,049
<c.magenta>“高级StoreKit”演讲</c>

860
00:39:42,149 --> 00:39:44,651
<c.magenta>我希望能在那场演讲上看到你们</c>

861
00:39:44,718 --> 00:39:47,588
<c.magenta>我们还介绍了关于</c>

862
00:39:47,654 --> 00:39:50,090
<c.magenta>我们会深入介绍订阅管理</c>

863
00:39:50,157 --> 00:39:52,559
<c.magenta>跨服务器环境的持续性状态</c>

864
00:39:52,626 --> 00:39:56,230
<c.magenta>所以请来参加一下那场演讲</c>

865
00:39:56,563 --> 00:39:57,831
<c.magenta>不过今天就是这些内容了</c>

866
00:39:57,898 --> 00:39:59,132
<c.magenta>感谢你们来参加本场演讲</c>

867
00:39:59,199 --> 00:40:00,200
<c.magenta>希望你们享用很棒的午餐</c>
