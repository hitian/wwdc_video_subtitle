1
00:00:17,651 --> 00:00:22,990
<c.magenta>（Core Data新特性是什么？</c>

2
00:00:26,159 --> 00:00:29,563
<c.magenta>大家好 欢迎来到演讲210</c>

3
00:00:30,297 --> 00:00:31,298
<c.magenta>我是梅利莎</c>

4
00:00:31,365 --> 00:00:32,966
<c.magenta>Core Data的工程师</c>

5
00:00:33,033 --> 00:00:36,436
<c.magenta>今天我的同事瑞希</c>

6
00:00:37,070 --> 00:00:39,673
<c.magenta>我们将会介绍</c>

7
00:00:39,740 --> 00:00:41,441
<c.magenta>过去一年里</c>

8
00:00:41,508 --> 00:00:42,943
<c.magenta>这项工作对我们来说充满乐趣</c>

9
00:00:43,010 --> 00:00:44,578
<c.magenta>希望你们也会觉得有趣</c>

10
00:00:44,645 --> 00:00:47,681
<c.magenta>而且对你们的应用开发有用处</c>

11
00:00:48,215 --> 00:00:50,684
<c.magenta>我们希望本场演讲中</c>

12
00:00:50,751 --> 00:00:51,852
<c.magenta>大家都曾经遇到过</c>

13
00:00:52,252 --> 00:00:53,887
<c.magenta>（路线图）</c>

14
00:00:53,987 --> 00:00:55,322
<c.magenta>那么 我们在做些什么呢？</c>

15
00:00:55,956 --> 00:00:58,025
<c.magenta>我们一直在做</c>

16
00:00:58,959 --> 00:01:00,894
<c.magenta>我们已经增加一系列的</c>

17
00:00:58,959 --> 00:01:00,894
<c.magenta>我们已经增加一系列的</c>

18
00:01:00,961 --> 00:01:03,697
<c.magenta>我们还增加了另外一项重要功能</c>

19
00:01:03,764 --> 00:01:05,532
<c.magenta>瑞希将会介绍这项功能</c>

20
00:01:05,799 --> 00:01:06,967
<c.magenta>这是一项很酷的功能</c>

21
00:01:07,034 --> 00:01:08,902
<c.magenta>我很高兴能够在这里为大家展示</c>

22
00:01:09,837 --> 00:01:13,006
<c.magenta>首先让阿方斯给大家打一声招呼</c>

23
00:01:14,441 --> 00:01:15,442
<c.magenta>那么Core Spotlight</c>

24
00:01:16,276 --> 00:01:17,477
<c.magenta>什么是Core Spotlight？</c>

25
00:01:18,345 --> 00:01:19,446
<c.magenta>讨论Core Spotlight之前</c>

26
00:01:19,513 --> 00:01:21,281
<c.magenta>首先让我谈谈Spotlight</c>

27
00:01:21,815 --> 00:01:25,219
<c.magenta>Spotlight是原创性的搜索API</c>

28
00:01:25,285 --> 00:01:28,322
<c.magenta>它以文档为中心</c>

29
00:01:28,589 --> 00:01:30,624
<c.magenta>在Spotlight菜单中</c>

30
00:01:30,691 --> 00:01:33,393
<c.magenta>进行搜索操作</c>

31
00:01:33,460 --> 00:01:36,263
<c.magenta>所获得的搜索结果</c>

32
00:01:36,330 --> 00:01:38,365
<c.magenta>检索到的文档</c>

33
00:01:38,432 --> 00:01:41,201
<c.magenta>但是不会告诉你</c>

34
00:01:42,102 --> 00:01:43,737
<c.magenta>对于数据库来说</c>

35
00:01:43,804 --> 00:01:46,006
<c.magenta>我们知道</c>

36
00:01:47,541 --> 00:01:48,876
<c.magenta>于是我们推出了</c>

37
00:01:49,343 --> 00:01:50,811
<c.magenta>Core Spotlight是iOS上的</c>

38
00:01:50,878 --> 00:01:52,446
<c.magenta>原创性搜索技术</c>

39
00:01:52,513 --> 00:01:54,381
<c.magenta>它十分适合数据库</c>

40
00:01:54,781 --> 00:01:58,652
<c.magenta>它不仅会返回</c>

41
00:01:58,986 --> 00:02:00,454
<c.magenta>应用程序和文档</c>

42
00:01:58,986 --> 00:02:00,454
<c.magenta>应用程序和文档</c>

43
00:02:00,787 --> 00:02:02,723
<c.magenta>而且会告诉你</c>

44
00:02:03,123 --> 00:02:05,058
<c.magenta>你可以在你的应用程序中</c>

45
00:02:05,125 --> 00:02:09,530
<c.magenta>这样就可以提供</c>

46
00:02:09,696 --> 00:02:12,065
<c.magenta>现在Mac OS和iOS</c>

47
00:02:12,132 --> 00:02:15,068
<c.magenta>我们认为现在应该将它集成到</c>

48
00:02:16,503 --> 00:02:18,071
<c.magenta>那么Core Spotlight</c>

49
00:02:18,138 --> 00:02:19,306
<c.magenta>它与Spotlight十分相似</c>

50
00:02:19,573 --> 00:02:20,807
<c.magenta>当你安装一个应用之后</c>

51
00:02:20,874 --> 00:02:21,975
<c.magenta>里面会有很多的数据</c>

52
00:02:23,043 --> 00:02:25,512
<c.magenta>用户进入Spotlight菜单</c>

53
00:02:25,579 --> 00:02:26,947
<c.magenta>查找应用之中的数据内容</c>

54
00:02:27,147 --> 00:02:29,750
<c.magenta>比如 一张印度照片</c>

55
00:02:30,384 --> 00:02:36,423
<c.magenta>Spotlight会启动你的应用</c>

56
00:02:38,592 --> 00:02:40,260
<c.magenta>你可以用它</c>

57
00:02:40,327 --> 00:02:42,396
<c.magenta>检索用户想要查找的信息</c>

58
00:02:43,096 --> 00:02:46,033
<c.magenta>弹出指定窗口</c>

59
00:02:47,768 --> 00:02:51,138
<c.magenta>前面我说过 现在</c>

60
00:02:51,438 --> 00:02:54,141
<c.magenta>今天Core Spotlight团队</c>

61
00:02:54,575 --> 00:02:56,210
<c.magenta>你们也可以使用</c>

62
00:02:56,276 --> 00:02:59,446
<c.magenta>在你们的应用中</c>

63
00:02:59,513 --> 00:03:00,514
<c.magenta>这真的很酷</c>

64
00:02:59,513 --> 00:03:00,514
<c.magenta>这真的很酷</c>

65
00:03:00,948 --> 00:03:02,115
<c.magenta>它可以完成这些功能</c>

66
00:03:02,282 --> 00:03:04,718
<c.magenta>而不会造成在系统中</c>

67
00:03:05,152 --> 00:03:06,253
<c.magenta>我真的非常希望</c>

68
00:03:06,320 --> 00:03:09,189
<c.magenta>你们喜欢这个功能</c>

69
00:03:11,525 --> 00:03:12,526
<c.magenta>它是如何运作的呢？</c>

70
00:03:12,593 --> 00:03:15,128
<c.magenta>Core Spotlight集成</c>

71
00:03:15,195 --> 00:03:16,763
<c.magenta>第一个是…</c>

72
00:03:17,197 --> 00:03:20,868
<c.magenta>我们已经在NSPropertyDescription上</c>

73
00:03:20,934 --> 00:03:23,904
<c.magenta>用它指示属性</c>

74
00:03:25,138 --> 00:03:27,307
<c.magenta>但我们需要一种方法来说明</c>

75
00:03:27,374 --> 00:03:28,709
<c.magenta>应该显示哪些内容</c>

76
00:03:28,876 --> 00:03:29,877
<c.magenta>我们的表达式为：</c>

77
00:03:29,943 --> 00:03:32,646
<c.magenta>NSEntityDescription.</c>

78
00:03:33,013 --> 00:03:34,615
<c.magenta>当然还有Exporter</c>

79
00:03:34,681 --> 00:03:36,617
<c.magenta>无论何时在应用中进行存储</c>

80
00:03:36,950 --> 00:03:40,454
<c.magenta>无论将用户进行的任何更改</c>

81
00:03:42,089 --> 00:03:44,091
<c.magenta>CoreSpotlightDisplayNameExpression</c>

82
00:03:44,157 --> 00:03:46,360
<c.magenta>都能够理解这些操作</c>

83
00:03:46,426 --> 00:03:48,161
<c.magenta>它其实是NSExpression</c>

84
00:03:48,228 --> 00:03:51,365
<c.magenta>你将它设置为</c>

85
00:03:51,965 --> 00:03:55,335
<c.magenta>在Core Spotlight索引更新时</c>

86
00:03:55,936 --> 00:03:56,970
<c.magenta>在对象方面…</c>

87
00:03:57,037 --> 00:04:00,474
<c.magenta>经过更新的托管对象</c>

88
00:03:57,037 --> 00:04:00,474
<c.magenta>经过更新的托管对象</c>

89
00:04:00,908 --> 00:04:04,044
<c.magenta>这样就能够返回</c>

90
00:04:04,111 --> 00:04:06,380
<c.magenta>甚至不是</c>

91
00:04:06,446 --> 00:04:09,016
<c.magenta>比如 一个</c>

92
00:04:09,750 --> 00:04:12,452
<c.magenta>这些表达式</c>

93
00:04:12,519 --> 00:04:14,354
<c.magenta>但是 更有趣的是</c>

94
00:04:14,421 --> 00:04:17,925
<c.magenta>它们可以是内建函数</c>

95
00:04:18,325 --> 00:04:21,428
<c.magenta>当然 如果你也可以像我一样</c>

96
00:04:21,495 --> 00:04:25,666
<c.magenta>在你的运行时 寻找类实例</c>

97
00:04:25,732 --> 00:04:28,635
<c.magenta>调用随机方法以获取内容</c>

98
00:04:29,636 --> 00:04:30,704
<c.magenta>这是很酷的功能</c>

99
00:04:32,439 --> 00:04:34,474
<c.magenta>当然</c>

100
00:04:34,541 --> 00:04:36,777
<c.magenta>它相当于一大块的代码</c>

101
00:04:36,844 --> 00:04:37,911
<c.magenta>完成所有工作</c>

102
00:04:38,846 --> 00:04:41,381
<c.magenta>它实现CSSearchableIndexDelegate</c>

103
00:04:41,582 --> 00:04:44,017
<c.magenta>提供所有方法的实现</c>

104
00:04:44,084 --> 00:04:45,619
<c.magenta>你可以直接使用它</c>

105
00:04:46,553 --> 00:04:48,388
<c.magenta>它在后台线程上使用单独的存储空间</c>

106
00:04:48,455 --> 00:04:50,157
<c.magenta>因此你不需要担心</c>

107
00:04:50,224 --> 00:04:52,259
<c.magenta>Spotlight Exporter</c>

108
00:04:52,326 --> 00:04:55,629
<c.magenta>阻止你的主视图上下文完成其工作</c>

109
00:04:56,463 --> 00:04:57,297
<c.magenta>你可以使用</c>

110
00:04:57,364 --> 00:04:59,800
<c.magenta>NSPersistentStoreDescription</c>

111
00:04:59,867 --> 00:05:01,935
<c.magenta>因此它需要知道其处理的工作是什么</c>

112
00:04:59,867 --> 00:05:01,935
<c.magenta>因此它需要知道其处理的工作是什么</c>

113
00:05:02,870 --> 00:05:05,172
<c.magenta>你告诉Persistent Store</c>

114
00:05:05,239 --> 00:05:09,076
<c.magenta>它应该通过</c>

115
00:05:09,543 --> 00:05:12,145
<c.magenta>将其内容导出到</c>

116
00:05:12,212 --> 00:05:15,215
<c.magenta>当你在PersistentStoreCoordinator上</c>

117
00:05:15,482 --> 00:05:16,750
<c.magenta>调用NSPersistentStore</c>

118
00:05:17,451 --> 00:05:20,988
<c.magenta>如果你不喜欢默认行为</c>

119
00:05:21,054 --> 00:05:25,826
<c.magenta>重写方法是 NSDataCoreSpotlight</c>

120
00:05:26,126 --> 00:05:28,495
<c.magenta>重写方法可能是这样的</c>

121
00:05:28,896 --> 00:05:30,864
<c.magenta>我们有一个基本方法</c>

122
00:05:30,931 --> 00:05:33,600
<c.magenta>它获取超类返回的属性集</c>

123
00:05:34,601 --> 00:05:37,371
<c.magenta>它通过对象发现</c>

124
00:05:37,437 --> 00:05:40,607
<c.magenta>因为这是一个照片应用</c>

125
00:05:40,674 --> 00:05:42,743
<c.magenta>当有人搜索内容时…</c>

126
00:05:43,844 --> 00:05:46,847
<c.magenta>当用户搜索内容时</c>

127
00:05:46,914 --> 00:05:49,183
<c.magenta>我想要返回一张</c>

128
00:05:49,550 --> 00:05:51,351
<c.magenta>因此标记本身并不吸引人</c>

129
00:05:51,885 --> 00:05:53,987
<c.magenta>因此我会把所有标记信息</c>

130
00:05:54,054 --> 00:05:57,491
<c.magenta>堆集到照片对象上</c>

131
00:05:57,691 --> 00:05:59,226
<c.magenta>将会返回照片</c>

132
00:06:00,027 --> 00:06:02,029
<c.magenta>然后我返回属性集</c>

133
00:06:02,663 --> 00:06:04,665
<c.magenta>你们大多数人</c>

134
00:06:04,731 --> 00:06:05,966
<c.magenta>来实现此功能</c>

135
00:06:07,901 --> 00:06:09,002
<c.magenta>现在我进行演示</c>

136
00:06:09,369 --> 00:06:10,404
<c.magenta>（演示）</c>

137
00:06:16,410 --> 00:06:17,978
<c.magenta>这里有一个小应用</c>

138
00:06:20,247 --> 00:06:22,349
<c.magenta>请忽略后面的X Code</c>

139
00:06:23,917 --> 00:06:25,485
<c.magenta>这个应用显示照片</c>

140
00:06:26,220 --> 00:06:27,754
<c.magenta>你可以滚动 查看内容</c>

141
00:06:29,489 --> 00:06:32,659
<c.magenta>点击可以查看</c>

142
00:06:33,794 --> 00:06:34,995
<c.magenta>是各种各样的人像照片</c>

143
00:06:35,062 --> 00:06:36,730
<c.magenta>含有少量的元数据信息</c>

144
00:06:37,231 --> 00:06:38,232
<c.magenta>但是有趣的是</c>

145
00:06:38,832 --> 00:06:41,602
<c.magenta>现在我可以调出Spotlight</c>

146
00:06:44,171 --> 00:06:48,842
<c.magenta>例如 在Spotlight中</c>

147
00:06:48,909 --> 00:06:51,712
<c.magenta>它会自动激活我的应用</c>

148
00:06:51,778 --> 00:06:55,215
<c.magenta>调用application</c>

149
00:06:55,549 --> 00:06:56,917
<c.magenta>使用NS user activity</c>

150
00:06:57,317 --> 00:07:00,521
<c.magenta>我已经跳入这个方法</c>

151
00:06:57,317 --> 00:07:00,521
<c.magenta>我已经跳入这个方法</c>

152
00:07:00,687 --> 00:07:03,390
<c.magenta>“有人打开了某物”</c>

153
00:07:03,624 --> 00:07:07,261
<c.magenta>我要挖掘用户活动用户信息</c>

154
00:07:07,327 --> 00:07:09,096
<c.magenta>因为那里有我们需要的内容</c>

155
00:07:10,497 --> 00:07:11,798
<c.magenta>然后查找标识符</c>

156
00:07:12,432 --> 00:07:14,434
<c.magenta>如果我打印出标识符</c>

157
00:07:14,635 --> 00:07:18,539
<c.magenta>有很多的标识符和用户信息</c>

158
00:07:18,605 --> 00:07:21,108
<c.magenta>是托管对象ID</c>

159
00:07:21,608 --> 00:07:24,411
<c.magenta>我要将它转换成为URI</c>

160
00:07:24,711 --> 00:07:28,282
<c.magenta>要求persistent StoreCoordinator</c>

161
00:07:30,717 --> 00:07:31,985
<c.magenta>然后我继续</c>

162
00:07:33,854 --> 00:07:34,922
<c.magenta>哇</c>

163
00:07:36,623 --> 00:07:40,093
<c.magenta>我打开了用户请求的照片</c>

164
00:07:40,928 --> 00:07:43,964
<c.magenta>多么可爱的视图</c>

165
00:07:46,366 --> 00:07:47,201
<c.magenta>这就是</c>

166
00:07:47,768 --> 00:07:49,870
<c.magenta>Core Spotlight Integration工作原理</c>

167
00:07:49,937 --> 00:07:51,238
<c.magenta>我们已经完成大部分工作</c>

168
00:07:51,305 --> 00:07:56,176
<c.magenta>你需要实现方法就可以了</c>

169
00:07:56,877 --> 00:07:58,512
<c.magenta>这就是Core Spotlight Integration</c>

170
00:07:59,379 --> 00:08:00,948
<c.magenta>（便利之处）</c>

171
00:07:59,379 --> 00:08:00,948
<c.magenta>（便利之处）</c>

172
00:08:01,014 --> 00:08:03,984
<c.magenta>我们为你提供一些</c>

173
00:08:04,451 --> 00:08:06,820
<c.magenta>如果你决定启用</c>

174
00:08:07,354 --> 00:08:09,990
<c.magenta>传递exporter至…</c>

175
00:08:10,057 --> 00:08:12,259
<c.magenta>当你添加store到persistent</c>

176
00:08:12,659 --> 00:08:14,361
<c.magenta>当你的应用首次启动时</c>

177
00:08:14,428 --> 00:08:16,797
<c.magenta>我们将自动开始导出到</c>

178
00:08:16,864 --> 00:08:19,766
<c.magenta>将会继续导出</c>

179
00:08:19,833 --> 00:08:21,835
<c.magenta>即使你的应用已经退出</c>

180
00:08:21,902 --> 00:08:23,837
<c.magenta>如果你的用户同时退出应用</c>

181
00:08:24,304 --> 00:08:25,873
<c.magenta>我们使用持续性历史跟踪功能</c>

182
00:08:25,939 --> 00:08:27,574
<c.magenta>确保所有数据被推入</c>

183
00:08:28,075 --> 00:08:30,544
<c.magenta>即使你的应用崩溃 退出</c>

184
00:08:31,078 --> 00:08:33,145
<c.magenta>运行不正常</c>

185
00:08:35,249 --> 00:08:36,450
<c.magenta>（不便之处）</c>

186
00:08:36,517 --> 00:08:37,818
<c.magenta>有少量的不便之处</c>

187
00:08:37,885 --> 00:08:39,653
<c.magenta>Core Spotlight</c>

188
00:08:39,720 --> 00:08:41,722
<c.magenta>如果你同时实现这两种功能</c>

189
00:08:41,788 --> 00:08:43,890
<c.magenta>如果你将实体设置到</c>

190
00:08:44,458 --> 00:08:48,362
<c.magenta>Display Name Expression</c>

191
00:08:49,496 --> 00:08:51,298
<c.magenta>模型编译器将会报错</c>

192
00:08:52,132 --> 00:08:54,735
<c.magenta>目前我们不追踪</c>

193
00:08:56,770 --> 00:08:58,138
<c.magenta>一些不便之处</c>

194
00:08:58,205 --> 00:09:00,374
<c.magenta>第一个是我在调试时发现的</c>

195
00:08:58,205 --> 00:09:00,374
<c.magenta>第一个是我在调试时发现的</c>

196
00:09:00,440 --> 00:09:03,277
<c.magenta>因为我在单独框架中</c>

197
00:09:03,343 --> 00:09:06,747
<c.magenta>由XCTest运行</c>

198
00:09:06,813 --> 00:09:09,550
<c.magenta>这会造成困惑</c>

199
00:09:10,350 --> 00:09:12,719
<c.magenta>无论任何应用</c>

200
00:09:12,786 --> 00:09:16,723
<c.magenta>都需要com.apple.</c>

201
00:09:17,157 --> 00:09:18,458
<c.magenta>你们大多数都会默认获得授权</c>

202
00:09:18,525 --> 00:09:21,562
<c.magenta>但是如果你想要编写单元测试</c>

203
00:09:22,229 --> 00:09:23,230
<c.magenta>请认识到这一点</c>

204
00:09:23,463 --> 00:09:25,532
<c.magenta>当然你需要处理搜索结果</c>

205
00:09:26,934 --> 00:09:29,002
<c.magenta>你需在application delegate上</c>

206
00:09:30,237 --> 00:09:32,773
<c.magenta>实现Application</c>

207
00:09:33,140 --> 00:09:34,908
<c.magenta>设置你想要的内容</c>

208
00:09:35,209 --> 00:09:36,710
<c.magenta>我们可以在屏幕上看到</c>

209
00:09:37,177 --> 00:09:39,446
<c.magenta>也可以在演示中看到</c>

210
00:09:39,880 --> 00:09:41,281
<c.magenta>这是你们要实现的方法</c>

211
00:09:41,682 --> 00:09:44,685
<c.magenta>非常简单 抓取用户活动用户信息</c>

212
00:09:45,819 --> 00:09:48,622
<c.magenta>托管对象ID标识符位于这里</c>

213
00:09:48,689 --> 00:09:51,258
<c.magenta>隶属于KCS Searchable Item</c>

214
00:09:52,192 --> 00:09:54,027
<c.magenta>我已经把它转换为托管对象ID</c>

215
00:09:54,494 --> 00:09:56,129
<c.magenta>然后你们就可以进行想要的操作</c>

216
00:09:56,964 --> 00:10:00,767
<c.magenta>比如查看新窗口</c>

217
00:09:56,964 --> 00:10:00,767
<c.magenta>比如查看新窗口</c>

218
00:10:02,836 --> 00:10:05,005
<c.magenta>存在一些不便之处</c>

219
00:10:05,172 --> 00:10:07,708
<c.magenta>如果你使用旧的</c>

220
00:10:08,609 --> 00:10:13,046
<c.magenta>你需要决定是否删除旧引用文件</c>

221
00:10:13,113 --> 00:10:15,182
<c.magenta>因为我们不知道</c>

222
00:10:16,383 --> 00:10:19,286
<c.magenta>Core Spotlight API是x86指令</c>

223
00:10:19,353 --> 00:10:21,722
<c.magenta>这意味着此功能</c>

224
00:10:21,788 --> 00:10:23,724
<c.magenta>现在是时候升级你的应用了</c>

225
00:10:26,026 --> 00:10:27,027
<c.magenta>（新Indexing API）</c>

226
00:10:27,094 --> 00:10:31,198
<c.magenta>关于Core Spotlight就是这些</c>

227
00:10:32,833 --> 00:10:35,269
<c.magenta>那么 indexing是什么呢？</c>

228
00:10:35,335 --> 00:10:37,404
<c.magenta>配置你的数据库</c>

229
00:10:38,438 --> 00:10:40,474
<c.magenta>你可以有多个索引</c>

230
00:10:40,908 --> 00:10:42,009
<c.magenta>每个索引可以有多个列</c>

231
00:10:42,075 --> 00:10:44,344
<c.magenta>一个列可以属于多个索引</c>

232
00:10:44,411 --> 00:10:46,480
<c.magenta>这让你能够设置大量索引</c>

233
00:10:46,847 --> 00:10:49,850
<c.magenta>数据库可以使用这些索引</c>

234
00:10:50,184 --> 00:10:52,286
<c.magenta>执行想要的查询</c>

235
00:10:52,352 --> 00:10:54,121
<c.magenta>其表达方式好像是：</c>

236
00:10:54,388 --> 00:10:57,257
<c.magenta>“我想要使用这些列</c>

237
00:10:57,324 --> 00:10:58,892
<c.magenta>（题外话：INDEXING）</c>

238
00:10:58,959 --> 00:11:01,261
<c.magenta>现在我想讨论一些</c>

239
00:10:58,959 --> 00:11:01,261
<c.magenta>现在我想讨论一些</c>

240
00:11:01,328 --> 00:11:03,263
<c.magenta>主要是针对</c>

241
00:11:04,198 --> 00:11:07,067
<c.magenta>基本的索引形式是二叉树索引</c>

242
00:11:07,134 --> 00:11:08,302
<c.magenta>支持任何位置和任何数据</c>

243
00:11:09,469 --> 00:11:11,839
<c.magenta>但是它们仅支持严格比较</c>

244
00:11:11,905 --> 00:11:14,007
<c.magenta>它们进行数据位比较</c>

245
00:11:14,074 --> 00:11:16,610
<c.magenta>如果不相同 索引就不匹配</c>

246
00:11:18,145 --> 00:11:20,280
<c.magenta>但是 更多类型的索引</c>

247
00:11:20,347 --> 00:11:21,915
<c.magenta>开始得到应用</c>

248
00:11:21,982 --> 00:11:24,051
<c.magenta>最近 一种非常有用的索引</c>

249
00:11:24,685 --> 00:11:26,653
<c.magenta>是RTree Index</c>

250
00:11:27,054 --> 00:11:30,657
<c.magenta>它是一种经过优化的索引</c>

251
00:11:31,291 --> 00:11:33,026
<c.magenta>二进制索引看起来是这样的</c>

252
00:11:33,093 --> 00:11:34,995
<c.magenta>这是你的数据</c>

253
00:11:35,062 --> 00:11:36,663
<c.magenta>设备尺寸之类的数据</c>

254
00:11:36,930 --> 00:11:40,033
<c.magenta>如果构建一个BTree</c>

255
00:11:40,100 --> 00:11:41,401
<c.magenta>（二叉树索引）</c>

256
00:11:41,468 --> 00:11:43,770
<c.magenta>所有节点…</c>

257
00:11:43,837 --> 00:11:46,907
<c.magenta>子节点中较小的数</c>

258
00:11:46,974 --> 00:11:48,709
<c.magenta>位于左边</c>

259
00:11:48,775 --> 00:11:51,278
<c.magenta>所有节点中较大的数</c>

260
00:11:51,345 --> 00:11:53,347
<c.magenta>然后向下检索</c>

261
00:11:54,014 --> 00:11:56,283
<c.magenta>但是 RTree Data</c>

262
00:11:56,350 --> 00:11:59,286
<c.magenta>形成很多奇怪的形状</c>

263
00:11:59,353 --> 00:12:00,654
<c.magenta>是多维图形</c>

264
00:11:59,353 --> 00:12:00,654
<c.magenta>是多维图形</c>

265
00:12:00,854 --> 00:12:03,657
<c.magenta>它们通常互相重叠</c>

266
00:12:04,024 --> 00:12:06,627
<c.magenta>并没有一个很好的方法组织它们</c>

267
00:12:06,693 --> 00:12:09,263
<c.magenta>以形成方向线性二叉树</c>

268
00:12:09,696 --> 00:12:12,332
<c.magenta>RTree Data的存储方式</c>

269
00:12:12,399 --> 00:12:15,035
<c.magenta>有一个范围零</c>

270
00:12:15,102 --> 00:12:18,539
<c.magenta>围绕着它的所有子部分</c>

271
00:12:19,339 --> 00:12:24,278
<c.magenta>比如 范围元素</c>

272
00:12:24,344 --> 00:12:28,749
<c.magenta>R6又包含子元素R7</c>

273
00:12:29,049 --> 00:12:30,918
<c.magenta>这是一种轻度不平衡RTree</c>

274
00:12:30,984 --> 00:12:32,085
<c.magenta>我们将会适应它</c>

275
00:12:34,755 --> 00:12:37,224
<c.magenta>当前的indexing API</c>

276
00:12:37,991 --> 00:12:40,527
<c.magenta>你可以创建自己的资产索引</c>

277
00:12:40,594 --> 00:12:44,364
<c.magenta>通过调用</c>

278
00:12:44,431 --> 00:12:46,600
<c.magenta>设置那个资产</c>

279
00:12:47,100 --> 00:12:48,402
<c.magenta>如果你想要使用多列索引</c>

280
00:12:48,468 --> 00:12:51,205
<c.magenta>需要调用NS Entity Description</c>

281
00:12:51,505 --> 00:12:52,973
<c.magenta>这让你能够创建一个索引</c>

282
00:12:53,040 --> 00:12:54,842
<c.magenta>含有三、四、五个列</c>

283
00:12:55,542 --> 00:12:58,579
<c.magenta>这些API自动创建</c>

284
00:12:58,645 --> 00:13:01,548
<c.magenta>一个升序二叉树索引</c>

285
00:12:58,645 --> 00:13:01,548
<c.magenta>一个升序二叉树索引</c>

286
00:13:03,183 --> 00:13:05,185
<c.magenta>我们希望升级</c>

287
00:13:05,252 --> 00:13:06,386
<c.magenta>让它们变得更强大</c>

288
00:13:06,787 --> 00:13:08,956
<c.magenta>它们能够指向新的数据类型</c>

289
00:13:09,556 --> 00:13:10,424
<c.magenta>可配置性更强</c>

290
00:13:10,991 --> 00:13:13,327
<c.magenta>我们增加了大量的新模型类</c>

291
00:13:14,328 --> 00:13:18,799
<c.magenta>第一个是NSFetchIndexDescription</c>

292
00:13:18,866 --> 00:13:21,935
<c.magenta>我们为</c>

293
00:13:22,002 --> 00:13:24,905
<c.magenta>增加新方法</c>

294
00:13:25,339 --> 00:13:27,908
<c.magenta>一个Fetch index descriptions数组</c>

295
00:13:28,809 --> 00:13:30,410
<c.magenta>我们还增加一些函数</c>

296
00:13:30,477 --> 00:13:33,614
<c.magenta>数据库是否应该使用特定的参数</c>

297
00:13:33,680 --> 00:13:35,582
<c.magenta>是否进行给定查询求值</c>

298
00:13:36,183 --> 00:13:38,418
<c.magenta>我们增加索引 让你能够声明</c>

299
00:13:38,485 --> 00:13:39,953
<c.magenta>“嘿 确实使用这个索引”</c>

300
00:13:40,521 --> 00:13:43,423
<c.magenta>始终都有索引存在</c>

301
00:13:43,891 --> 00:13:46,326
<c.magenta>能够比用户查询优化器更准确</c>

302
00:13:46,393 --> 00:13:50,097
<c.magenta>可以指定不要为where语句</c>

303
00:13:52,499 --> 00:13:55,836
<c.magenta>NSFetchIndexElementDescription</c>

304
00:13:55,903 --> 00:14:00,107
<c.magenta>它允许你指定索引元素</c>

305
00:13:55,903 --> 00:14:00,107
<c.magenta>它允许你指定索引元素</c>

306
00:14:00,974 --> 00:14:03,911
<c.magenta>你可以指定为属性创建</c>

307
00:14:03,977 --> 00:14:06,613
<c.magenta>可以是二叉树类型</c>

308
00:14:07,047 --> 00:14:09,650
<c.magenta>如果是二叉树索引</c>

309
00:14:09,716 --> 00:14:11,051
<c.magenta>升序或降序</c>

310
00:14:11,251 --> 00:14:13,854
<c.magenta>如果进行特定类型的搜索</c>

311
00:14:13,921 --> 00:14:16,256
<c.magenta>比如 如果搜索邮件</c>

312
00:14:16,323 --> 00:14:19,493
<c.magenta>首先显示最近的邮件</c>

313
00:14:19,927 --> 00:14:24,698
<c.magenta>因此 搜索方向会改变数据库的</c>

314
00:14:24,765 --> 00:14:25,966
<c.magenta>索引内容查找顺序</c>

315
00:14:28,569 --> 00:14:32,840
<c.magenta>FetchIndexDescription允许你</c>

316
00:14:32,906 --> 00:14:35,709
<c.magenta>组合成一个索引</c>

317
00:14:36,343 --> 00:14:38,545
<c.magenta>而且你可以设置预测规则</c>

318
00:14:38,712 --> 00:14:42,883
<c.magenta>规定仅将匹配</c>

319
00:14:43,617 --> 00:14:46,253
<c.magenta>它还进行一些索引内容验证</c>

320
00:14:46,320 --> 00:14:49,189
<c.magenta>确保创建的索引是合理的</c>

321
00:14:50,691 --> 00:14:54,761
<c.magenta>这里有一些不足之处</c>

322
00:14:55,095 --> 00:14:57,764
<c.magenta>要么是RTree索引</c>

323
00:14:58,465 --> 00:15:02,069
<c.magenta>Range Index只能为小于或等于32位的</c>

324
00:14:58,465 --> 00:15:02,069
<c.magenta>Range Index只能为小于或等于32位的</c>

325
00:15:02,135 --> 00:15:03,237
<c.magenta>数值资产创建范围索引</c>

326
00:15:03,403 --> 00:15:06,039
<c.magenta>这是基本SQLite数据库</c>

327
00:15:06,940 --> 00:15:09,142
<c.magenta>如果你要创建自己的增量存储</c>

328
00:15:10,010 --> 00:15:12,813
<c.magenta>这是一个限制</c>

329
00:15:12,880 --> 00:15:13,881
<c.magenta>也许我们能够想出办法</c>

330
00:15:15,482 --> 00:15:20,020
<c.magenta>但被放入Ranged Index</c>

331
00:15:20,587 --> 00:15:22,623
<c.magenta>目前没有定义null范围</c>

332
00:15:23,690 --> 00:15:27,027
<c.magenta>如果你们使用代码构建模型</c>

333
00:15:27,094 --> 00:15:29,396
<c.magenta>我曾经在WWDC大会上</c>

334
00:15:30,163 --> 00:15:33,967
<c.magenta>如果在设置索引后 改变实体结构</c>

335
00:15:34,434 --> 00:15:36,036
<c.magenta>我们必须放弃索引</c>

336
00:15:36,103 --> 00:15:38,305
<c.magenta>这实际上应用于整个实体层级结构</c>

337
00:15:38,372 --> 00:15:40,941
<c.magenta>如果你在层级结构中</c>

338
00:15:41,008 --> 00:15:43,610
<c.magenta>增加或删除一个实体</c>

339
00:15:43,677 --> 00:15:46,446
<c.magenta>我们不能再确定索引是否有效</c>

340
00:15:46,947 --> 00:15:47,814
<c.magenta>始终放弃索引</c>

341
00:15:50,751 --> 00:15:56,657
<c.magenta>你们可能知道 在以前的版本中</c>

342
00:15:56,723 --> 00:15:59,059
<c.magenta>并不会更改实体版本Hash</c>

343
00:15:59,126 --> 00:16:01,361
<c.magenta>当用户使用新索引</c>

344
00:15:59,126 --> 00:16:01,361
<c.magenta>当用户使用新索引</c>

345
00:16:01,428 --> 00:16:06,433
<c.magenta>首次启动新版本应用时</c>

346
00:16:06,500 --> 00:16:07,968
<c.magenta>这意味着不会进行数据迁移</c>

347
00:16:08,402 --> 00:16:09,670
<c.magenta>因此不会造成性能损失</c>

348
00:16:09,736 --> 00:16:11,872
<c.magenta>另一方面</c>

349
00:16:11,939 --> 00:16:14,241
<c.magenta>因此不需要更新索引</c>

350
00:16:14,908 --> 00:16:16,910
<c.magenta>如果想要迁移索引</c>

351
00:16:16,977 --> 00:16:19,746
<c.magenta>而且更新索引 你需要调用</c>

352
00:16:19,813 --> 00:16:23,383
<c.magenta>模型版本Hash Identifier</c>

353
00:16:24,351 --> 00:16:27,487
<c.magenta>SQL store将会忽略</c>

354
00:16:27,988 --> 00:16:30,490
<c.magenta>这意味着如果你打开数据库</c>

355
00:16:30,557 --> 00:16:33,026
<c.magenta>你认为你已经添加索引</c>

356
00:16:33,594 --> 00:16:35,762
<c.magenta>可以转到应用控制台</c>

357
00:16:35,829 --> 00:16:36,964
<c.magenta>你为什么看不到索引</c>

358
00:16:38,599 --> 00:16:39,967
<c.magenta>我要再次进行演示</c>

359
00:16:41,034 --> 00:16:42,202
<c.magenta>这里有一个模型</c>

360
00:16:42,836 --> 00:16:46,006
<c.magenta>我不想使用</c>

361
00:16:46,073 --> 00:16:49,843
<c.magenta>因为这是演示</c>

362
00:16:50,978 --> 00:16:56,149
<c.magenta>我在新的建模工具中</c>

363
00:16:56,216 --> 00:17:00,754
<c.magenta>选择想要添加索引的实体</c>

364
00:16:56,216 --> 00:17:00,754
<c.magenta>选择想要添加索引的实体</c>

365
00:17:01,188 --> 00:17:05,959
<c.magenta>添加实体 现在你可以看到</c>

366
00:17:06,292 --> 00:17:08,362
<c.magenta>你可以添加一个</c>

367
00:17:10,864 --> 00:17:13,165
<c.magenta>然后我可以添加多个属性</c>

368
00:17:14,501 --> 00:17:17,171
<c.magenta>latitude和longitude属性</c>

369
00:17:18,105 --> 00:17:20,507
<c.magenta>在这里 选择照片</c>

370
00:17:21,474 --> 00:17:24,278
<c.magenta>然后在这里 更改</c>

371
00:17:27,748 --> 00:17:29,650
<c.magenta>现在 当用户启动</c>

372
00:17:29,716 --> 00:17:32,286
<c.magenta>一个使用此模型版本</c>

373
00:17:33,854 --> 00:17:35,689
<c.magenta>将会使用新的RTree索引</c>

374
00:17:36,523 --> 00:17:39,359
<c.magenta>我会运行我的演示应用</c>

375
00:17:39,793 --> 00:17:41,495
<c.magenta>它已经内建这种索引</c>

376
00:17:44,598 --> 00:17:45,832
<c.magenta>然后…</c>

377
00:17:49,102 --> 00:17:50,337
<c.magenta>来到这里</c>

378
00:17:50,671 --> 00:17:54,241
<c.magenta>获取我细心设置的</c>

379
00:17:56,577 --> 00:17:57,678
<c.magenta>我忘了一件事情</c>

380
00:18:00,414 --> 00:18:03,383
<c.magenta>我要来到这里 编辑scheme</c>

381
00:18:03,450 --> 00:18:05,319
<c.magenta>Core Data</c>

382
00:18:06,086 --> 00:18:09,223
<c.magenta>我已经设置</c>

383
00:18:09,957 --> 00:18:12,993
<c.magenta>如果你们熟悉SQL Debug</c>

384
00:18:13,327 --> 00:18:14,995
<c.magenta>与Core Data中的功能一样</c>

385
00:18:15,395 --> 00:18:17,431
<c.magenta>你可以非常熟悉</c>

386
00:18:17,497 --> 00:18:19,299
<c.magenta>1和2作为数字…</c>

387
00:18:19,366 --> 00:18:20,534
<c.magenta>你即将设置的级别</c>

388
00:18:20,968 --> 00:18:24,771
<c.magenta>我们增加一个新级别4</c>

389
00:18:24,838 --> 00:18:29,209
<c.magenta>和Core Data发送至</c>

390
00:18:29,276 --> 00:18:30,878
<c.magenta>数据库的所有语句</c>

391
00:18:31,278 --> 00:18:35,682
<c.magenta>因此我将运行我的应用</c>

392
00:18:38,485 --> 00:18:39,353
<c.magenta>然后回过头来</c>

393
00:18:41,855 --> 00:18:42,890
<c.magenta>重置预测规则</c>

394
00:18:44,358 --> 00:18:45,759
<c.magenta>运行搜索</c>

395
00:18:47,661 --> 00:18:50,898
<c.magenta>现在我们来看上次搜索</c>

396
00:18:53,567 --> 00:18:55,702
<c.magenta>这更有意思 我来这里</c>

397
00:18:55,769 --> 00:19:00,340
<c.magenta>我把早期的版本</c>

398
00:18:55,769 --> 00:19:00,340
<c.magenta>我把早期的版本</c>

399
00:19:00,407 --> 00:19:02,075
<c.magenta>在这里我要放大文本</c>

400
00:19:04,211 --> 00:19:07,781
<c.magenta>现在我要选择一小段文本</c>

401
00:19:08,916 --> 00:19:10,450
<c.magenta>Z Photo by Location</c>

402
00:19:10,984 --> 00:19:13,253
<c.magenta>如果查看查询计划</c>

403
00:19:13,453 --> 00:19:15,489
<c.magenta>你可以看到</c>

404
00:19:15,789 --> 00:19:18,592
<c.magenta>实际是在引导位置查询</c>

405
00:19:18,892 --> 00:19:21,929
<c.magenta>将经度查询导向</c>

406
00:19:22,896 --> 00:19:27,901
<c.magenta>在这里我们看到</c>

407
00:19:27,968 --> 00:19:30,737
<c.magenta>如果与未使用RTree的版本比较</c>

408
00:19:32,372 --> 00:19:34,241
<c.magenta>这是我们以前的查询</c>

409
00:19:34,308 --> 00:19:36,310
<c.magenta>这个与这个之间的Z经度</c>

410
00:19:37,177 --> 00:19:41,949
<c.magenta>我们可以看到</c>

411
00:19:42,216 --> 00:19:44,685
<c.magenta>性能提升约10%</c>

412
00:19:45,118 --> 00:19:48,288
<c.magenta>在配备SSD Fast Cash</c>

413
00:19:48,555 --> 00:19:51,225
<c.magenta>在你的设备上</c>

414
00:19:51,291 --> 00:19:52,926
<c.magenta>这是一个很小的数据集</c>

415
00:19:53,160 --> 00:19:56,096
<c.magenta>如果你设备上的数据大量上升</c>

416
00:19:56,530 --> 00:19:59,800
<c.magenta>RTree搜索速度相比</c>

417
00:20:01,068 --> 00:20:03,003
<c.magenta>而且…</c>

418
00:20:04,605 --> 00:20:05,739
<c.magenta>我已经证明这一点</c>

419
00:20:06,840 --> 00:20:08,008
<c.magenta>这就是…</c>

420
00:20:10,744 --> 00:20:11,945
<c.magenta>这就是RTree搜索</c>

421
00:20:12,946 --> 00:20:15,315
<c.magenta>还有另外一张幻灯片</c>

422
00:20:15,883 --> 00:20:17,851
<c.magenta>我们还增加一些混杂的</c>

423
00:20:19,720 --> 00:20:21,021
<c.magenta>新的属性类型</c>

424
00:20:21,455 --> 00:20:25,559
<c.magenta>增加了NSUUIDA属性类型</c>

425
00:20:25,759 --> 00:20:28,962
<c.magenta>由UUID和URL值类提供支持</c>

426
00:20:33,967 --> 00:20:36,537
<c.magenta>很高兴你们欣赏</c>

427
00:20:37,004 --> 00:20:38,472
<c.magenta>现在我邀请瑞希上台</c>

428
00:20:38,539 --> 00:20:40,707
<c.magenta>（持续性历史跟踪）</c>

429
00:20:41,675 --> 00:20:42,676
<c.magenta>谢谢</c>

430
00:20:47,514 --> 00:20:49,016
<c.magenta>大家好 我是瑞希·维尔马</c>

431
00:20:49,082 --> 00:20:51,018
<c.magenta>我将为大家介绍持续性历史跟踪</c>

432
00:20:52,586 --> 00:20:54,421
<c.magenta>让我们先聊聊你们的应用</c>

433
00:20:54,955 --> 00:20:57,691
<c.magenta>你们开发了很多不错的应用</c>

434
00:20:57,758 --> 00:21:00,394
<c.magenta>NS Persistent Container</c>

435
00:20:57,758 --> 00:21:00,394
<c.magenta>NS Persistent Container</c>

436
00:21:00,460 --> 00:21:01,995
<c.magenta>假设你已经设置</c>

437
00:21:02,329 --> 00:21:03,564
<c.magenta>和Background Context</c>

438
00:21:04,164 --> 00:21:08,001
<c.magenta>而且创建Shared Container</c>

439
00:21:09,069 --> 00:21:12,639
<c.magenta>现在你的View Context是一个连接</c>

440
00:21:13,106 --> 00:21:17,010
<c.magenta>也许你已设置Background</c>

441
00:21:17,077 --> 00:21:19,112
<c.magenta>下载内容</c>

442
00:21:20,614 --> 00:21:24,017
<c.magenta>你们是非常勤勉的开发者</c>

443
00:21:24,084 --> 00:21:28,388
<c.magenta>文档扩展、共享扩展和照片编辑扩展</c>

444
00:21:28,655 --> 00:21:32,025
<c.magenta>现在所有这些</c>

445
00:21:32,092 --> 00:21:35,028
<c.magenta>都可以在任何进程中运行</c>

446
00:21:35,095 --> 00:21:37,865
<c.magenta>或者可能来自于程序中的任何上下文</c>

447
00:21:37,931 --> 00:21:40,434
<c.magenta>你们可能不知道</c>

448
00:21:41,235 --> 00:21:43,704
<c.magenta>我们把它们进行细分</c>

449
00:21:45,973 --> 00:21:47,040
<c.magenta>不好意思</c>

450
00:21:47,674 --> 00:21:50,277
<c.magenta>现在我们进入应用</c>

451
00:21:52,479 --> 00:21:54,348
<c.magenta>用户看到View Context</c>

452
00:21:54,815 --> 00:21:56,450
<c.magenta>同时还有Background Context</c>

453
00:21:56,517 --> 00:21:59,052
<c.magenta>正在从某个远程资源下载信息</c>

454
00:21:59,620 --> 00:22:01,788
<c.magenta>不幸的是我们经常看到的情况是</c>

455
00:21:59,620 --> 00:22:01,788
<c.magenta>不幸的是我们经常看到的情况是</c>

456
00:22:01,855 --> 00:22:04,391
<c.magenta>Background Context</c>

457
00:22:04,725 --> 00:22:07,494
<c.magenta>但是View Context可能</c>

458
00:22:07,895 --> 00:22:09,897
<c.magenta>或者它甚至并不关心这些对象</c>

459
00:22:10,364 --> 00:22:13,867
<c.magenta>但是Save Notifications进入后</c>

460
00:22:14,468 --> 00:22:18,605
<c.magenta>因此如果忽略Background Context</c>

461
00:22:18,672 --> 00:22:19,806
<c.magenta>可能会忽略一些变更</c>

462
00:22:20,073 --> 00:22:21,808
<c.magenta>很可能会发生这样的情况</c>

463
00:22:22,075 --> 00:22:24,878
<c.magenta>你可能忽略Batch Updates</c>

464
00:22:25,078 --> 00:22:26,813
<c.magenta>它们并不生成保存通知</c>

465
00:22:28,315 --> 00:22:32,553
<c.magenta>现在用户进入Safari</c>

466
00:22:33,053 --> 00:22:34,821
<c.magenta>这将写入数据库</c>

467
00:22:35,155 --> 00:22:37,024
<c.magenta>当开发人员返回应用时</c>

468
00:22:37,925 --> 00:22:41,094
<c.magenta>或用户返回应用时</c>

469
00:22:41,595 --> 00:22:44,798
<c.magenta>你知道已经发生变化</c>

470
00:22:45,098 --> 00:22:47,467
<c.magenta>因此你必须重新扫描</c>

471
00:22:47,534 --> 00:22:49,469
<c.magenta>自你上次离开之后</c>

472
00:22:50,704 --> 00:22:53,040
<c.magenta>不幸的是有时候</c>

473
00:22:53,740 --> 00:22:56,743
<c.magenta>可能是因为用户退出应用</c>

474
00:22:57,110 --> 00:22:59,246
<c.magenta>而此时Background Context</c>

475
00:22:59,313 --> 00:23:00,547
<c.magenta>当你的应用恢复运行时</c>

476
00:22:59,313 --> 00:23:00,547
<c.magenta>当你的应用恢复运行时</c>

477
00:23:00,981 --> 00:23:04,117
<c.magenta>Background Context并不知道</c>

478
00:23:04,318 --> 00:23:05,719
<c.magenta>从而扫描本地数据库</c>

479
00:23:06,186 --> 00:23:09,923
<c.magenta>因此它必须检查远程内容</c>

480
00:23:10,123 --> 00:23:12,059
<c.magenta>以了解需要从何处重新开始</c>

481
00:23:13,794 --> 00:23:15,996
<c.magenta>让我们来仔细看这个例子</c>

482
00:23:16,630 --> 00:23:19,600
<c.magenta>我们有一个应用决定载入一些数据</c>

483
00:23:19,900 --> 00:23:24,338
<c.magenta>因此Background Context载入数据</c>

484
00:23:24,938 --> 00:23:28,575
<c.magenta>现在 用户暂停应用</c>

485
00:23:29,843 --> 00:23:32,045
<c.magenta>我们将看到数据插入两个新对象</c>

486
00:23:33,146 --> 00:23:37,584
<c.magenta>然后共享扩展开始运行</c>

487
00:23:38,051 --> 00:23:39,920
<c.magenta>照片扩展也是如此</c>

488
00:23:40,988 --> 00:23:44,358
<c.magenta>这些工作完成后 返回应用</c>

489
00:23:45,092 --> 00:23:48,562
<c.magenta>注意到一些数据已经过时</c>

490
00:23:49,930 --> 00:23:55,202
<c.magenta>我们的应用仅知道最初的六个对象</c>

491
00:23:55,669 --> 00:23:57,804
<c.magenta>数据库的其余部分已经修改过</c>

492
00:23:57,871 --> 00:24:00,240
<c.magenta>或者应用不知道这些对象</c>

493
00:23:57,871 --> 00:24:00,240
<c.magenta>或者应用不知道这些对象</c>

494
00:24:00,874 --> 00:24:02,943
<c.magenta>因此必须查找和扫描所有内容</c>

495
00:24:03,010 --> 00:24:05,179
<c.magenta>弄清楚哪些内容</c>

496
00:24:05,546 --> 00:24:06,980
<c.magenta>或Background Context</c>

497
00:24:09,650 --> 00:24:12,152
<c.magenta>现在我们推出了</c>

498
00:24:12,853 --> 00:24:13,754
<c.magenta>它相当简单</c>

499
00:24:14,755 --> 00:24:17,558
<c.magenta>抓取你的Container</c>

500
00:24:18,659 --> 00:24:20,894
<c.magenta>瞧</c>

501
00:24:22,696 --> 00:24:25,432
<c.magenta>将NS Persistent History Tracking</c>

502
00:24:25,933 --> 00:24:29,136
<c.magenta>现在 我们将跟踪数据库的所有变化</c>

503
00:24:31,572 --> 00:24:34,174
<c.magenta>让我们回到前面的…</c>

504
00:24:37,344 --> 00:24:39,046
<c.magenta>我们回到前面的例子</c>

505
00:24:39,313 --> 00:24:40,647
<c.magenta>回到View Context之中</c>

506
00:24:40,714 --> 00:24:42,549
<c.magenta>此时Background Context加载数据</c>

507
00:24:43,383 --> 00:24:46,453
<c.magenta>我们将看到</c>

508
00:24:46,787 --> 00:24:48,889
<c.magenta>此事务处理</c>

509
00:24:49,223 --> 00:24:53,227
<c.magenta>我可以看到它是</c>

510
00:24:54,161 --> 00:24:58,065
<c.magenta>当我的跳出应用</c>

511
00:25:02,035 --> 00:25:05,539
<c.magenta>我们看到这也会生成一个事务处理</c>

512
00:25:06,240 --> 00:25:08,208
<c.magenta>在我的共享扩展上</c>

513
00:25:11,712 --> 00:25:14,548
<c.magenta>共享扩展也会注意到已经发生修改</c>

514
00:25:14,615 --> 00:25:17,684
<c.magenta>在这里不会进行插入</c>

515
00:25:18,485 --> 00:25:21,054
<c.magenta>在照片扩展上 我们也会看到</c>

516
00:25:21,121 --> 00:25:22,422
<c.magenta>发生第四个事务处理</c>

517
00:25:23,824 --> 00:25:25,492
<c.magenta>我们将看到它在照片中完成</c>

518
00:25:26,527 --> 00:25:29,730
<c.magenta>现在当我的应用回到前台时</c>

519
00:25:30,330 --> 00:25:34,368
<c.magenta>仍然有数据</c>

520
00:25:34,635 --> 00:25:37,271
<c.magenta>只需要遍历事务处理1-4</c>

521
00:25:37,804 --> 00:25:39,373
<c.magenta>瞧 已经更新了</c>

522
00:25:42,609 --> 00:25:44,344
<c.magenta>我们引入新的</c>

523
00:25:44,411 --> 00:25:46,947
<c.magenta>Store Request</c>

524
00:25:47,447 --> 00:25:49,917
<c.magenta>其名称为 NS Persistent History</c>

525
00:25:50,384 --> 00:25:52,052
<c.magenta>你可以启动它</c>

526
00:25:52,119 --> 00:25:55,522
<c.magenta>通过日期、令牌或事务处理</c>

527
00:25:57,457 --> 00:25:59,993
<c.magenta>而且你可以很容易地</c>

528
00:26:00,427 --> 00:26:03,697
<c.magenta>变化数量即手可得</c>

529
00:26:03,964 --> 00:26:05,566
<c.magenta>也可以获得所有详情</c>

530
00:26:05,666 --> 00:26:08,068
<c.magenta>获取所有事务处理和所有变更</c>

531
00:26:09,603 --> 00:26:13,307
<c.magenta>另外 利用变更请求</c>

532
00:26:13,473 --> 00:26:17,311
<c.magenta>你可以重头开始</c>

533
00:26:17,411 --> 00:26:20,380
<c.magenta>或事务处理之前的历史记录</c>

534
00:26:21,081 --> 00:26:25,953
<c.magenta>持续性历史是线性的</c>

535
00:26:27,754 --> 00:26:33,527
<c.magenta>我们希望你记住 进行删除时</c>

536
00:26:34,294 --> 00:26:37,397
<c.magenta>这样它就会知道</c>

537
00:26:37,464 --> 00:26:41,235
<c.magenta>你曾经使用你所需要的历史记录</c>

538
00:26:41,301 --> 00:26:43,804
<c.magenta>你就不会删除</c>

539
00:26:43,871 --> 00:26:46,773
<c.magenta>其他应用用户所需要的东西</c>

540
00:26:47,140 --> 00:26:50,244
<c.magenta>现在 我们有了</c>

541
00:26:50,711 --> 00:26:56,383
<c.magenta>这是一个大型数据集记录</c>

542
00:26:56,550 --> 00:27:00,554
<c.magenta>你可以看到 我们有Store ID</c>

543
00:26:56,550 --> 00:27:00,554
<c.magenta>你可以看到 我们有Store ID</c>

544
00:27:00,988 --> 00:27:02,389
<c.magenta>我们还有令牌</c>

545
00:27:02,456 --> 00:27:04,925
<c.magenta>由于历史记录是线性的</c>

546
00:27:05,492 --> 00:27:08,161
<c.magenta>我们为你提供一个令牌</c>

547
00:27:08,228 --> 00:27:09,897
<c.magenta>这样 当应用退出时</c>

548
00:27:09,963 --> 00:27:13,233
<c.magenta>可以跟踪应用的历史位置</c>

549
00:27:13,300 --> 00:27:15,802
<c.magenta>只需重启应用 调出令牌</c>

550
00:27:15,869 --> 00:27:18,839
<c.magenta>取回历史记录</c>

551
00:27:19,406 --> 00:27:22,309
<c.magenta>现在 在事务处理中</c>

552
00:27:22,609 --> 00:27:26,513
<c.magenta>希望你们进入</c>

553
00:27:26,580 --> 00:27:30,083
<c.magenta>告知谁是这个Context</c>

554
00:27:30,150 --> 00:27:33,220
<c.magenta>或这个Save Batch Update</c>

555
00:27:33,954 --> 00:27:37,925
<c.magenta>我们允许你进入</c>

556
00:27:38,058 --> 00:27:39,993
<c.magenta>设置事务编写者</c>

557
00:27:40,661 --> 00:27:43,163
<c.magenta>做这些工作</c>

558
00:27:43,230 --> 00:27:47,234
<c.magenta>我们将获取这个字符串</c>

559
00:27:47,334 --> 00:27:50,003
<c.magenta>后来哪些人对你的数据库</c>

560
00:27:51,839 --> 00:27:54,842
<c.magenta>作为每个事务处理的一部分</c>

561
00:27:55,142 --> 00:27:58,579
<c.magenta>变更表示对</c>

562
00:27:58,645 --> 00:28:01,481
<c.magenta>每个事务处理</c>

563
00:27:58,645 --> 00:28:01,481
<c.magenta>每个事务处理</c>

564
00:28:01,615 --> 00:28:05,419
<c.magenta>比如插入、更新、删除</c>

565
00:28:05,819 --> 00:28:09,890
<c.magenta>在更新时 将会告知</c>

566
00:28:10,157 --> 00:28:14,828
<c.magenta>无论属性或关系</c>

567
00:28:16,697 --> 00:28:21,001
<c.magenta>将会告知tombstone是什么</c>

568
00:28:21,068 --> 00:28:25,138
<c.magenta>设置一组属性</c>

569
00:28:25,205 --> 00:28:29,476
<c.magenta>它已经不在数据库之中</c>

570
00:28:29,543 --> 00:28:32,913
<c.magenta>但是利用tombstone</c>

571
00:28:33,280 --> 00:28:35,382
<c.magenta>以后进行处理</c>

572
00:28:36,450 --> 00:28:38,619
<c.magenta>现在我们进入模型编辑器</c>

573
00:28:40,721 --> 00:28:41,922
<c.magenta>（模型编辑器）</c>

574
00:28:42,089 --> 00:28:44,691
<c.magenta>这个实体有一个唯一标识符</c>

575
00:28:44,758 --> 00:28:49,229
<c.magenta>可以为它设置tombstone</c>

576
00:28:49,329 --> 00:28:50,964
<c.magenta>“删除后保留”</c>

577
00:28:51,331 --> 00:28:54,301
<c.magenta>非常简单</c>

578
00:28:55,736 --> 00:28:58,338
<c.magenta>我将进行简短演示</c>

579
00:28:58,572 --> 00:29:02,042
<c.magenta>这里有一个简单的应用</c>

580
00:28:58,572 --> 00:29:02,042
<c.magenta>这里有一个简单的应用</c>

581
00:29:02,109 --> 00:29:04,311
<c.magenta>然后将放入我的社交媒体内容源</c>

582
00:29:04,511 --> 00:29:08,715
<c.magenta>这里我设置几个按钮</c>

583
00:29:08,782 --> 00:29:13,020
<c.magenta>将会在Background Context</c>

584
00:29:13,387 --> 00:29:17,124
<c.magenta>一个后台任务将会运行</c>

585
00:29:17,191 --> 00:29:20,794
<c.magenta>然后我设置一个标签页</c>

586
00:29:21,361 --> 00:29:25,132
<c.magenta>在我的代码中</c>

587
00:29:25,299 --> 00:29:28,535
<c.magenta>但是为我的store启用它</c>

588
00:29:30,304 --> 00:29:32,840
<c.magenta>在这里有一条用户贴子</c>

589
00:29:33,140 --> 00:29:35,442
<c.magenta>用户说：</c>

590
00:29:35,509 --> 00:29:38,478
<c.magenta>我可以在后台下载</c>

591
00:29:38,946 --> 00:29:41,915
<c.magenta>可以看到 我已经标记</c>

592
00:29:41,982 --> 00:29:44,985
<c.magenta>第一个来自于用户</c>

593
00:29:45,953 --> 00:29:49,223
<c.magenta>现在我们跳出转至共享扩展</c>

594
00:29:49,890 --> 00:29:52,759
<c.magenta>在这里分享Apple信息非常快速</c>

595
00:29:52,960 --> 00:29:54,328
<c.magenta>（活动历史演示）</c>

596
00:29:56,663 --> 00:29:57,497
<c.magenta>（取消 发布）</c>

597
00:29:57,865 --> 00:30:00,968
<c.magenta>我可以发布这条信息</c>

598
00:29:57,865 --> 00:30:00,968
<c.magenta>我可以发布这条信息</c>

599
00:30:01,802 --> 00:30:05,772
<c.magenta>我们回到应用</c>

600
00:30:05,839 --> 00:30:06,974
<c.magenta>真是奇怪</c>

601
00:30:07,074 --> 00:30:10,677
<c.magenta>肯定是出错了</c>

602
00:30:10,744 --> 00:30:14,681
<c.magenta>可以看到应用中有一条消息</c>

603
00:30:14,982 --> 00:30:17,351
<c.magenta>我甚至可以看到共享扩展</c>

604
00:30:17,651 --> 00:30:19,720
<c.magenta>但是 我在这里没有看到</c>

605
00:30:20,587 --> 00:30:22,389
<c.magenta>与用户一样 我开始添加数据</c>

606
00:30:22,456 --> 00:30:24,725
<c.magenta>尝试弄清楚</c>

607
00:30:25,726 --> 00:30:28,529
<c.magenta>持续性历史正在显示所有内容</c>

608
00:30:28,629 --> 00:30:29,997
<c.magenta>真奇怪</c>

609
00:30:30,230 --> 00:30:35,169
<c.magenta>突然我的应用显出</c>

610
00:30:35,269 --> 00:30:37,404
<c.magenta>在一些视图基础上</c>

611
00:30:37,471 --> 00:30:40,340
<c.magenta>我最终获取数据库内容</c>

612
00:30:40,841 --> 00:30:43,810
<c.magenta>只有通过这种方法</c>

613
00:30:43,877 --> 00:30:45,979
<c.magenta>这让用户感到困惑</c>

614
00:30:46,713 --> 00:30:49,383
<c.magenta>但是如果开启</c>

615
00:30:49,449 --> 00:30:52,019
<c.magenta>不再进行跟踪</c>

616
00:30:52,119 --> 00:30:53,720
<c.magenta>我开启它</c>

617
00:30:53,887 --> 00:30:59,660
<c.magenta>你可以看到</c>

618
00:30:59,826 --> 00:31:01,895
<c.magenta>和View Context设置</c>

619
00:30:59,826 --> 00:31:01,895
<c.magenta>和View Context设置</c>

620
00:31:01,962 --> 00:31:04,231
<c.magenta>我让它们互相侦听</c>

621
00:31:06,600 --> 00:31:10,871
<c.magenta>我还设置事务编写者</c>

622
00:31:10,938 --> 00:31:12,639
<c.magenta>这样我们就可以看到运行过程</c>

623
00:31:13,507 --> 00:31:16,510
<c.magenta>我可以非常快速地停止应用</c>

624
00:31:16,877 --> 00:31:18,579
<c.magenta>（构建成功）</c>

625
00:31:21,014 --> 00:31:21,949
<c.magenta>（库）</c>

626
00:31:24,451 --> 00:31:27,287
<c.magenta>这次我们的应用使用历史</c>

627
00:31:27,754 --> 00:31:30,791
<c.magenta>让我们转到贴子分享功能</c>

628
00:31:31,892 --> 00:31:36,296
<c.magenta>High Sierra看上去很酷</c>

629
00:31:37,798 --> 00:31:38,966
<c.magenta>（High Sierra预览）</c>

630
00:31:39,032 --> 00:31:40,801
<c.magenta>我们来分享它</c>

631
00:31:40,934 --> 00:31:43,837
<c.magenta>非常快</c>

632
00:31:44,371 --> 00:31:45,906
<c.magenta>很酷的新watchOS</c>

633
00:31:51,044 --> 00:31:52,012
<c.magenta>（发布）</c>

634
00:31:55,549 --> 00:31:57,284
<c.magenta>现在 当我们返回应用…</c>

635
00:32:01,021 --> 00:32:02,322
<c.magenta>瞧！它们出现了</c>

636
00:32:02,523 --> 00:32:06,026
<c.magenta>我做的只是当视图重新载入时</c>

637
00:32:06,927 --> 00:32:09,129
<c.magenta>而且可以快速地跳转到那段代码</c>

638
00:32:11,498 --> 00:32:12,533
<c.magenta>（取回更改）</c>

639
00:32:15,302 --> 00:32:16,436
<c.magenta>（跳转到定义）</c>

640
00:32:18,172 --> 00:32:20,140
<c.magenta>在以前</c>

641
00:32:20,207 --> 00:32:23,477
<c.magenta>而不使用持续性历史</c>

642
00:32:23,544 --> 00:32:26,547
<c.magenta>现在我做的是取回历史</c>

643
00:32:26,613 --> 00:32:29,616
<c.magenta>从历史吸取合并上下文</c>

644
00:32:29,683 --> 00:32:31,652
<c.magenta>这为我提供更小的子集</c>

645
00:32:31,718 --> 00:32:35,155
<c.magenta>我不再需要扫描整个数据库</c>

646
00:32:40,127 --> 00:32:42,896
<c.magenta>简单地说 事情变得更简单</c>

647
00:32:43,130 --> 00:32:46,667
<c.magenta>很容易启用持续性历史</c>

648
00:32:47,801 --> 00:32:50,003
<c.magenta>它发现那些被忽略的变化</c>

649
00:32:50,070 --> 00:32:52,873
<c.magenta>你可能已经生成</c>

650
00:32:53,006 --> 00:32:55,542
<c.magenta>你可能未注意到</c>

651
00:32:55,609 --> 00:32:58,011
<c.magenta>你已经使用</c>

652
00:32:58,078 --> 00:33:01,648
<c.magenta>它们不会生成通知</c>

653
00:32:58,078 --> 00:33:01,648
<c.magenta>它们不会生成通知</c>

654
00:33:01,949 --> 00:33:05,319
<c.magenta>而不会对数据库的变化一无所知</c>

655
00:33:05,385 --> 00:33:06,587
<c.magenta>（回顾历史 充满乐趣！）</c>

656
00:33:06,653 --> 00:33:07,621
<c.magenta>（迁移变得更简单）</c>

657
00:33:07,754 --> 00:33:10,958
<c.magenta>关于使用持续性历史的两个要点：</c>

658
00:33:11,024 --> 00:33:12,793
<c.magenta>首先是迁移</c>

659
00:33:12,860 --> 00:33:16,730
<c.magenta>我们在迁移时尽可能多地</c>

660
00:33:17,998 --> 00:33:19,166
<c.magenta>两种情况除外</c>

661
00:33:19,399 --> 00:33:21,902
<c.magenta>如果删除模型中的实体</c>

662
00:33:21,969 --> 00:33:24,705
<c.magenta>我们已经拥有这些实体的历史</c>

663
00:33:25,005 --> 00:33:28,909
<c.magenta>必须删除它们的历史记录</c>

664
00:33:29,343 --> 00:33:31,278
<c.magenta>另一种情况是tombstones</c>

665
00:33:32,145 --> 00:33:33,213
<c.magenta>对于tombstones</c>

666
00:33:33,280 --> 00:33:37,184
<c.magenta>你并不想在以后</c>

667
00:33:37,251 --> 00:33:41,255
<c.magenta>也许它会成为安全隐患</c>

668
00:33:41,321 --> 00:33:45,225
<c.magenta>我们将做同样的事情</c>

669
00:33:45,559 --> 00:33:49,429
<c.magenta>但是如果删除任何数据</c>

670
00:33:49,496 --> 00:33:53,567
<c.magenta>这样只会保存在上次事务处理</c>

671
00:33:53,634 --> 00:33:58,605
<c.magenta>这样你可以跟踪历史而不会跌入陷阱</c>

672
00:33:58,672 --> 00:34:01,875
<c.magenta>让我因为空白而忽略变化</c>

673
00:33:58,672 --> 00:34:01,875
<c.magenta>让我因为空白而忽略变化</c>

674
00:34:03,210 --> 00:34:04,511
<c.magenta>在性能方面</c>

675
00:34:06,046 --> 00:34:10,384
<c.magenta>每次保存和批处理</c>

676
00:34:10,884 --> 00:34:13,320
<c.magenta>根据批处理的保存操作量</c>

677
00:34:13,420 --> 00:34:17,391
<c.magenta>将会计算哪些内容发生变化</c>

678
00:34:17,456 --> 00:34:22,094
<c.magenta>在操作完成之后 占用的内存</c>

679
00:34:22,161 --> 00:34:23,463
<c.magenta>将会交还给你</c>

680
00:34:23,530 --> 00:34:27,266
<c.magenta>还会有少量的存储开销</c>

681
00:34:27,333 --> 00:34:30,771
<c.magenta>从而能够重新收回占用的空间</c>

682
00:34:33,739 --> 00:34:35,309
<c.magenta>这就是持续性历史跟踪</c>

683
00:34:43,483 --> 00:34:47,387
<c.magenta>让我们总结本场演讲的内容</c>

684
00:34:47,487 --> 00:34:51,425
<c.magenta>这项技术容易使用</c>

685
00:34:51,491 --> 00:34:52,960
<c.magenta>提供深度链接</c>

686
00:34:53,025 --> 00:34:56,763
<c.magenta>用户可以在手机上的任何位置</c>

687
00:34:57,364 --> 00:35:00,934
<c.magenta>新Indexing API</c>

688
00:34:57,364 --> 00:35:00,934
<c.magenta>新Indexing API</c>

689
00:35:01,001 --> 00:35:03,036
<c.magenta>让你的应用变得更快</c>

690
00:35:03,570 --> 00:35:06,740
<c.magenta>最后持续性历史让你知道</c>

691
00:35:06,807 --> 00:35:09,009
<c.magenta>用户进行的变更</c>

692
00:35:09,076 --> 00:35:11,378
<c.magenta>让你始终知道</c>

693
00:35:12,980 --> 00:35:15,782
<c.magenta>另外还有一件事情 文件漏洞</c>

694
00:35:16,149 --> 00:35:19,119
<c.magenta>如果你遇到问题</c>

695
00:35:19,953 --> 00:35:22,556
<c.magenta>请访问bugreport.apple.com</c>

696
00:35:22,956 --> 00:35:24,291
<c.magenta>请去访问</c>

697
00:35:25,859 --> 00:35:28,795
<c.magenta>有关更多信息</c>

698
00:35:29,530 --> 00:35:33,200
<c.magenta>另外还有一些相关演讲</c>

699
00:35:33,267 --> 00:35:34,835
<c.magenta>你们可以观看视频</c>

700
00:35:34,902 --> 00:35:37,337
<c.magenta>接下来我们还有</c>

701
00:35:37,704 --> 00:35:41,208
<c.magenta>在星期三</c>

702
00:35:41,275 --> 00:35:42,776
<c.magenta>将会和大家分享一些有趣的内容</c>

703
00:35:42,843 --> 00:35:46,213
<c.magenta>另外请留意星期五上午的</c>

704
00:35:46,547 --> 00:35:47,481
<c.magenta>谢谢大家 非常感谢</c>
