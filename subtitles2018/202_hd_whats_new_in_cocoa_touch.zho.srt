1
00:00:06,516 --> 0:00:14,500
[ 音乐 ]

2
00:00:18,516 --> 0:00:24,456
[ 掌声 ]

3
00:00:24,956 --> 0:00:25,896
&gt;&gt; 早上好

4
00:00:26,406 --> 0:00:28,416
感谢你们今天

5
00:00:28,706 --> 0:00:30,316
来到这里了解

6
00:00:30,516 --> 0:00:32,195
Cocoa Touch 的新功能

7
00:00:33,456 --> 0:00:34,816
一般情况下

8
00:00:34,816 --> 0:00:35,816
Eliza 之后会上台讲解

9
00:00:35,816 --> 0:00:37,556
不过今年

10
00:00:37,556 --> 0:00:38,846
只有我为大家进行讲解

11
00:00:39,386 --> 0:00:41,216
她在未来的几年里会回来的

12
00:00:41,216 --> 0:00:42,626
别担心

13
00:00:43,046 --> 0:00:44,236
今天我们主要

14
00:00:44,556 --> 0:00:46,046
从三个类别

15
00:00:46,046 --> 0:00:46,596
进行讨论

16
00:00:47,656 --> 0:00:50,436
首先是框架更新

17
00:00:50,436 --> 0:00:52,556
比如性能和安全

18
00:00:52,556 --> 0:00:56,476
然后是在 SDK（软件开发包）中

19
00:00:56,476 --> 0:00:57,876
不同 API 的

20
00:00:57,876 --> 0:01:00,056
API 功能增强

21
00:00:57,876 --> 0:01:00,056
API 功能增强

22
00:01:00,056 --> 0:01:01,566
包括通知和信息

23
00:01:02,566 --> 0:01:05,086
最后是 Siri 捷径

24
00:01:05,816 --> 0:01:07,126
那我们开始

25
00:01:07,196 --> 0:01:09,776
第一个话题性能更新

26
00:01:11,106 --> 0:01:12,716
我们要讨论

27
00:01:12,716 --> 0:01:14,506
三个领域的性能

28
00:01:14,506 --> 0:01:18,546
滚动 内存和自动布局

29
00:01:19,786 --> 0:01:21,726
开始之前

30
00:01:21,726 --> 0:01:23,106
很重要的是

31
00:01:23,106 --> 0:01:24,146
记住一点关于滚动的

32
00:01:24,146 --> 0:01:25,496
背景信息

33
00:01:27,796 --> 0:01:30,076
iOS 里的滚动

34
00:01:30,156 --> 0:01:31,836
大多遵从一个

35
00:01:31,876 --> 0:01:32,236
固定模式

36
00:01:32,876 --> 0:01:34,536
我们加载内容

37
00:01:34,536 --> 0:01:36,336
显示在视图里

38
00:01:36,336 --> 0:01:38,096
然后移动这些内容

39
00:01:38,846 --> 0:01:39,666
当我们滑动的时候

40
00:01:39,666 --> 0:01:41,546
大多数帧

41
00:01:41,546 --> 0:01:43,036
都很容易生成

42
00:01:43,036 --> 0:01:44,376
因为我们不用加载任何

43
00:01:44,376 --> 0:01:44,656
新的东西

44
00:01:45,656 --> 0:01:47,226
但是偶尔

45
00:01:47,226 --> 0:01:49,506
当打开一个新的视图时

46
00:01:49,506 --> 0:01:53,206
第一帧相对于其他

47
00:01:53,206 --> 0:01:54,816
容易生成的帧

48
00:01:54,816 --> 0:01:55,776
生成更高耗

49
00:01:56,286 --> 0:02:00,476
当然一旦第一帧生成

50
00:01:56,286 --> 0:02:00,476
当然一旦第一帧生成

51
00:02:00,526 --> 0:02:02,246
我们再滑动内容

52
00:02:02,246 --> 0:02:03,696
这时 CPU 的工作量

53
00:02:03,696 --> 0:02:05,236
又变小了

54
00:02:05,236 --> 0:02:06,806
和一般滑动差不多

55
00:02:07,386 --> 0:02:11,676
为什么那个第一帧

56
00:02:11,676 --> 0:02:14,116
会比别的帧更高耗

57
00:02:14,776 --> 0:02:18,096
让我们从 UITableView 的角度看一下

58
00:02:18,096 --> 0:02:22,066
但其实这个和 UICollectionView   

59
00:02:22,066 --> 0:02:23,226
或者其他相似的

60
00:02:23,226 --> 0:02:24,786
自定义视图

61
00:02:24,786 --> 0:02:25,156
都是一样的

62
00:02:25,866 --> 0:02:28,706
这一帧的工作

63
00:02:28,756 --> 0:02:30,386
开始于当你

64
00:02:30,386 --> 0:02:32,296
在 TableView 执行

65
00:02:32,396 --> 0:02:33,616
cellForRowAt IndexPath

66
00:02:33,676 --> 0:02:34,306
的委托方法时

67
00:02:34,906 --> 0:02:39,316
首先选择想显示的 Cell

68
00:02:39,746 --> 0:02:40,786
我们要试着让它

69
00:02:40,856 --> 0:02:44,666
从重复使用序列中脱离出来

70
00:02:44,666 --> 0:02:45,966
如果它本身不在序列中

71
00:02:45,966 --> 0:02:46,936
我们需要

72
00:02:46,936 --> 0:02:48,326
做一些内存分配

73
00:02:48,326 --> 0:02:50,176
来做好准备

74
00:02:51,036 --> 0:02:52,196
有了 Cell 之后 我们

75
00:02:52,196 --> 0:02:53,446
会用你的模型数据

76
00:02:53,446 --> 0:02:54,316
来填充这个 Cell

77
00:02:54,916 --> 0:02:56,496
这一步有多高耗

78
00:02:56,496 --> 0:02:59,496
取决于你的 App

79
00:02:59,496 --> 0:03:01,476
但可能包含很多

80
00:02:59,496 --> 0:03:01,476
但可能包含很多

81
00:03:01,476 --> 0:03:02,856
高耗的操作

82
00:03:02,896 --> 0:03:05,416
比如读取文件

83
00:03:05,416 --> 0:03:06,916
从数据库加载数据

84
00:03:06,916 --> 0:03:07,516
或其他类似的事情

85
00:03:07,936 --> 0:03:09,056
所以你应该

86
00:03:09,056 --> 0:03:10,536
看一下你的 App 里

87
00:03:10,536 --> 0:03:13,396
在这一方面的消耗

88
00:03:13,396 --> 0:03:14,616
一般来说很大一部分

89
00:03:14,926 --> 0:03:15,686
会在这里

90
00:03:17,276 --> 0:03:18,956
看到这里

91
00:03:18,956 --> 0:03:19,936
你可能以为

92
00:03:19,936 --> 0:03:21,766
高耗工作就此结束

93
00:03:21,766 --> 0:03:23,006
但是当你从这个方法返回

94
00:03:23,006 --> 0:03:24,316
为了让 Cell

95
00:03:24,376 --> 0:03:25,956
显示在屏幕上

96
00:03:25,956 --> 0:03:27,506
其实有更多的工作要做

97
00:03:28,206 --> 0:03:29,786
所以 接下来

98
00:03:29,786 --> 0:03:31,306
我们要把所有内容

99
00:03:31,306 --> 0:03:31,836
布局到 Cell 中

100
00:03:32,336 --> 0:03:33,936
我们要调整视图大小

101
00:03:33,936 --> 0:03:35,686
并把它们放到正确的位置

102
00:03:36,086 --> 0:03:37,276
这一步可能会

103
00:03:37,276 --> 0:03:38,476
消耗我们的

104
00:03:38,476 --> 0:03:39,736
很多时间

105
00:03:39,736 --> 0:03:41,176
因为它包含一些

106
00:03:41,176 --> 0:03:42,946
其他的高耗操作

107
00:03:43,036 --> 0:03:44,666
比如 测量文本

108
00:03:45,296 --> 0:03:46,886
当大小和位置

109
00:03:46,886 --> 0:03:48,666
都调整好之后

110
00:03:48,666 --> 0:03:50,736
就要使用绘制命令

111
00:03:50,736 --> 0:03:52,276
来生成所有

112
00:03:52,276 --> 0:03:54,116
需要被绘制的内容

113
00:03:54,116 --> 0:03:55,606
我们要调用这个 Cell 里

114
00:03:55,606 --> 0:03:57,746
所有的子视图的 draw Rect

115
00:03:58,276 --> 0:03:59,816
重申一下

116
00:03:59,816 --> 0:04:01,216
这一步可能很费时

117
00:03:59,816 --> 0:04:01,216
这一步可能很费时

118
00:04:01,216 --> 0:04:03,036
因为我们需要做

119
00:04:03,036 --> 0:04:04,426
像绘制文本这样的工作

120
00:04:05,536 --> 0:04:08,506
总体而言 在整个代码中

121
00:04:08,646 --> 0:04:11,436
有很多要做的工作

122
00:04:11,436 --> 0:04:13,696
而且都需要在短时间里完成

123
00:04:14,126 --> 0:04:15,656
在我们 60 赫兹的设备上

124
00:04:15,656 --> 0:04:17,565
你只有 16 毫秒

125
00:04:17,565 --> 0:04:19,046
来完成所有的工作

126
00:04:19,046 --> 0:04:20,726
确保不会丢帧

127
00:04:20,726 --> 0:04:22,296
并流畅滑动

128
00:04:23,056 --> 0:04:25,346
在 120 赫兹的 iPad

129
00:04:25,346 --> 0:04:27,836
iPad Pro 上

130
00:04:27,836 --> 0:04:29,696
你只有 8 毫秒来完成所有工作

131
00:04:30,166 --> 0:04:31,736
所以真的是

132
00:04:31,816 --> 0:04:32,956
越快越好

133
00:04:34,226 --> 0:04:36,126
为此在 iOS 10 里

134
00:04:36,326 --> 0:04:37,796
我们引入了

135
00:04:37,836 --> 0:04:40,096
Cell 预读取 API

136
00:04:40,096 --> 0:04:42,186
这个预读取 API

137
00:04:42,256 --> 0:04:43,906
就是帮助做一些工作

138
00:04:43,906 --> 0:04:45,756
用模型数据生成 Cell

139
00:04:45,826 --> 0:04:47,086
并把需要在

140
00:04:47,086 --> 0:04:48,746
短时间里做到的

141
00:04:48,746 --> 0:04:50,916
这个部分的内容

142
00:04:50,916 --> 0:04:52,646
更早地开始

143
00:04:52,646 --> 0:04:53,796
并在后台线程做

144
00:04:53,796 --> 0:04:55,386
这样可以和其他工作

145
00:04:55,386 --> 0:04:57,036
异步进行

146
00:04:57,036 --> 0:04:58,656
尤其是我们提到过的

147
00:04:58,656 --> 0:04:59,286
低耗滚动帧

148
00:05:00,586 --> 0:05:02,296
采用这个 API

149
00:05:02,296 --> 0:05:02,676
很容易 只是一个

150
00:05:03,076 --> 0:05:04,736
UITableViewDataSourcePrefetching

151
00:05:04,736 --> 0:05:06,976
protocol 

152
00:05:06,976 --> 0:05:08,786
只有两个方法

153
00:05:08,786 --> 0:05:10,346
其实只有其中一个是必须的

154
00:05:10,916 --> 0:05:12,196
主要目的是

155
00:05:12,236 --> 0:05:13,536
把一些高耗工作

156
00:05:13,536 --> 0:05:14,956
例如从文件中加载内容

157
00:05:14,956 --> 0:05:17,626
或者读取数据库 放在这里

158
00:05:17,626 --> 0:05:19,416
这样你就不用主动操作了

159
00:05:19,636 --> 0:05:21,436
当你的 Cell 要显示时

160
00:05:21,596 --> 0:05:22,956
你的数据已经准备就绪

161
00:05:23,126 --> 0:05:28,346
大多数情况下

162
00:05:28,406 --> 0:05:31,346
它都很有帮助

163
00:05:31,346 --> 0:05:34,546
但在一些运行 iOS 12 的 App 里

164
00:05:34,546 --> 0:05:36,456
我们发现

165
00:05:36,516 --> 0:05:38,546
它造成了一些问题 而不是提供帮助

166
00:05:39,146 --> 0:05:40,236
让我们来看一看

167
00:05:40,236 --> 0:05:42,846
是什么情况

168
00:05:43,126 --> 0:05:45,476
这个例子是 我们记录的

169
00:05:45,476 --> 0:05:47,156
在 iPhone 6 Plus 上

170
00:05:47,156 --> 0:05:48,236
滑动的情况

171
00:05:49,176 --> 0:05:50,986
上面的竖线

172
00:05:51,046 --> 0:05:53,166
代表我们希望

173
00:05:53,166 --> 0:05:54,166
显示的帧

174
00:05:55,006 --> 0:05:56,506
下面交替的深蓝和浅蓝

175
00:05:56,586 --> 0:05:58,246
代表我们为了让

176
00:05:58,246 --> 0:05:59,896
显示变化而

177
00:05:59,936 --> 0:06:01,096
替换的帧

178
00:05:59,936 --> 0:06:01,096
替换的帧

179
00:06:01,096 --> 0:06:03,556
那个两格的浅蓝色区域

180
00:06:03,556 --> 0:06:08,386
就表示 我们在两帧时间中

181
00:06:08,436 --> 0:06:09,196
绘制了同一帧

182
00:06:09,946 --> 0:06:11,306
在个性化定制的设备上

183
00:06:11,306 --> 0:06:12,556
一但这种情况发生

184
00:06:12,556 --> 0:06:14,156
看起来就像丢帧

185
00:06:14,246 --> 0:06:15,456
或者滚动故障

186
00:06:15,456 --> 0:06:16,916
这当然是我们试图避免的

187
00:06:18,276 --> 0:06:19,386
那么到底发生什么了呢

188
00:06:20,276 --> 0:06:22,296
这个红色部分

189
00:06:22,426 --> 0:06:23,996
表示我们花费在

190
00:06:23,996 --> 0:06:24,716
刚刚提到的

191
00:06:24,716 --> 0:06:26,126
临界区域上的时间

192
00:06:26,126 --> 0:06:29,646
所有的索引路径 布局和绘制

193
00:06:30,206 --> 0:06:31,396
绘制这一帧

194
00:06:31,396 --> 0:06:33,166
实际花费时间

195
00:06:33,166 --> 0:06:34,206
比 16 毫秒要长

196
00:06:34,946 --> 0:06:36,456
因为这个设备

197
00:06:36,456 --> 0:06:39,216
只能在固定时间内

198
00:06:39,216 --> 0:06:41,966
把新的一帧替换到屏幕上

199
00:06:41,966 --> 0:06:43,376
一旦错过截止时间

200
00:06:43,376 --> 0:06:45,196
我们只能把同一帧

201
00:06:45,196 --> 0:06:46,776
显示两帧的时长

202
00:06:46,776 --> 0:06:47,526
这可不太好

203
00:06:48,206 --> 0:06:49,746
为什么会这样呢

204
00:06:49,746 --> 0:06:50,696
在这个例子中

205
00:06:50,696 --> 0:06:52,136
我们已经安装了

206
00:06:52,136 --> 0:06:53,706
Cell 预读取方法

207
00:06:53,706 --> 0:06:55,106
因此我们的数据应该

208
00:06:55,106 --> 0:06:55,606
已经准备好了

209
00:06:55,806 --> 0:06:56,956
理想状态下 这一步应该

210
00:06:56,956 --> 0:06:57,466
完成得更快才对

211
00:06:58,346 --> 0:06:59,256
如果我们再仔细

212
00:06:59,256 --> 0:07:00,286
看一下这个记录

213
00:06:59,256 --> 0:07:00,286
看一下这个记录

214
00:07:00,286 --> 0:07:01,066
就会发现问题所在

215
00:07:01,866 --> 0:07:05,536
这个 Cell 预读取 API 和请求

216
00:07:05,536 --> 0:07:06,826
当前 Cell 的指令

217
00:07:06,826 --> 0:07:07,496
同时被调用

218
00:07:08,056 --> 0:07:09,326
调用的数据

219
00:07:09,326 --> 0:07:10,626
不是为了现有 Cell 的

220
00:07:10,626 --> 0:07:12,976
而是为了之后可能需要的 Cell

221
00:07:12,976 --> 0:07:14,706
但是它们

222
00:07:14,736 --> 0:07:15,606
被同时运行

223
00:07:15,976 --> 0:07:19,616
所以现在 CPU 出现了冲突

224
00:07:19,616 --> 0:07:21,766
是加载当前帧

225
00:07:21,766 --> 0:07:23,146
还是加载现在并不需要

226
00:07:23,146 --> 0:07:24,276
但以后需要的帧

227
00:07:25,736 --> 0:07:27,006
因为这个冲突

228
00:07:27,006 --> 0:07:29,996
两个任务都会花费更多时间

229
00:07:30,666 --> 0:07:33,126
在 iOS 12 里

230
00:07:33,126 --> 0:07:35,226
我们在安排

231
00:07:35,956 --> 0:07:37,166
这些后台预读取操作时

232
00:07:37,166 --> 0:07:39,046
更加智能

233
00:07:39,096 --> 0:07:40,226
这两个步骤会接连发生

234
00:07:40,286 --> 0:07:42,056
而不是同时发生

235
00:07:42,386 --> 0:07:43,776
并产生冲突

236
00:07:44,136 --> 0:07:45,176
这可以缩短

237
00:07:45,176 --> 0:07:47,626
加载当前帧的时间

238
00:07:47,626 --> 0:07:50,886
并且防止丢帧的出现

239
00:07:52,516 --> 0:07:56,456
[ 掌声 ]

240
00:07:56,956 --> 0:07:58,016
这个问题解决之后

241
00:07:58,016 --> 0:08:00,086
我们继续测试 App

242
00:07:58,016 --> 0:08:00,086
我们继续测试 App

243
00:08:00,086 --> 0:08:01,846
会发现另外一个

244
00:08:01,846 --> 0:08:02,756
比较意外的

245
00:08:02,756 --> 0:08:04,676
引起丢帧的问题

246
00:08:05,336 --> 0:08:09,096
我们发现 当设备没有在加载

247
00:08:09,396 --> 0:08:10,276
没有任何后台活动时

248
00:08:10,276 --> 0:08:12,016
我们只是在

249
00:08:12,016 --> 0:08:13,726
前台 App 滑动

250
00:08:14,346 --> 0:08:15,916
奇怪的是

251
00:08:15,916 --> 0:08:18,336
这时可能

252
00:08:18,336 --> 0:08:19,896
比起后台有少量工作时

253
00:08:19,896 --> 0:08:21,766
丢失的帧更多

254
00:08:22,396 --> 0:08:23,866
看起来并不合理

255
00:08:24,366 --> 0:08:25,636
为了弄清这个问题

256
00:08:25,636 --> 0:08:27,306
我们要再深挖一层

257
00:08:27,306 --> 0:08:33,096
看一下 CPU 安排工作负荷时的行为

258
00:08:33,096 --> 0:08:35,196
让我看一下另一个记录

259
00:08:36,306 --> 0:08:37,836
这里有同样的问题

260
00:08:38,206 --> 0:08:39,836
双格蓝色部分

261
00:08:39,836 --> 0:08:42,746
让我们丢失一帧 或者就是丢失帧

262
00:08:43,506 --> 0:08:45,326
这个表格显示

263
00:08:45,326 --> 0:08:47,086
时段里 CPU 的性能

264
00:08:47,686 --> 0:08:49,176
大部分低耗帧时

265
00:08:49,256 --> 0:08:50,876
CPU 性能都维持在

266
00:08:50,876 --> 0:08:52,116
比较低的水平

267
00:08:52,366 --> 0:08:53,806
没有后台任务运行

268
00:08:53,806 --> 0:08:55,256
我们只是在单纯的滚动

269
00:08:55,256 --> 0:08:56,896
这正是我们希望的

270
00:08:56,896 --> 0:08:58,416
因为当我们

271
00:08:58,416 --> 0:08:59,976
不在做高耗工作时

272
00:08:59,976 --> 0:09:01,556
我们希望尽量

273
00:08:59,976 --> 0:09:01,556
我们希望尽量

274
00:09:01,606 --> 0:09:05,186
让 CPU 保持在低水平来节省电量

275
00:09:05,526 --> 0:09:08,566
这很好 但不太好的是

276
00:09:08,646 --> 0:09:11,226
在性能提升前需要一点时间

277
00:09:11,426 --> 0:09:12,716
昨天的演讲中

278
00:09:12,816 --> 0:09:14,566
也提到过这个

279
00:09:14,726 --> 0:09:17,396
等性能提升后

280
00:09:17,396 --> 0:09:18,876
再加载我们

281
00:09:18,876 --> 0:09:20,126
想显示的 Cell

282
00:09:20,126 --> 0:09:21,606
已经太晚了

283
00:09:21,676 --> 0:09:24,016
所以还是丢失了这一帧

284
00:09:24,806 --> 0:09:26,446
现在 因为我们拥有

285
00:09:26,446 --> 0:09:27,616
整个软件栈

286
00:09:27,616 --> 0:09:29,976
在 iOS 12 里

287
00:09:29,976 --> 0:09:33,606
我们把在高级别 UIKit 框架里

288
00:09:33,676 --> 0:09:36,446
滚动时或当临界区域发生时

289
00:09:36,446 --> 0:09:38,016
的所有信息

290
00:09:38,016 --> 0:09:41,296
传递到低级别 CPU 性能控制器

291
00:09:41,326 --> 0:09:42,996
这样就可以

292
00:09:43,116 --> 0:09:45,116
更智能地分析

293
00:09:45,336 --> 0:09:46,546
现有任务

294
00:09:46,756 --> 0:09:50,346
并预测这些高峰何时出现

295
00:09:50,346 --> 0:09:51,926
以及需要多少 CPU 性能

296
00:09:52,006 --> 0:09:53,626
来赶上你 App

297
00:09:53,626 --> 0:09:55,596
历史需求的截止时间

298
00:09:56,486 --> 0:09:58,136
经过这个改变

299
00:09:58,716 --> 0:10:00,346
当加载开始

300
00:09:58,716 --> 0:10:00,346
当加载开始

301
00:10:00,346 --> 0:10:02,066
我们就可以发现

302
00:10:02,066 --> 0:10:03,676
我们更频繁更快地

303
00:10:03,676 --> 0:10:05,746
让 CPU 提升到

304
00:10:05,806 --> 0:10:07,206
需要的程度

305
00:10:07,206 --> 0:10:08,736
来赶上截止时间

306
00:10:08,736 --> 0:10:10,976
以防丢帧出现

307
00:10:12,286 --> 0:10:14,976
这一改变让很多 iOS 的

308
00:10:14,976 --> 0:10:16,226
滚动场景

309
00:10:16,226 --> 0:10:16,976
得到了极大提升

310
00:10:20,956 --> 0:10:24,086
你所有的 App

311
00:10:24,086 --> 0:10:27,146
都可以免费得到提升

312
00:10:27,146 --> 0:10:28,526
而且你不需要

313
00:10:28,526 --> 0:10:29,686
进行任何更多操作

314
00:10:30,156 --> 0:10:31,266
但是还有几件事情

315
00:10:31,266 --> 0:10:32,466
你可以做 来确保

316
00:10:32,466 --> 0:10:34,136
你充分利用了这些特性

317
00:10:34,996 --> 0:10:37,666
首先如果你还没有采用这个

318
00:10:37,666 --> 0:10:39,116
tableView Cell 预读取 API

319
00:10:39,116 --> 0:10:40,596
或者 CollectionView 的 API

320
00:10:40,596 --> 0:10:42,096
一定要先做这个

321
00:10:42,096 --> 0:10:43,336
因为预先准备好数据

322
00:10:43,336 --> 0:10:44,596
是能确保尽快

323
00:10:44,596 --> 0:10:46,836
加载 Cell 的重要步骤

324
00:10:47,406 --> 0:10:50,506
当然 分析

325
00:10:50,506 --> 0:10:51,856
加载 Cell 的

326
00:10:51,856 --> 0:10:53,116
整个临界区域

327
00:10:53,116 --> 0:10:55,186
并尽量减少需求

328
00:10:55,186 --> 0:10:56,076
也是很重要的

329
00:10:56,076 --> 0:10:58,966
iOS 12 会尽力

330
00:10:58,966 --> 0:11:00,416
让 CPU 性能在此期间匹配

331
00:10:58,966 --> 0:11:00,416
让 CPU 性能在此期间匹配

332
00:11:00,416 --> 0:11:01,546
你的 App 的需求

333
00:11:01,616 --> 0:11:03,396
但是你最应该做的

334
00:11:03,396 --> 0:11:04,996
就是保持

335
00:11:04,996 --> 0:11:06,016
减少所需的工作量

336
00:11:06,016 --> 0:11:09,076
以确保给你的客户带来

337
00:11:09,146 --> 0:11:10,336
流畅的滚动体验

338
00:11:11,676 --> 0:11:13,416
这就是 iOS 12 里的滚动部分

339
00:11:14,396 --> 0:11:16,056
接下来让我们关注

340
00:11:16,096 --> 0:11:18,416
下一个性能话题内存

341
00:11:19,626 --> 0:11:21,166
你也许会想

342
00:11:21,166 --> 0:11:22,206
为什么内存会成为

343
00:11:22,206 --> 0:11:23,176
性能讨论中的话题

344
00:11:23,226 --> 0:11:25,726
但是我保证

345
00:11:25,726 --> 0:11:26,966
这其实很必要

346
00:11:26,966 --> 0:11:30,816
实际上是因为内存

347
00:11:30,816 --> 0:11:32,026
就相当于性能

348
00:11:32,746 --> 0:11:34,106
你的 App 使用的

349
00:11:34,196 --> 0:11:36,066
内存越多

350
00:11:36,066 --> 0:11:38,896
对 App 性能的影响越大

351
00:11:39,626 --> 0:11:41,756
要理解这一点

352
00:11:41,756 --> 0:11:43,756
让我们在较高层面

353
00:11:43,756 --> 0:11:45,326
来看一下

354
00:11:45,326 --> 0:11:46,996
通常情况下

355
00:11:46,996 --> 0:11:48,296
系统内存是什么样的

356
00:11:49,136 --> 0:11:50,576
你可以看到

357
00:11:50,576 --> 0:11:52,186
系统的内存

358
00:11:52,186 --> 0:11:54,536
很大部分被其他 App

359
00:11:54,536 --> 0:11:55,666
和系统本身占用

360
00:11:56,276 --> 0:11:57,706
你的 App 现在

361
00:11:57,736 --> 0:11:58,246
占用了一部分

362
00:11:58,676 --> 0:11:59,906
还有一部分

363
00:11:59,906 --> 0:12:02,136
空闲出来

364
00:11:59,906 --> 0:12:02,136
空闲出来

365
00:12:02,136 --> 0:12:03,876
应对新的分配请求

366
00:12:04,546 --> 0:12:05,896
其实那里的很大一部分

367
00:12:05,896 --> 0:12:07,666
都不是真正空闲的

368
00:12:07,666 --> 0:12:08,946
它包含很多东西

369
00:12:08,946 --> 0:12:11,006
比如缓存 或者其他

370
00:12:11,006 --> 0:12:12,426
很快可以被丢弃的内容

371
00:12:12,426 --> 0:12:13,276
以确保内存

372
00:12:13,276 --> 0:12:15,276
可以很快满足需求

373
00:12:15,486 --> 0:12:17,856
但是一般而言

374
00:12:17,856 --> 0:12:19,056
它可能正在被占用

375
00:12:19,056 --> 0:12:21,626
但随时可用

376
00:12:22,546 --> 0:12:23,556
让我们看一下

377
00:12:23,556 --> 0:12:25,276
当你的 App 需要内存时会发生什么

378
00:12:25,906 --> 0:12:29,116
如果你只提出较少的需求

379
00:12:29,156 --> 0:12:31,956
是现有的空闲空间就可以满足的

380
00:12:32,466 --> 0:12:33,516
如果是这样的话

381
00:12:33,516 --> 0:12:35,526
很快就能返回到你的 App

382
00:12:35,526 --> 0:12:36,826
然后你就可以继续

383
00:12:36,826 --> 0:12:37,966
你的工作

384
00:12:39,256 --> 0:12:40,526
但是如果

385
00:12:40,526 --> 0:12:42,136
你的 App 提出了

386
00:12:42,136 --> 0:12:44,326
较大的需求

387
00:12:44,326 --> 0:12:45,756
可能并不需要占用很久

388
00:12:45,756 --> 0:12:47,886
所以你也觉得不用担心

389
00:12:48,246 --> 0:12:49,316
也许你只是需要

390
00:12:49,316 --> 0:12:52,656
从磁盘里加载一个图像并解压

391
00:12:52,656 --> 0:12:54,056
在一些像素上做简单处理

392
00:12:54,056 --> 0:12:55,536
然后就可以丢弃

393
00:12:55,876 --> 0:12:56,926
看起来只是一个

394
00:12:56,926 --> 0:12:57,976
不需要操心的

395
00:12:57,976 --> 0:12:58,806
很快速的操作

396
00:12:59,506 --> 0:13:00,406
我们如果

397
00:12:59,506 --> 0:13:00,406
我们如果

398
00:13:00,406 --> 0:13:02,826
提出这个需求

399
00:13:02,826 --> 0:13:04,556
需要的内存大于

400
00:13:04,556 --> 0:13:05,916
现在系统可提供的

401
00:13:06,176 --> 0:13:09,156
系统无法立刻满足

402
00:13:09,156 --> 0:13:10,566
那么 我们需要从别的地方

403
00:13:10,636 --> 0:13:11,216
得到这些内存

404
00:13:12,206 --> 0:13:13,596
最可能获取的地方

405
00:13:13,596 --> 0:13:15,436
就是别的 App

406
00:13:15,436 --> 0:13:18,756
或者系统内部

407
00:13:18,876 --> 0:13:20,156
你可能并不怎么担心

408
00:13:20,156 --> 0:13:21,106
因为你只是

409
00:13:21,106 --> 0:13:22,106
为你的 App 申请更多内存

410
00:13:22,106 --> 0:13:23,386
所以并不关注

411
00:13:23,386 --> 0:13:24,906
别的地方发生了什么

412
00:13:25,536 --> 0:13:29,356
但实际上这会影响

413
00:13:29,436 --> 0:13:30,696
你的客户接下来

414
00:13:30,696 --> 0:13:32,066
会遇到的事情

415
00:13:32,636 --> 0:13:33,906
更此刻重要的是

416
00:13:33,906 --> 0:13:35,496
它也会对你的 App

417
00:13:35,496 --> 0:13:37,146
产生影响

418
00:13:37,146 --> 0:13:39,106
因为系统需要

419
00:13:39,106 --> 0:13:41,126
为你获取这些内存

420
00:13:41,366 --> 0:13:42,666
因为内存现在无法提供

421
00:13:42,666 --> 0:13:44,776
所以内核需要

422
00:13:44,776 --> 0:13:46,936
从别处获取

423
00:13:46,936 --> 0:13:49,446
并运作 CPU

424
00:13:49,446 --> 0:13:50,216
来满足需求

425
00:13:50,726 --> 0:13:53,386
而为此花费的时间

426
00:13:53,416 --> 0:13:54,796
其实可以更好的

427
00:13:54,796 --> 0:13:56,466
花在你的 App 上

428
00:13:57,126 --> 0:13:58,656
所以找到

429
00:13:58,686 --> 0:14:00,036
分解这些大块需求

430
00:13:58,686 --> 0:14:00,036
分解这些大块需求

431
00:14:00,036 --> 0:14:01,376
或者减少整体需求高峰

432
00:14:01,376 --> 0:14:03,376
的方法 实际上

433
00:14:03,496 --> 0:14:05,186
对提升你的 App 的性能

434
00:14:05,186 --> 0:14:07,236
以及客户接下来

435
00:14:07,236 --> 0:14:08,816
使用其他 App 的体验

436
00:14:08,816 --> 0:14:10,716
都有很大影响

437
00:14:12,716 --> 0:14:14,006
有很多方法

438
00:14:14,006 --> 0:14:17,806
可以减少 APP 内存使用量

439
00:14:17,806 --> 0:14:19,146
其中一个很好的方法

440
00:14:19,146 --> 0:14:20,326
就是用 profile 和 instruments

441
00:14:20,746 --> 0:14:21,886
不过今天上午 

442
00:14:21,886 --> 0:14:23,496
我们要了解一个

443
00:14:23,496 --> 0:14:25,306
iOS 12 里

444
00:14:25,306 --> 0:14:29,216
帮助减少 App 使用内存的新技术

445
00:14:29,216 --> 0:14:30,786
这就是 Automatic Backing Stores

446
00:14:31,856 --> 0:14:32,966
打个比方

447
00:14:32,966 --> 0:14:34,616
我们要在 iPhone X 里

448
00:14:34,656 --> 0:14:36,356
让这个土拨鼠变成肖像模式

449
00:14:37,266 --> 0:14:38,893
这会是多大呢？

450
00:14:39,436 --> 0:14:41,666
iPhone X 的肖像模式

451
00:14:41,736 --> 0:14:43,376
宽 375 点

452
00:14:43,376 --> 0:14:45,346
为保持相同比例

453
00:14:45,346 --> 0:14:46,176
就是 250 点高

454
00:14:46,706 --> 0:14:48,646
这样会占用

455
00:14:48,646 --> 0:14:48,896
多少内存呢

456
00:14:49,536 --> 0:14:54,956
375 乘 250 乘 @3x

457
00:14:54,956 --> 0:14:56,346
再乘上 64 位每像素

458
00:14:56,346 --> 0:14:58,226
因为这是一个色深设备

459
00:14:58,226 --> 0:15:00,406
等于 2.2 M

460
00:14:58,226 --> 0:15:00,406
等于 2.2 M

461
00:15:00,406 --> 0:15:00,976
这是绘制一只土拨鼠需要的内存量

462
00:15:02,096 --> 0:15:03,426
这个数据看起来很合理

463
00:15:03,426 --> 0:15:05,186
这是当内存

464
00:15:05,186 --> 0:15:06,966
很好地配置时的情况

465
00:15:07,216 --> 0:15:08,306
我们想要保留这个

466
00:15:08,306 --> 0:15:10,226
保真度很好的图像

467
00:15:10,226 --> 0:15:11,816
这就是把图像

468
00:15:11,816 --> 0:15:13,116
放在缓存里

469
00:15:13,116 --> 0:15:13,736
所需要的内存量

470
00:15:14,086 --> 0:15:15,576
这是在预料之中的

471
00:15:16,376 --> 0:15:20,266
但是如果我们要绘制一个

472
00:15:20,266 --> 0:15:21,316
低保真度版本的土拨鼠

473
00:15:21,626 --> 0:15:23,416
比如用 Apple Pencil 和 iPad

474
00:15:23,416 --> 0:15:27,666
绘制出的黑白色的简单图形

475
00:15:28,196 --> 0:15:29,456
就像这样

476
00:15:30,496 --> 0:15:32,636
这个低保真度版本的土拨鼠

477
00:15:32,866 --> 0:15:34,606
又需要占用多少内存呢

478
00:15:35,506 --> 0:15:37,556
其实占用的内存量

479
00:15:37,556 --> 0:15:38,766
是一样多的

480
00:15:39,266 --> 0:15:41,286
这显然没有

481
00:15:41,286 --> 0:15:42,236
很好的利用内存

482
00:15:42,236 --> 0:15:43,306
全都是灰度图

483
00:15:43,796 --> 0:15:45,236
所有的色深信息

484
00:15:45,646 --> 0:15:47,436
在这个图像中

485
00:15:47,436 --> 0:15:48,736
都没有被使用

486
00:15:49,196 --> 0:15:50,416
我们希望找到更好的方法

487
00:15:50,466 --> 0:15:53,456
而 iOS 12 中引入的

488
00:15:53,456 --> 0:15:54,906
Automatic Backing Store 上支持

489
00:15:54,906 --> 0:15:57,686
正好做到了这一点

490
00:15:58,766 --> 0:16:00,866
所有安装了

491
00:15:58,766 --> 0:16:00,866
所有安装了

492
00:16:00,866 --> 0:16:02,176
draw Rect 的视图

493
00:16:02,296 --> 0:16:04,826
它们的 Backing Stores

494
00:16:04,826 --> 0:16:06,126
都会由被写入内容的

495
00:16:06,126 --> 0:16:06,986
深度来决定

496
00:16:07,376 --> 0:16:08,366
因此 当我们用

497
00:16:08,366 --> 0:16:09,796
Core Graphics 来绘制

498
00:16:09,796 --> 0:16:11,906
只有灰度的内容时

499
00:16:11,906 --> 0:16:15,186
会自动使用 8 位的 Backing Stores

500
00:16:15,366 --> 0:16:17,436
而不是 64 位的

501
00:16:17,946 --> 0:16:19,466
对内存的需求量

502
00:16:19,466 --> 0:16:21,226
成量级减少

503
00:16:21,226 --> 0:16:26,216
从 2.2 M 降低成 275 K

504
00:16:26,216 --> 0:16:28,806
这对于很多 App 来说

505
00:16:28,806 --> 0:16:29,956
都是很大的改进

506
00:16:29,956 --> 0:16:30,966
对于你们的 App 和我们的都是

507
00:16:31,516 --> 0:16:36,356
[ 掌声 ]

508
00:16:36,856 --> 0:16:38,266
用 iOS 12 SDK

509
00:16:38,266 --> 0:16:40,206
创建的所有 App

510
00:16:40,266 --> 0:16:41,646
都可以采用 Automatic Backing Stores

511
00:16:42,586 --> 0:16:44,806
所有在 UIView 上

512
00:16:44,806 --> 0:16:46,316
安装了 draw Rect 的

513
00:16:46,396 --> 0:16:48,476
都会自动采用

514
00:16:48,476 --> 0:16:49,856
用 UIGraphicsImageRenderer

515
00:16:49,856 --> 0:16:52,316
绘制到离屏位图的内容也一样

516
00:16:53,156 --> 0:16:54,436
用 UIGraphicsImageRenderer 时

517
00:16:54,436 --> 0:16:55,856
我们并不知道

518
00:16:55,856 --> 0:16:58,896
你打算把你获取的图片

519
00:16:58,896 --> 0:17:00,086
用来做什么

520
00:16:58,896 --> 0:17:00,086
用来做什么

521
00:17:00,606 --> 0:17:02,516
所以 如果你知道

522
00:17:02,516 --> 0:17:03,866
这个自动行为

523
00:17:03,866 --> 0:17:05,675
并不是你想要的

524
00:17:05,675 --> 0:17:07,146
你可以在 ImageRenderer

525
00:17:07,146 --> 0:17:09,106
制定某个你想要的

526
00:17:09,106 --> 0:17:10,636
特定的 Backing Stores 模式

527
00:17:10,636 --> 0:17:12,386
比如用 newRange API

528
00:17:12,715 --> 0:17:13,915
来定制你想要的

529
00:17:13,915 --> 0:17:15,306
扩充域图像

530
00:17:15,866 --> 0:17:17,626
更多关于这个

531
00:17:18,006 --> 0:17:20,306
和其他有关 UI Image 的技术

532
00:17:20,306 --> 0:17:22,205
你可以在这周的

533
00:17:22,205 --> 0:17:24,455
图像和图形的最佳实践会议中了解到

534
00:17:24,915 --> 0:17:27,656
这就是关于性能的第二个主题

535
00:17:28,425 --> 0:17:30,636
接下来 让我们聊一聊自动布局

536
00:17:31,756 --> 0:17:34,766
现在 iOS 10 中的自动布局

537
00:17:34,986 --> 0:17:36,386
有一些很大的进步

538
00:17:36,866 --> 0:17:37,946
我们团队很努力地

539
00:17:37,946 --> 0:17:40,076
为你的 App

540
00:17:40,076 --> 0:17:42,076
尽可能优化自动布局

541
00:17:42,676 --> 0:17:44,726
所以你会发现

542
00:17:44,726 --> 0:17:47,146
自动布局在 iOS 12 中默认更快了

543
00:17:47,556 --> 0:17:49,096
我们会讲到在好几种情况下都是这样的

544
00:17:49,996 --> 0:17:52,016
当团队在分析和优化

545
00:17:52,016 --> 0:17:53,406
自动布局时

546
00:17:53,406 --> 0:17:54,866
他们在系统中

547
00:17:54,946 --> 0:17:56,476
看了很多我们自己的 App

548
00:17:56,476 --> 0:17:57,896
如何使用自动布局的情况

549
00:17:57,896 --> 0:17:59,686
然后发现了一些

550
00:17:59,686 --> 0:18:00,726
不同的 App

551
00:17:59,686 --> 0:18:00,726
不同的 App

552
00:18:00,726 --> 0:18:02,496
可能遇到的

553
00:18:02,566 --> 0:18:03,546
比较普遍的陷阱

554
00:18:04,026 --> 0:18:05,086
所以我们会

555
00:18:05,156 --> 0:18:06,406
向你们展示一些简单的方法

556
00:18:06,406 --> 0:18:08,376
让你们可以

557
00:18:08,376 --> 0:18:09,486
优化你们的 App

558
00:18:10,796 --> 0:18:11,766
今天 让我们先了解一下

559
00:18:11,816 --> 0:18:13,466
自动布局在 iOS 12 中     

560
00:18:13,466 --> 0:18:16,306
怎样能做到更快 

561
00:18:16,386 --> 0:18:17,976
我们首先要知道

562
00:18:18,016 --> 0:18:20,996
当我们在普遍用户场景中

563
00:18:20,996 --> 0:18:23,336
添加更多视图时

564
00:18:23,446 --> 0:18:24,296
自动布局的渐近行为

565
00:18:25,646 --> 0:18:26,346
这样做的原因是

566
00:18:26,346 --> 0:18:28,196
讨论渐近性

567
00:18:28,196 --> 0:18:29,476
是想了解

568
00:18:29,476 --> 0:18:31,056
如果我们大量增加视图

569
00:18:31,056 --> 0:18:31,956
会发生什么

570
00:18:32,366 --> 0:18:33,776
如果我们一下增加

571
00:18:33,776 --> 0:18:35,486
非常多的视图

572
00:18:35,486 --> 0:18:37,216
可以很快地让

573
00:18:37,216 --> 0:18:38,356
性能问题显现

574
00:18:38,866 --> 0:18:40,186
这样可以帮助我们看清楚

575
00:18:40,406 --> 0:18:41,776
这次优化

576
00:18:41,776 --> 0:18:43,316
即使对少量视窗

577
00:18:43,316 --> 0:18:44,906
也有提速作用

578
00:18:45,366 --> 0:18:46,506
让我们从普通模式开始

579
00:18:46,506 --> 0:18:48,366
最简单的

580
00:18:48,366 --> 0:18:50,246
一个容器里的

581
00:18:50,246 --> 0:18:52,576
Independent Sibling Views

582
00:18:53,006 --> 0:18:54,156
这些视图的位置

583
00:18:54,156 --> 0:18:55,386
受到容器

584
00:18:55,386 --> 0:18:57,596
或者其他视图的约束

585
00:18:57,596 --> 0:18:58,536
但彼此之间并没有约束

586
00:18:58,666 --> 0:18:59,876
它们相互独立

587
00:19:00,636 --> 0:19:02,846
在 iOS 11 里

588
00:19:02,846 --> 0:19:06,246
添加这些 Independent Siblings 的成本

589
00:19:06,246 --> 0:19:06,816
线性上升

590
00:19:07,526 --> 0:19:08,996
这很棒

591
00:19:08,996 --> 0:19:10,536
这应该正是

592
00:19:10,536 --> 0:19:11,906
你所预料到的

593
00:19:12,306 --> 0:19:13,706
也就是说

594
00:19:13,706 --> 0:19:15,116
每添加一个

595
00:19:15,116 --> 0:19:17,046
独立于其他视图的层级的

596
00:19:17,046 --> 0:19:18,326
新的视图

597
00:19:18,326 --> 0:19:19,876
增加的成本

598
00:19:19,876 --> 0:19:21,336
都是固定的

599
00:19:22,516 --> 0:19:23,406
因为这已经

600
00:19:23,506 --> 0:19:24,896
和我们期待的

601
00:19:24,896 --> 0:19:26,746
增长指数一样

602
00:19:26,746 --> 0:19:28,976
所以在 iOS 12 里依旧如此

603
00:19:29,096 --> 0:19:30,966
但是我们的团队很努力地

604
00:19:30,966 --> 0:19:33,386
想减少这个固定成本

605
00:19:33,386 --> 0:19:34,956
希望使添加视图变得

606
00:19:35,146 --> 0:19:36,076
更加容易

607
00:19:37,376 --> 0:19:38,326
让我们来看一个

608
00:19:38,326 --> 0:19:39,596
更有趣的例子

609
00:19:39,986 --> 0:19:42,236
这次让我们看一下

610
00:19:42,236 --> 0:19:42,846
Dependent Siblings

611
00:19:43,326 --> 0:19:46,826
这里有好几个子视图

612
00:19:46,826 --> 0:19:47,676
它们彼此之间

613
00:19:47,726 --> 0:19:49,296
相互约束

614
00:19:49,296 --> 0:19:51,616
他们的布局相互影响

615
00:19:52,666 --> 0:19:54,536
在 iOS 11 里

616
00:19:54,896 --> 0:19:56,226
渐近性的表现

617
00:19:56,226 --> 0:19:58,206
并不很好

618
00:19:58,206 --> 0:20:00,316
实际上是以指数级增长的

619
00:19:58,206 --> 0:20:00,316
实际上是以指数级增长的

620
00:20:00,686 --> 0:20:03,186
随着视图的增加

621
00:20:03,186 --> 0:20:04,786
添加新的视图

622
00:20:04,786 --> 0:20:05,976
会使成本大幅度增加

623
00:20:07,826 --> 0:20:09,146
我们团队

624
00:20:09,146 --> 0:20:10,396
努力地识别出

625
00:20:10,396 --> 0:20:12,796
这一指数级增长的原因

626
00:20:12,796 --> 0:20:14,436
并修正了算法

627
00:20:14,436 --> 0:20:14,826
解决这一问题

628
00:20:15,386 --> 0:20:17,976
在 iOS 12 中它们也以线性增长了

629
00:20:18,516 --> 0:20:23,396
[ 掌声 ]

630
00:20:23,896 --> 0:20:24,866
同时 我们团队

631
00:20:24,866 --> 0:20:25,956
也在努力的减少

632
00:20:25,956 --> 0:20:28,016
这些固定成本

633
00:20:29,096 --> 0:20:31,366
现在除了 Dependent Siblings

634
00:20:31,366 --> 0:20:32,506
还有一种其他的布局类型

635
00:20:32,506 --> 0:20:34,056
Nested Views

636
00:20:34,056 --> 0:20:35,656
当一个视图在另一个视图里

637
00:20:35,726 --> 0:20:37,706
并且被外面的视图所限制

638
00:20:38,136 --> 0:20:39,506
这是你的 App 里

639
00:20:39,586 --> 0:20:41,586
一个很常见的模式

640
00:20:41,586 --> 0:20:42,866
然而在 iOS 11 里

641
00:20:42,956 --> 0:20:44,566
我们遇到相同的

642
00:20:44,566 --> 0:20:45,286
指数级增长

643
00:20:45,966 --> 0:20:47,456
又一个好消息

644
00:20:47,456 --> 0:20:48,726
在 iOS 12 里

645
00:20:48,796 --> 0:20:49,836
这个也变成线性的了

646
00:20:50,516 --> 0:20:54,546
[ 掌声 ]

647
00:20:55,046 --> 0:20:56,566
iOS 12 的自动布局

648
00:20:56,566 --> 0:20:58,226
有很多改进

649
00:20:58,226 --> 0:21:00,256
你只要用 iOS 12

650
00:20:58,226 --> 0:21:00,256
你只要用 iOS 12

651
00:21:00,256 --> 0:21:01,346
运行你的 App

652
00:21:01,346 --> 0:21:02,406
就能发现这些

653
00:21:02,406 --> 0:21:03,936
改进的地方

654
00:21:04,646 --> 0:21:06,296
如果想获取更多内容

655
00:21:06,956 --> 0:21:08,886
想了解更多

656
00:21:08,976 --> 0:21:11,016
获得更好的直觉

657
00:21:11,586 --> 0:21:13,346
了解关于不同布局的性能

658
00:21:13,346 --> 0:21:15,446
以及一些

659
00:21:15,446 --> 0:21:16,846
我刚才提到的

660
00:21:16,846 --> 0:21:18,596
普遍的陷阱

661
00:21:18,896 --> 0:21:19,996
请一定关注

662
00:21:19,996 --> 0:21:21,326
这周晚些时候的

663
00:21:21,436 --> 0:21:22,726
高性能自动布局会议

664
00:21:23,636 --> 0:21:26,156
最后的主题是框架更新

665
00:21:26,156 --> 0:21:28,216
让我们了解一下

666
00:21:28,216 --> 0:21:29,106
Swiftification

667
00:21:29,676 --> 0:21:32,906
你应该听说了 iOS 12 引入了

668
00:21:32,986 --> 0:21:34,136
Swift 4.2

669
00:21:34,586 --> 0:21:36,116
在 Swift 4.2 里

670
00:21:36,116 --> 0:21:38,326
我们希望确保

671
00:21:38,406 --> 0:21:40,596
UIKit 在你的 App 里

672
00:21:40,596 --> 0:21:42,676
用 Swift 时能有很好的体验

673
00:21:43,026 --> 0:21:44,376
尤其是当它和

674
00:21:44,376 --> 0:21:45,726
其他 Swift Standard Library

675
00:21:45,726 --> 0:21:48,786
或者和 Swift 有相同模式的地方互动时

676
00:21:49,606 --> 0:21:51,906
所以我们测试了所有的 UIKit 

677
00:21:51,906 --> 0:21:53,376
并确保一切

678
00:21:53,376 --> 0:21:54,936
都很合适

679
00:21:55,636 --> 0:21:56,936
而且 我们还让

680
00:21:56,936 --> 0:21:58,226
我们对 UIKit

681
00:21:58,226 --> 0:22:00,096
做出的改变

682
00:21:58,226 --> 0:22:00,096
做出的改变

683
00:22:00,096 --> 0:22:01,706
都能够自动迁移 

684
00:22:01,706 --> 0:22:03,966
这样你不用做任何更多的操作

685
00:22:03,966 --> 0:22:04,536
就能得到这些更新

686
00:22:05,746 --> 0:22:07,536
有关这些更新

687
00:22:07,536 --> 0:22:08,766
我们今天上午主要讨论

688
00:22:08,766 --> 0:22:09,736
三个方面

689
00:22:10,016 --> 0:22:11,756
其实如果你看一下 SDK

690
00:22:11,756 --> 0:22:13,856
就会发现

691
00:22:13,856 --> 0:22:15,816
有非常多一致性的改进

692
00:22:16,566 --> 0:22:17,326
但是今天我们只讨论

693
00:22:17,326 --> 0:22:19,586
嵌套类型 常量和函数

694
00:22:19,656 --> 0:22:22,636
首先是嵌套类型

695
00:22:23,516 --> 0:22:25,476
在 Swift 4 中

696
00:22:25,476 --> 0:22:26,776
全局命名空间中

697
00:22:26,776 --> 0:22:28,766
有很多不同类型

698
00:22:28,806 --> 0:22:30,006
比如 UIApplicationState

699
00:22:30,666 --> 0:22:32,916
像这样跟其他的类

700
00:22:32,966 --> 0:22:35,096
有很强的联系的类型

701
00:22:35,096 --> 0:22:37,276
我们让它们直接

702
00:22:37,276 --> 0:22:38,016
嵌套进这一类

703
00:22:38,796 --> 0:22:39,746
所以现在所有的

704
00:22:39,746 --> 0:22:42,156
枚举和其他

705
00:22:42,206 --> 0:22:43,796
这类的全局类型

706
00:22:43,796 --> 0:22:46,576
现在变成了相关类的子类型

707
00:22:46,906 --> 0:22:47,576
现在变成了

708
00:22:47,576 --> 0:22:49,326
UIApplication.State

709
00:22:49,796 --> 0:22:51,536
这样更清晰地

710
00:22:51,536 --> 0:22:52,786
表明两者之间的关系

711
00:22:52,786 --> 0:22:54,216
并且让它们

712
00:22:54,216 --> 0:22:55,276
更容易找到

713
00:22:56,046 --> 0:22:57,546
很多情况下

714
00:22:57,546 --> 0:23:00,286
这样可以帮助理解

715
00:22:57,546 --> 0:23:00,286
这样可以帮助理解

716
00:23:00,286 --> 0:23:02,246
减少混淆

717
00:23:02,696 --> 0:23:03,546
让我们看一下

718
00:23:03,546 --> 0:23:05,016
UITabBarItemPositioning

719
00:23:05,626 --> 0:23:06,216
你觉得这应该是

720
00:23:06,306 --> 0:23:09,086
UITabBar ItemPositioning

721
00:23:09,226 --> 0:23:10,896
还是 UITabBarItem Positioning

722
00:23:10,896 --> 0:23:12,586
两者都有可能

723
00:23:12,836 --> 0:23:13,906
两个类都是

724
00:23:14,406 --> 0:23:16,546
在 Swift 4.2 里

725
00:23:16,616 --> 0:23:17,726
现在变得非常清楚

726
00:23:17,726 --> 0:23:20,066
实际是 UITabBar ItemPositioning

727
00:23:20,646 --> 0:23:23,226
除了嵌套类型

728
00:23:23,546 --> 0:23:25,666
我们还嵌套了很多常量

729
00:23:26,106 --> 0:23:27,486
在 Swift 4 里

730
00:23:27,486 --> 0:23:29,926
NSNotifications

731
00:23:29,926 --> 0:23:30,636
都在 NSNotification.Name 的

732
00:23:30,706 --> 0:23:32,796
全局命名空间

733
00:23:33,206 --> 0:23:34,616
他们相关的

734
00:23:34,616 --> 0:23:35,956
UserInfoKey

735
00:23:35,956 --> 0:23:37,386
其实只是在外面的全局常量

736
00:23:38,026 --> 0:23:39,676
为了和 AppKit 保持一致

737
00:23:39,676 --> 0:23:41,146
更容易找到

738
00:23:41,146 --> 0:23:42,656
并且把这些类型联系在一起

739
00:23:42,706 --> 0:23:44,196
它们现在都被

740
00:23:44,196 --> 0:23:46,026
嵌套在他们使用的类之下

741
00:23:46,456 --> 0:23:49,006
所以 didChangeStatusBarOrientation

742
00:23:49,316 --> 0:23:51,336
现在是在 UIApplication 下的 didChange

743
00:23:51,336 --> 0:23:52,346
StatusBarOrientationNotification

744
00:23:52,346 --> 0:23:54,106
它的 UserInfoKey

745
00:23:54,106 --> 0:23:55,436
和它在一块儿

746
00:23:55,436 --> 0:23:56,486
位于相同位置

747
00:23:57,126 --> 0:23:59,656
我们检查了

748
00:23:59,656 --> 0:24:01,326
所有其他 UIKit

749
00:23:59,656 --> 0:24:01,326
所有其他 UIKit

750
00:24:01,326 --> 0:24:03,806
里的全局常量

751
00:24:03,806 --> 0:24:05,006
并把它们嵌套在该有的位置

752
00:24:05,346 --> 0:24:06,486
所以像 UIFloatRangeZero

753
00:24:06,486 --> 0:24:08,536
和 UIFloatRangeInfinite

754
00:24:08,536 --> 0:24:10,216
现在都变成

755
00:24:10,216 --> 0:24:12,396
UIFloatRange 的属性

756
00:24:12,396 --> 0:24:14,786
这样就更容易找到和使用

757
00:24:15,096 --> 0:24:16,686
在需要 UIFloatRange 的地方

758
00:24:16,686 --> 0:24:18,096
你可以输入

759
00:24:18,206 --> 0:24:20,386
.zero 或者 .infinite

760
00:24:20,616 --> 0:24:21,656
因为它们现在是属性了

761
00:24:21,906 --> 0:24:23,226
Xcode 可以帮你

762
00:24:23,226 --> 0:24:24,866
自动完成

763
00:24:24,866 --> 0:24:26,666
放置在应该的位置上

764
00:24:27,776 --> 0:24:29,046
除了常量

765
00:24:29,046 --> 0:24:30,316
我们也测试了

766
00:24:30,316 --> 0:24:31,056
所有的全局函数

767
00:24:31,536 --> 0:24:32,776
UIEdgeInserts

768
00:24:32,776 --> 0:24:36,206
和 UIImage

769
00:24:36,206 --> 0:24:37,376
为了在不同的类型上运行

770
00:24:37,376 --> 0:24:38,076
有一些全局函数

771
00:24:38,556 --> 0:24:40,326
在 Swift 4.2 里

772
00:24:40,326 --> 0:24:43,796
这些变成了类型的方法

773
00:24:44,576 --> 0:24:46,286
所以现在要 insetRect

774
00:24:46,326 --> 0:24:48,196
或者从图像里提取

775
00:24:48,196 --> 0:24:51,046
pngData 都可以很容易

776
00:24:52,516 --> 0:24:57,166
[ 掌声 ]

777
00:24:57,666 --> 0:24:59,176
接下来 今天上午还有

778
00:24:59,176 --> 0:25:00,286
我还想要聊一聊

779
00:24:59,176 --> 0:25:00,286
我还想要聊一聊

780
00:25:00,286 --> 0:25:01,236
另外一大类函数

781
00:25:01,236 --> 0:25:02,446
就是所有的

782
00:25:02,446 --> 0:25:03,956
String Conversion 函数

783
00:25:03,956 --> 0:25:05,306
UIKit 里面的所有类型

784
00:25:05,776 --> 0:25:07,206
CGPoint CGRect CGSize CGVector

785
00:25:07,346 --> 0:25:09,706
所有的这些

786
00:25:09,706 --> 0:25:11,726
有很多 既可以是转换到字符串

787
00:25:11,726 --> 0:25:12,106
也可以反过来

788
00:25:12,516 --> 0:25:14,676
当我们想决定

789
00:25:14,676 --> 0:25:15,386
它们应该放在哪里时

790
00:25:15,386 --> 0:25:16,836
就会发现

791
00:25:16,836 --> 0:25:19,086
它们其实有两种用途

792
00:25:19,386 --> 0:25:21,216
一个是编码和解码

793
00:25:21,676 --> 0:25:24,276
另一个是它们总用来 print

794
00:25:24,466 --> 0:25:25,296
当你想得到

795
00:25:25,296 --> 0:25:26,276
debug 描述时

796
00:25:26,826 --> 0:25:28,586
这两个用途很不一样

797
00:25:28,586 --> 0:25:30,886
但其实 Swift 对 

798
00:25:30,946 --> 0:25:33,166
这两种用途 都有一级支持

799
00:25:33,626 --> 0:25:34,846
我们现在可以确保

800
00:25:34,846 --> 0:25:36,166
所有的类型

801
00:25:36,166 --> 0:25:37,436
和 Swift 的内置支持

802
00:25:37,436 --> 0:25:38,156
都可以和谐共处

803
00:25:38,776 --> 0:25:40,706
在 Swift 4.2 里

804
00:25:40,786 --> 0:25:42,436
所有的类型都变得可编码

805
00:25:42,706 --> 0:25:44,526
这样你可以很容易的

806
00:25:44,526 --> 0:25:46,146
给这些类型

807
00:25:46,146 --> 0:25:47,896
编码和解码 JSON 

808
00:25:48,516 --> 0:25:53,656
[ 掌声 ]

809
00:25:54,156 --> 0:25:55,236
在 Swift 里 debug printing

810
00:25:55,306 --> 0:25:56,766
其实比在

811
00:25:56,766 --> 0:25:58,296
Objective-C 更容易

812
00:25:58,296 --> 0:26:00,106
因为你不需要

813
00:25:58,296 --> 0:26:00,106
因为你不需要

814
00:26:00,106 --> 0:26:00,706
其他额外转换

815
00:26:01,276 --> 0:26:03,246
这些类型的内省

816
00:26:03,246 --> 0:26:04,916
可以让你直接 print 它们

817
00:26:05,226 --> 0:26:06,396
在 Swift 4.2 里

818
00:26:06,396 --> 0:26:07,486
你可以直接把这些类型

819
00:26:07,486 --> 0:26:08,726
传输到 print 函数

820
00:26:09,146 --> 0:26:10,416
如果你希望为了 debug 把它们 print 出来

821
00:26:10,446 --> 0:26:12,056
或者 log 它们

822
00:26:12,916 --> 0:26:15,786
最后如果你已经有一个代码

823
00:26:15,786 --> 0:26:17,196
用的是旧的

824
00:26:17,196 --> 0:26:18,826
string conversion 函数

825
00:26:18,826 --> 0:26:20,986
并且需要一个兼容函数

826
00:26:20,986 --> 0:26:22,766
来继续进行

827
00:26:23,366 --> 0:26:24,346
我们已经

828
00:26:24,346 --> 0:26:25,476
把它们都重命名

829
00:26:25,476 --> 0:26:28,126
并变成 NSCoder 里的属性

830
00:26:28,526 --> 0:26:29,826
这可以帮助

831
00:26:29,826 --> 0:26:30,926
用来强调这些方法

832
00:26:30,926 --> 0:26:32,516
的目的是

833
00:26:32,516 --> 0:26:34,276
编码和解码

834
00:26:34,276 --> 0:26:36,066
这样把它们放过去就很自然

835
00:26:37,966 --> 0:26:39,476
这只是一部分

836
00:26:39,476 --> 0:26:40,666
你会在 iOS 12

837
00:26:40,666 --> 0:26:43,106
Swift 4.2 的 SDK 里

838
00:26:43,806 --> 0:26:46,946
发现改进的地方

839
00:26:46,946 --> 0:26:48,056
但其实还有更多

840
00:26:49,476 --> 0:26:51,176
说到编码和解码

841
00:26:51,176 --> 0:26:54,246
NSSecureCoding

842
00:26:55,096 --> 0:26:57,566
在 iOS 12 里

843
00:26:57,566 --> 0:26:59,456
有新的默认安全

844
00:26:59,456 --> 0:26:59,856
编码解码 API

845
00:27:01,246 --> 0:27:02,846
为所有在 NSKeyedArchiver 上的编码需求

846
00:27:02,846 --> 0:27:04,546
采用 NSSecureCoding

847
00:27:04,586 --> 0:27:07,056
是非常重要的

848
00:27:07,056 --> 0:27:08,186
以防止你的客户

849
00:27:08,186 --> 0:27:11,646
受到恶意和损坏数据的影响

850
00:27:12,606 --> 0:27:13,876
你会发现

851
00:27:13,876 --> 0:27:15,856
旧的不安全的 API 没有被弃用

852
00:27:16,776 --> 0:27:18,396
更多的内容

853
00:27:18,396 --> 0:27:20,066
以及相关细节

854
00:27:20,156 --> 0:27:21,346
你可以在周四 9 点的

855
00:27:21,346 --> 0:27:23,266
可信任的数据会议了解到

856
00:27:23,826 --> 0:27:25,996
这就是关于框架更新的内容

857
00:27:26,946 --> 0:27:28,496
下面 让我们了解一下

858
00:27:28,586 --> 0:27:32,486
对一些现有 API 的增强

859
00:27:32,486 --> 0:27:33,466
首先是通知

860
00:27:34,256 --> 0:27:36,096
在 iOS 12 里

861
00:27:36,096 --> 0:27:37,756
通知有很多新的改进

862
00:27:37,756 --> 0:27:39,296
但是今天

863
00:27:39,296 --> 0:27:40,436
我们主要关注三点

864
00:27:41,176 --> 0:27:42,496
自定义通知内的交互

865
00:27:42,496 --> 0:27:44,376
通知分组

866
00:27:44,376 --> 0:27:46,326
和在你的 App 里

867
00:27:46,326 --> 0:27:47,866
如何访问

868
00:27:47,866 --> 0:27:48,696
通知设置

869
00:27:50,206 --> 0:27:51,606
首先是交互

870
00:27:52,286 --> 0:27:56,486
现在个性化通知允许你

871
00:27:56,486 --> 0:28:00,686
为通知定义一组预先行为

872
00:27:56,486 --> 0:28:00,686
为通知定义一组预先行为

873
00:28:01,246 --> 0:28:03,436
在 iOS 12 里 这些行为

874
00:28:03,436 --> 0:28:04,756
不再是静态的

875
00:28:05,136 --> 0:28:05,856
它可以以编程方式定义

876
00:28:05,906 --> 0:28:07,506
你也可以在运行时 

877
00:28:07,506 --> 0:28:09,406
改变它们

878
00:28:09,536 --> 0:28:11,916
除了这些行为

879
00:28:12,296 --> 0:28:13,956
更棒的是

880
00:28:13,956 --> 0:28:16,226
通知本身也可以

881
00:28:16,226 --> 0:28:17,616
变成交互的

882
00:28:18,156 --> 0:28:21,286
比如说这里信息允许你

883
00:28:21,366 --> 0:28:23,266
直接在通知中

884
00:28:23,466 --> 0:28:26,046
快速进行回复

885
00:28:28,066 --> 0:28:29,266
除了交互

886
00:28:29,596 --> 0:28:32,026
iOS 12 还可以

887
00:28:32,026 --> 0:28:33,796
默认通知分组

888
00:28:33,796 --> 0:28:34,846
这个默认行为

889
00:28:34,886 --> 0:28:36,536
可以把某个

890
00:28:36,536 --> 0:28:38,816
特定 App 的通知分为一组

891
00:28:39,246 --> 0:28:42,296
当然你的 App 可能需要

892
00:28:42,296 --> 0:28:44,256
更细化的分组

893
00:28:44,256 --> 0:28:46,036
比如 iMessage  

894
00:28:46,036 --> 0:28:47,296
可以把某一个对话的信息

895
00:28:47,296 --> 0:28:49,046
分为一组

896
00:28:49,116 --> 0:28:50,556
和别的从同一 App 来的通知

897
00:28:50,596 --> 0:28:51,836
分离开来

898
00:28:53,116 --> 0:28:54,536
现在你的 App 也可以这样

899
00:28:54,536 --> 0:28:56,716
你只要用一个

900
00:28:56,716 --> 0:28:58,706
特定的 thread identifier

901
00:28:58,806 --> 0:29:00,526
来标记你的通知

902
00:28:58,806 --> 0:29:00,526
来标记你的通知

903
00:29:00,526 --> 0:29:01,776
那么那个 thread identifier

904
00:29:01,856 --> 0:29:03,976
下的所有通知

905
00:29:03,976 --> 0:29:04,586
都会成为单独一组

906
00:29:05,106 --> 0:29:08,106
iOS 12 里

907
00:29:08,106 --> 0:29:10,746
通知的 UI 更新

908
00:29:10,746 --> 0:29:13,246
也能够让用户

909
00:29:13,246 --> 0:29:16,026
个性化设置

910
00:29:16,026 --> 0:29:17,526
通知的推送

911
00:29:18,436 --> 0:29:21,436
当然你的 App 可能也包含

912
00:29:21,436 --> 0:29:22,996
一些对通知管理的

913
00:29:22,996 --> 0:29:25,876
更细化的控制

914
00:29:26,436 --> 0:29:28,316
iOS 12 有一个新的 API

915
00:29:28,536 --> 0:29:29,686
能够让你的用户

916
00:29:29,686 --> 0:29:31,546
直接进入到

917
00:29:31,546 --> 0:29:33,336
通知设置 UI

918
00:29:33,336 --> 0:29:35,056
这正是他们想寻找的

919
00:29:35,056 --> 0:29:37,096
细化控制的地方

920
00:29:37,096 --> 0:29:39,836
你可以了解更多

921
00:29:39,836 --> 0:29:41,576
关于通知的内容

922
00:29:41,576 --> 0:29:43,266
在通知的新功能会议

923
00:29:43,476 --> 0:29:45,076
和使用分组通知会议

924
00:29:45,226 --> 0:29:45,866
它们会在这周晚些时候

925
00:29:46,906 --> 0:29:48,086
这就是关于通知的内容

926
00:29:49,006 --> 0:29:52,516
下面是信息

927
00:29:52,586 --> 0:29:54,856
iOS 12 里的信息

928
00:29:54,856 --> 0:29:56,336
加入了一些很有意思的

929
00:29:56,336 --> 0:29:57,396
相机的新特点

930
00:29:58,166 --> 0:29:59,426
你也可以把

931
00:29:59,426 --> 0:30:01,126
iMessage 里的表情包

932
00:29:59,426 --> 0:30:01,126
iMessage 里的表情包

933
00:30:01,126 --> 0:30:02,316
直接导入相机

934
00:30:02,916 --> 0:30:04,006
如果你在用

935
00:30:04,046 --> 0:30:05,696
Xcode 表情包模板

936
00:30:05,696 --> 0:30:07,196
这会默认自动发生

937
00:30:07,196 --> 0:30:07,976
你不用再做什么

938
00:30:08,116 --> 0:30:11,776
但是如果你想用

939
00:30:11,776 --> 0:30:14,336
MSMessagesAppView 控制器

940
00:30:14,376 --> 0:30:15,376
创建一个更加个性化的表情包体验

941
00:30:15,376 --> 0:30:17,726
就需要做一些

942
00:30:17,726 --> 0:30:18,846
简单的调试

943
00:30:18,846 --> 0:30:21,076
有一个新的 API

944
00:30:21,116 --> 0:30:22,786
MSMessagesSupportedPresentationContexts 

945
00:30:22,786 --> 0:30:25,166
你可以添加到你的

946
00:30:25,166 --> 0:30:27,436
用户 info.plist

947
00:30:27,436 --> 0:30:28,786
指定同时在

948
00:30:28,786 --> 0:30:30,446
信息语境和

949
00:30:30,446 --> 0:30:31,326
媒体语境显示

950
00:30:32,076 --> 0:30:33,506
完成之后

951
00:30:33,506 --> 0:30:34,706
你的 App 会显示在

952
00:30:34,706 --> 0:30:38,176
AppStrip 和相机里

953
00:30:39,046 --> 0:30:40,696
如果在运行时

954
00:30:40,696 --> 0:30:41,956
你想要知道

955
00:30:41,956 --> 0:30:43,596
你在哪个语境下

956
00:30:43,596 --> 0:30:45,076
以便你能够定制

957
00:30:45,076 --> 0:30:46,646
你的表情包

958
00:30:46,646 --> 0:30:48,036
有一个新的 API 可以做到

959
00:30:48,676 --> 0:30:51,316
通过查看

960
00:30:51,316 --> 0:30:52,586
PresentationContext

961
00:30:52,586 --> 0:30:54,246
你可以很快知道你在

962
00:30:55,176 --> 0:30:56,026
信息还是相机

963
00:30:56,176 --> 0:30:57,526
除了这些 

964
00:30:57,526 --> 0:31:01,456
iOS 12 还给信息 App

965
00:30:57,526 --> 0:31:01,456
iOS 12 还给信息 App

966
00:31:01,456 --> 0:31:02,396
新的交互方式

967
00:31:02,906 --> 0:31:05,746
在紧凑模式下

968
00:31:05,906 --> 0:31:07,506
之前把信息 App

969
00:31:07,506 --> 0:31:09,106
水平往下滑

970
00:31:09,156 --> 0:31:10,066
就会在 App 间切换

971
00:31:10,746 --> 0:31:13,146
在 iOS 12

972
00:31:13,206 --> 0:31:14,416
这些水平滑动

973
00:31:14,416 --> 0:31:15,576
以及水平移动的互动

974
00:31:15,576 --> 0:31:17,136
可以直接

975
00:31:17,206 --> 0:31:19,106
在你的 App 里使用

976
00:31:19,206 --> 0:31:20,506
所以就会和你的 App 互动

977
00:31:20,506 --> 0:31:22,286
而不是换成其他 App

978
00:31:23,106 --> 0:31:24,196
这就是关于信息的内容

979
00:31:25,096 --> 0:31:27,196
接下来是

980
00:31:27,246 --> 0:31:29,526
自动填入密码和安全码

981
00:31:30,596 --> 0:31:33,936
iOS 11 首先引入

982
00:31:34,296 --> 0:31:39,176
为 App 自动填入密码

983
00:31:39,176 --> 0:31:40,796
在 iOS 12 里

984
00:31:40,796 --> 0:31:42,186
我们又进了一步

985
00:31:42,786 --> 0:31:45,296
让我们暂时

986
00:31:45,296 --> 0:31:46,436
先回到开头

987
00:31:46,436 --> 0:31:48,586
看一下整个体验

988
00:31:49,146 --> 0:31:51,996
如果用户把密码

989
00:31:51,996 --> 0:31:54,186
储存在 iCloud Keychain

990
00:31:54,266 --> 0:31:55,726
从 iOS 11 开始

991
00:31:55,726 --> 0:31:56,796
这些密码就可以

992
00:31:56,866 --> 0:31:58,556
自动填入到你的 App 的

993
00:31:58,556 --> 0:31:59,406
登录流程

994
00:32:00,146 --> 0:32:02,206
在 iOS 12 里

995
00:32:02,206 --> 0:32:04,596
这些密码可以通过两种形式

996
00:32:04,686 --> 0:32:06,506
储存到 iCloud Keychain

997
00:32:06,506 --> 0:32:09,006
从登录窗口流程

998
00:32:09,006 --> 0:32:10,926
和改变密码请求 UI

999
00:32:10,926 --> 0:32:12,086
都可以

1000
00:32:13,296 --> 0:32:14,666
当用户登录后

1001
00:32:14,956 --> 0:32:16,156
会弹出提示

1002
00:32:16,156 --> 0:32:17,626
储存密码到 iCloud Keychain

1003
00:32:18,436 --> 0:32:20,226
在 iOS 12 里可以

1004
00:32:20,226 --> 0:32:22,146
在新帐户流程

1005
00:32:22,486 --> 0:32:25,026
和改密码流程

1006
00:32:25,026 --> 0:32:26,496
自动生成密码

1007
00:32:26,896 --> 0:32:28,536
这个很容易采用

1008
00:32:28,896 --> 0:32:29,886
你只需要确保

1009
00:32:29,936 --> 0:32:31,996
你的密码字段标记了

1010
00:32:32,116 --> 0:32:33,856
要么是密码文本内容类型

1011
00:32:33,856 --> 0:32:35,906
如果是登录字段

1012
00:32:35,906 --> 0:32:37,726
要么是新密码文本内容类型

1013
00:32:37,726 --> 0:32:39,146
如果是新帐户

1014
00:32:39,146 --> 0:32:40,696
或者是更改密码字段

1015
00:32:41,336 --> 0:32:45,226
如果你对密码

1016
00:32:45,226 --> 0:32:47,166
有特别的要求

1017
00:32:47,166 --> 0:32:49,056
比如有必须出现

1018
00:32:49,096 --> 0:32:51,226
或者不能出现的字符

1019
00:32:51,226 --> 0:32:55,026
又或者对重复字符

1020
00:32:55,026 --> 0:32:56,586
有上限要求

1021
00:32:56,586 --> 0:32:58,026
你也可以标明这些规则

1022
00:32:58,026 --> 0:33:00,526
这样自动生成的密码

1023
00:32:58,026 --> 0:33:00,526
这样自动生成的密码

1024
00:33:00,526 --> 0:33:02,256
就可以满足

1025
00:33:02,256 --> 0:33:03,426
你所有的要求

1026
00:33:04,146 --> 0:33:06,946
登录的时候

1027
00:33:06,946 --> 0:33:07,896
也许会遇到的

1028
00:33:07,896 --> 0:33:09,706
另外一个小麻烦就是

1029
00:33:09,706 --> 0:33:10,716
当你需要把验证码

1030
00:33:10,716 --> 0:33:12,426
从信息里复制出来

1031
00:33:12,426 --> 0:33:15,226
然后放入 App

1032
00:33:15,226 --> 0:33:17,496
IOS 12 让这一步变得非常容易

1033
00:33:17,496 --> 0:33:19,046
它会自动识别

1034
00:33:19,046 --> 0:33:21,216
这类通知

1035
00:33:21,326 --> 0:33:23,176
记录里面的安全码

1036
00:33:23,176 --> 0:33:24,416
然后显示在

1037
00:33:24,416 --> 0:33:25,796
快速键入候选栏里

1038
00:33:25,836 --> 0:33:27,156
这样很容易就可以

1039
00:33:27,186 --> 0:33:27,656
输入进 App

1040
00:33:28,506 --> 0:33:29,466
为了让这个特性可行

1041
00:33:29,526 --> 0:33:30,726
你唯一需要做的

1042
00:33:30,726 --> 0:33:32,086
就是确保

1043
00:33:32,086 --> 0:33:34,126
你使用的是标准的

1044
00:33:34,126 --> 0:33:37,126
iOS text interaction API

1045
00:33:37,196 --> 0:33:40,786
来接收这些内容

1046
00:33:40,866 --> 0:33:42,126
这些新特性

1047
00:33:42,316 --> 0:33:44,196
使得 iOS 12 可以让你

1048
00:33:44,286 --> 0:33:47,456
使用每项服务

1049
00:33:47,686 --> 0:33:49,546
都可以有更安全又独特的密码

1050
00:33:49,626 --> 0:33:51,426
而你完全不需要

1051
00:33:51,426 --> 0:33:52,996
记住或者打出来

1052
00:33:52,996 --> 0:33:55,636
更多的内容

1053
00:33:55,636 --> 0:33:57,036
在这周晚些时候的

1054
00:33:57,176 --> 0:33:58,426
自动增强密码和自动填入安全码会议

1055
00:33:58,426 --> 0:34:01,096
会有介绍

1056
00:33:58,426 --> 0:34:01,096
会有介绍

1057
00:34:01,576 --> 0:34:04,286
最后的 API 改进话题

1058
00:34:04,286 --> 0:34:05,826
其实有一点回顾性质

1059
00:34:05,826 --> 0:34:08,366
但是我们添加了一些内容

1060
00:34:09,505 --> 0:34:11,356
在 iOS 11 里 我们引入了

1061
00:34:11,356 --> 0:34:12,176
安全区域嵌入

1062
00:34:12,766 --> 0:34:14,666
安全区域嵌入能够

1063
00:34:14,775 --> 0:34:16,716
很好地用来

1064
00:34:16,716 --> 0:34:19,446
确保你的内容不会和

1065
00:34:19,596 --> 0:34:21,525
其他用户界面的部分重叠

1066
00:34:21,525 --> 0:34:24,576
例如屏幕顶端和下部的栏

1067
00:34:25,906 --> 0:34:27,755
在 iPhone 这个很好用

1068
00:34:27,755 --> 0:34:28,726
因为栏都比较

1069
00:34:28,726 --> 0:34:30,886
简单 但其实

1070
00:34:30,976 --> 0:34:31,936
它也很强大

1071
00:34:32,565 --> 0:34:34,005
安全区域嵌入

1072
00:34:34,076 --> 0:34:35,426
为你 App 的

1073
00:34:35,426 --> 0:34:37,596
任何本地坐标空间

1074
00:34:37,596 --> 0:34:39,795
提供安全区域坐标

1075
00:34:39,795 --> 0:34:41,266
所以可以应用于

1076
00:34:41,266 --> 0:34:43,646
更复杂的界面

1077
00:34:43,646 --> 0:34:45,466
比如 iPad 分屏视图

1078
00:34:45,755 --> 0:34:48,346
分屏视图的主视图和

1079
00:34:48,346 --> 0:34:49,706
细节部分

1080
00:34:49,706 --> 0:34:50,186
包含不同高度的栏

1081
00:34:50,735 --> 0:34:54,116
安全区域嵌入确保

1082
00:34:54,116 --> 0:34:55,326
在任何视图下的

1083
00:34:55,326 --> 0:34:56,426
所在分屏内

1084
00:34:56,426 --> 0:34:59,156
都不会被这些栏覆盖

1085
00:35:01,156 --> 0:35:02,606
所以在长方形屏幕的设备上

1086
00:35:02,606 --> 0:35:04,366
这个很好用

1087
00:35:04,866 --> 0:35:06,906
但是在非长方形屏幕

1088
00:35:06,906 --> 0:35:07,946
比如 iPhone X 上

1089
00:35:08,126 --> 0:35:10,286
它也同样强大

1090
00:35:11,676 --> 0:35:12,986
跟有 home 键的设备相比

1091
00:35:12,986 --> 0:35:14,916
我们可以看到

1092
00:35:14,916 --> 0:35:16,236
顶部和底部的栏

1093
00:35:16,236 --> 0:35:17,066
都比较大

1094
00:35:17,686 --> 0:35:19,956
显然安全区域嵌入

1095
00:35:19,956 --> 0:35:21,286
适应了这个尺寸

1096
00:35:21,946 --> 0:35:23,796
iPhone X 特殊的是

1097
00:35:23,846 --> 0:35:25,746
没有栏显示的时候

1098
00:35:25,746 --> 0:35:27,226
安全区域嵌入依然存在

1099
00:35:27,296 --> 0:35:29,586
这同样适用于

1100
00:35:29,586 --> 0:35:31,806
横屏模式

1101
00:35:31,806 --> 0:35:32,826
这样可以确保 

1102
00:35:32,826 --> 0:35:34,596
你可以有一个长方形区域

1103
00:35:34,596 --> 0:35:36,426
来显示内容

1104
00:35:36,426 --> 0:35:40,846
而不会被截出去

1105
00:35:41,036 --> 0:35:43,426
所以我想感谢

1106
00:35:43,426 --> 0:35:44,856
所有采用

1107
00:35:44,956 --> 0:35:46,256
安全区域嵌入

1108
00:35:46,256 --> 0:35:48,306
和为 iPhone X 更新 App 的各位

1109
00:35:48,536 --> 0:35:49,806
过去的几年里

1110
00:35:49,806 --> 0:35:51,076
都有很好的体验

1111
00:35:51,146 --> 0:35:52,326
而且我相信你们大多数

1112
00:35:52,326 --> 0:35:52,996
已经这么做了

1113
00:35:53,536 --> 0:35:55,206
如果还没有

1114
00:35:55,206 --> 0:35:56,176
现在是个好时机

1115
00:35:56,836 --> 0:35:57,986
你们的用户

1116
00:35:57,986 --> 0:35:59,466
一定更喜欢与时俱进的 App

1117
00:35:59,466 --> 0:36:01,716
配合 iPhone X 更新

1118
00:35:59,466 --> 0:36:01,716
配合 iPhone X 更新

1119
00:36:01,756 --> 0:36:03,256
能够很好的

1120
00:36:03,256 --> 0:36:04,596
体现这一点

1121
00:36:05,166 --> 0:36:06,606
所以如果还没有

1122
00:36:06,606 --> 0:36:07,126
赶紧去更新吧

1123
00:36:07,126 --> 0:36:08,626
为了确保

1124
00:36:08,626 --> 0:36:10,136
你能够得到所有需要的信息

1125
00:36:10,136 --> 0:36:13,526
请关注这周晚些时候的

1126
00:36:13,526 --> 0:36:15,226
适用所有大小和形状的 UIKit App 会议

1127
00:36:15,446 --> 0:36:16,616
这个课程会给你讲

1128
00:36:16,616 --> 0:36:18,486
安全区域嵌入

1129
00:36:18,486 --> 0:36:22,336
和其他相关的嵌入 API 的内容

1130
00:36:22,336 --> 0:36:23,616
确保你的 App

1131
00:36:23,676 --> 0:36:27,836
能够适应所有的大小和形状

1132
00:36:28,086 --> 0:36:29,186
这就是关于框架更新

1133
00:36:29,816 --> 0:36:31,686
和 API 改进的所有内容

1134
00:36:31,986 --> 0:36:33,606
接下来 我们再说一下

1135
00:36:33,606 --> 0:36:34,296
Siri 捷径

1136
00:36:34,986 --> 0:36:37,056
Siri 捷径是

1137
00:36:37,056 --> 0:36:39,316
iOS 12 里的一个很棒的新 API

1138
00:36:41,516 --> 0:36:42,886
Siri 捷径

1139
00:36:42,886 --> 0:36:44,716
可以让 App 的常用操作

1140
00:36:45,416 --> 0:36:48,096
通过 Siri 很容易地调用

1141
00:36:49,526 --> 0:36:50,726
Siri 捷径

1142
00:36:50,726 --> 0:36:52,646
可以在封面

1143
00:36:52,646 --> 0:36:54,286
预先显示

1144
00:36:54,416 --> 0:36:55,466
以便在你希望的

1145
00:36:55,466 --> 0:36:57,426
时间和地点

1146
00:36:57,426 --> 0:37:00,436
访问常用操作

1147
00:36:57,426 --> 0:37:00,436
访问常用操作

1148
00:37:00,606 --> 0:37:01,866
他们还可以

1149
00:37:01,866 --> 0:37:03,456
显示在 Apple Watch 的

1150
00:37:03,456 --> 0:37:05,126
Siri watch face 上

1151
00:37:06,696 --> 0:37:08,246
Siri 操作不光可以

1152
00:37:08,276 --> 0:37:09,916
预先显示

1153
00:37:09,916 --> 0:37:11,236
还可以设置成

1154
00:37:11,236 --> 0:37:13,596
用个性化声音短语执行

1155
00:37:17,256 --> 0:37:19,296
给你的 App 添加

1156
00:37:19,296 --> 0:37:21,786
Siri 行为支持非常容易

1157
00:37:21,786 --> 0:37:22,946
有两个 API 可以用

1158
00:37:23,266 --> 0:37:24,826
NSUserActivity

1159
00:37:24,826 --> 0:37:26,306
你可能已经为了支持

1160
00:37:26,306 --> 0:37:28,916
接力和聚焦整合

1161
00:37:28,916 --> 0:37:29,886
开始使用它了

1162
00:37:30,356 --> 0:37:32,016
还有一个 Siri Intents 支持

1163
00:37:32,016 --> 0:37:33,346
为了应对更复杂的情况

1164
00:37:33,396 --> 0:37:35,316
例如有更多的

1165
00:37:35,316 --> 0:37:36,246
个性化互动时

1166
00:37:36,816 --> 0:37:38,156
我们先看一下

1167
00:37:38,156 --> 0:37:38,606
NSUserActivity

1168
00:37:39,406 --> 0:37:40,466
我刚才说过

1169
00:37:40,466 --> 0:37:42,056
NSUserActivity 对接力和聚焦

1170
00:37:42,056 --> 0:37:43,856
是一个常见的 API

1171
00:37:43,856 --> 0:37:45,116
当你的 Siri 捷径

1172
00:37:45,116 --> 0:37:46,826
需要把你的用户

1173
00:37:46,826 --> 0:37:48,416
转回 App 中一个特定位置时

1174
00:37:48,466 --> 0:37:50,116
这个 API 也很有用

1175
00:37:50,316 --> 0:37:51,516
比如加载一个特定的

1176
00:37:51,516 --> 0:37:54,226
信息或者文件

1177
00:37:54,226 --> 0:37:55,056
这跟你切换到

1178
00:37:55,056 --> 0:37:56,516
另一个设备时是一样的

1179
00:37:57,176 --> 0:37:58,706
如果你已经这么做了

1180
00:37:58,806 --> 0:38:00,336
为 Siri 捷径添加支持

1181
00:37:58,806 --> 0:38:00,336
为 Siri 捷径添加支持

1182
00:38:00,336 --> 0:38:01,256
非常容易

1183
00:38:01,516 --> 0:38:02,696
只需要把 EligibleforPrediction

1184
00:38:02,696 --> 0:38:03,686
设置为 true

1185
00:38:04,096 --> 0:38:05,116
要是你还没有这么做

1186
00:38:05,116 --> 0:38:06,596
如果你的捷径

1187
00:38:06,776 --> 0:38:07,816
符合这几个类别

1188
00:38:07,816 --> 0:38:08,486
那这样做或很好

1189
00:38:09,836 --> 0:38:11,846
如果你的 App 有

1190
00:38:11,846 --> 0:38:13,426
更多的个性化需求

1191
00:38:13,426 --> 0:38:14,886
或者你就是想要更好地控制

1192
00:38:14,886 --> 0:38:16,856
你可以采用 SiriKit Intents API

1193
00:38:17,836 --> 0:38:18,986
SiriKit Intents 提供  

1194
00:38:18,986 --> 0:38:20,636
很多预先设定的 Intent

1195
00:38:20,796 --> 0:38:22,966
你可以很简单地采用

1196
00:38:23,036 --> 0:38:24,456
这跟前几年的

1197
00:38:24,456 --> 0:38:25,866
SiriKit Intents 是一样的

1198
00:38:26,666 --> 0:38:27,696
如果你的 App 有

1199
00:38:27,896 --> 0:38:29,396
更多的个性化行为

1200
00:38:29,396 --> 0:38:30,966
在 iOS 12 你可以定义

1201
00:38:30,966 --> 0:38:32,936
你自己的个性化 Intent

1202
00:38:33,736 --> 0:38:35,176
个性化 Intent

1203
00:38:35,216 --> 0:38:36,696
可以很灵活

1204
00:38:36,696 --> 0:38:37,336
满足你的要求

1205
00:38:37,846 --> 0:38:38,956
这里 我创建了一个

1206
00:38:38,956 --> 0:38:40,526
来帮助我做明年的

1207
00:38:40,526 --> 0:38:41,296
WWDC 幻灯片

1208
00:38:42,436 --> 0:38:45,066
放置你的 Intent 的类别

1209
00:38:45,066 --> 0:38:45,966
其实非常广泛

1210
00:38:46,236 --> 0:38:48,236
这里我用的是创建类别

1211
00:38:48,766 --> 0:38:50,306
但是如果你的 Intent

1212
00:38:50,306 --> 0:38:51,866
比这个还宽泛

1213
00:38:51,866 --> 0:38:53,046
有更加宽泛的选择

1214
00:38:53,046 --> 0:38:56,336
比如运行和开始

1215
00:38:57,776 --> 0:38:59,266
创建好你的 Intent 之后

1216
00:38:59,266 --> 0:39:01,586
你还希望你的用户可以

1217
00:38:59,266 --> 0:39:01,586
你还希望你的用户可以

1218
00:39:01,586 --> 0:39:02,916
很容易地创建

1219
00:39:02,916 --> 0:39:03,426
个性化捷径

1220
00:39:03,926 --> 0:39:05,526
现在你的 App 里

1221
00:39:05,526 --> 0:39:06,796
有一个 API 可以让

1222
00:39:06,796 --> 0:39:08,396
你的用户创建

1223
00:39:08,466 --> 0:39:09,466
个性化声音捷径

1224
00:39:09,876 --> 0:39:10,816
这个按键可以

1225
00:39:10,816 --> 0:39:12,066
打开一个新的面板

1226
00:39:12,326 --> 0:39:14,336
操作完之后

1227
00:39:14,336 --> 0:39:15,956
可以在我的 App 里

1228
00:39:16,036 --> 0:39:17,346
创建一个新的捷径

1229
00:39:17,936 --> 0:39:18,666
所以如果你在

1230
00:39:18,666 --> 0:39:19,716
早上点咖啡

1231
00:39:19,716 --> 0:39:21,326
然后你觉得这是

1232
00:39:22,086 --> 0:39:23,756
以后可能会重复的事情

1233
00:39:23,756 --> 0:39:25,176
这是个很好的机会

1234
00:39:25,176 --> 0:39:27,186
来创建一个

1235
00:39:27,266 --> 0:39:28,736
Siri 捷径 以便下次使用

1236
00:39:29,616 --> 0:39:30,596
你还可以

1237
00:39:30,596 --> 0:39:32,066
把这些捷径结合在一起

1238
00:39:32,066 --> 0:39:35,196
用 App Store 里的捷径 App

1239
00:39:35,696 --> 0:39:37,176
所有这些

1240
00:39:37,176 --> 0:39:38,056
和更多内容

1241
00:39:38,056 --> 0:39:40,326
会在这周晚些时候的

1242
00:39:40,856 --> 0:39:41,776
Siri 捷径介绍

1243
00:39:41,776 --> 0:39:44,006
创建声音 Siri 捷径

1244
00:39:44,006 --> 0:39:45,326
和 Siri Watch Face 上的 Siri 捷径

1245
00:39:45,526 --> 0:39:45,976
会议了解到

1246
00:39:46,136 --> 0:39:48,886
今天我们说了很多

1247
00:39:48,886 --> 0:39:50,376
iOS 12 的新功能

1248
00:39:50,466 --> 0:39:52,796
不过还有一些会议

1249
00:39:52,796 --> 0:39:54,076
很值得一提

1250
00:39:54,076 --> 0:39:56,286
虽然可能讲的不是新功能

1251
00:39:56,886 --> 0:39:58,386
如果你刚开始

1252
00:39:58,386 --> 0:40:00,386
为 iOS 创建 App

1253
00:39:58,386 --> 0:40:00,386
为 iOS 创建 App

1254
00:40:00,386 --> 0:40:01,296
有一个很好的会议叫

1255
00:40:01,296 --> 0:40:03,556
我有一个关于 App 的想法

1256
00:40:03,796 --> 0:40:05,366
一定要去

1257
00:40:06,426 --> 0:40:07,516
如果你已经有一个 App 了

1258
00:40:07,516 --> 0:40:08,636
只是想更加完善

1259
00:40:08,636 --> 0:40:10,106
也有一些很好的

1260
00:40:10,106 --> 0:40:11,776
会议推荐

1261
00:40:11,776 --> 0:40:13,646
UI Collection View 介绍

1262
00:40:13,646 --> 0:40:14,996
和为你的 iOS App 添加乐趣

1263
00:40:15,846 --> 0:40:17,516
非常感谢

1264
00:40:17,516 --> 0:40:18,946
你们今天来到这里

1265
00:40:19,406 --> 0:40:20,266
希望在实验室再次看到你们

1266
00:40:20,266 --> 0:40:21,766
祝你们拥有

1267
00:40:21,846 --> 0:40:22,576
愉快的一周 谢谢

1268
00:40:23,516 --> 0:40:30,570
[ 掌声 ]
