1
00:00:06,516 --> 00:00:15,500
[ 音乐 ]

2
00:00:18,286 --> 00:00:19,366
&gt;&gt; 大家好 我的名字是 Chris

3
00:00:19,366 --> 00:00:20,976
Fleizach 让我们谈谈如何

4
00:00:20,976 --> 00:00:22,846
使用 AVSpeechSynthesis

5
00:00:22,846 --> 00:00:23,856
让 iOS 说话

6
00:00:25,536 --> 00:00:26,646
今天要讨论的问题有

7
00:00:26,826 --> 00:00:28,126
什么是 AVSpeechSynthesis

8
00:00:28,126 --> 00:00:29,316
以及我们为什么使用它

9
00:00:30,066 --> 00:00:31,876
我们来谈谈一些基础知识

10
00:00:32,456 --> 00:00:33,416
我们将讨论

11
00:00:33,416 --> 00:00:35,566
如何选择正确的声音 以及一些属性

12
00:00:35,566 --> 00:00:38,416
如速率 音调和音量

13
00:00:38,416 --> 00:00:39,376
最后是属性字符串

14
00:00:41,256 --> 00:00:44,126
AVSpeechSynthesis 是一个

15
00:00:44,126 --> 00:00:45,836
可以在你的 iOS 设备上

16
00:00:45,836 --> 00:00:47,776
生成计算机合成语音的 API

17
00:00:48,216 --> 00:00:49,156
它有很多用途

18
00:00:49,866 --> 00:00:51,446
例如 你可能希望

19
00:00:51,446 --> 00:00:52,786
在你的 App 中发布公告

20
00:00:53,696 --> 00:00:54,566
你可能正在创建

21
00:00:54,566 --> 00:00:56,826
一个不可见的界面

22
00:00:57,466 --> 00:00:58,886
或者你可能正在开发

23
00:00:58,886 --> 00:01:00,306
一个教育 App

24
00:00:58,886 --> 00:01:00,306
一个教育 App

25
00:01:00,306 --> 00:01:02,246
合成语音可以为学习材料

26
00:01:02,246 --> 00:01:04,215
起到很好的巩固作用

27
00:01:05,546 --> 00:01:07,236
一个具体的例子 使用合成语音

28
00:01:07,236 --> 00:01:08,866
在锻炼期间可以

29
00:01:08,866 --> 00:01:11,496
有效地传达信息更新音频

30
00:01:12,846 --> 00:01:17,026
关于综合和辅助功能的提示

31
00:01:17,666 --> 00:01:19,286
语音合成是

32
00:01:19,286 --> 00:01:20,816
一个能帮助各种残障人士的

33
00:01:20,816 --> 00:01:22,586
强大工具

34
00:01:22,586 --> 00:01:23,956
例如 有认知障碍的用户

35
00:01:23,956 --> 00:01:25,806
体会到的信息输出

36
00:01:25,806 --> 00:01:28,046
可以得到加强

37
00:01:28,556 --> 00:01:29,776
有发声障碍的用户

38
00:01:29,776 --> 00:01:31,386
可以使用语音合成

39
00:01:31,386 --> 00:01:33,336
来帮他们说话

40
00:01:33,906 --> 00:01:36,206
有视觉障碍的用户可以使用语音合成

41
00:01:36,206 --> 00:01:38,336
来了解界面的内容

42
00:01:39,666 --> 00:01:41,076
但需要注意的是

43
00:01:41,076 --> 00:01:42,376
它不是“旁白”或

44
00:01:42,376 --> 00:01:44,736
其他屏幕阅读技术的替代品

45
00:01:44,946 --> 00:01:46,656
例如 合成语音可能

46
00:01:46,656 --> 00:01:48,576
会与“旁白”重叠发声

47
00:01:49,446 --> 00:01:50,846
并且大部分合成语音都

48
00:01:50,846 --> 00:01:52,626
不可用于任何

49
00:01:52,626 --> 00:01:54,366
连接的设备如盲文设备

50
00:01:55,886 --> 00:01:56,816
相反 你应该通过使用

51
00:01:56,816 --> 00:01:58,026
UIAccessibility API

52
00:01:58,026 --> 00:02:01,876
让你的 App 易于使用

53
00:01:58,026 --> 00:02:01,876
让你的 App 易于使用

54
00:02:02,076 --> 00:02:03,736
好的 让我们来看看基础知识

55
00:02:04,066 --> 00:02:05,216
第一步 创建一个

56
00:02:05,216 --> 00:02:06,426
AVSpeechSynthesizer

57
00:02:06,816 --> 00:02:08,306
你可以使用这个代码片段

58
00:02:08,735 --> 00:02:10,356
有一点需要注意的是

59
00:02:10,356 --> 00:02:11,276
你要确保它

60
00:02:11,276 --> 00:02:12,876
在语音结束之前一直存在

61
00:02:13,486 --> 00:02:14,836
如果合成器超出范围

62
00:02:14,836 --> 00:02:17,456
则任何正在进行的合成将被取消

63
00:02:18,116 --> 00:02:20,296
现在我们已经创建了

64
00:02:20,296 --> 00:02:21,606
一个语音合成 接下来的工作就是

65
00:02:21,606 --> 00:02:22,576
创建一个发声（utterance）

66
00:02:23,296 --> 00:02:25,236
然后再把它分发到合成器中

67
00:02:26,416 --> 00:02:28,016
所以 在这个例子中 我们用字符串 “Hello”

68
00:02:28,016 --> 00:02:28,926
创建了一个发声 

69
00:02:28,926 --> 00:02:30,816
然后用 speak() 方法

70
00:02:31,406 --> 00:02:32,406
把它分发出去

71
00:02:32,966 --> 00:02:36,486
一个关于音频会话的提示

72
00:02:36,956 --> 00:02:39,416
当 AVSpeechSynthesis 

73
00:02:39,416 --> 00:02:41,496
被 speak() 方法激活时

74
00:02:41,496 --> 00:02:43,546
音频会话将自动设置为有效

75
00:02:44,526 --> 00:02:45,706
如果你想与其他音频混合使用

76
00:02:45,706 --> 00:02:47,256
可以在 AVAudioSession 中

77
00:02:47,256 --> 00:02:48,966
使用 setCategory() 方法

78
00:02:48,966 --> 00:02:51,356
并设置为 mixWithOthers

79
00:02:52,086 --> 00:02:53,266
如果你想要回避其他音频

80
00:02:53,266 --> 00:02:55,816
以便你的合成语音

81
00:02:55,936 --> 00:02:59,276
成为主要内容 降低其他音频的音量

82
00:02:59,276 --> 00:03:01,086
可以使用 duckOthers 选项

83
00:02:59,276 --> 00:03:01,086
可以使用 duckOthers 选项

84
00:03:02,506 --> 00:03:04,436
另外需要注意的是

85
00:03:04,436 --> 00:03:05,706
音频会话在语音完成前

86
00:03:05,706 --> 00:03:07,436
不会被设置为无效

87
00:03:07,926 --> 00:03:10,146
这是因为它是一个共享会话

88
00:03:10,146 --> 00:03:13,436
如果有其他音频同时播放

89
00:03:13,436 --> 00:03:15,336
我们不会想让它停止

90
00:03:15,726 --> 00:03:17,576
因此 如果你想将

91
00:03:17,576 --> 00:03:18,826
音频会话设置为无效 

92
00:03:18,826 --> 00:03:19,566
你只能自己设置

93
00:03:20,766 --> 00:03:23,386
在 AVSpeechSynthesis 中

94
00:03:23,386 --> 00:03:24,736
有一些回调方法

95
00:03:24,736 --> 00:03:26,386
可以帮助告知

96
00:03:26,386 --> 00:03:27,716
发声的生命周期

97
00:03:28,566 --> 00:03:31,516
这些是合成器委托协议中的可选方法

98
00:03:32,116 --> 00:03:33,656
例如 你可以知道

99
00:03:33,656 --> 00:03:36,116
语音何时开始 何时结束

100
00:03:36,606 --> 00:03:38,746
甚至是说出的字符范围

101
00:03:39,406 --> 00:03:40,506
你还可以知道语音何时

102
00:03:40,506 --> 00:03:41,686
暂停或继续

103
00:03:43,146 --> 00:03:45,426
我们以这个代码片段作为例子

104
00:03:45,426 --> 00:03:47,226
你可以将你的

105
00:03:47,226 --> 00:03:49,036
合成器委托设置到一个对象上

106
00:03:49,036 --> 00:03:50,586
然后实现这些方法

107
00:03:50,586 --> 00:03:51,926
例如 didStart

108
00:03:51,926 --> 00:03:53,506
在这种情况下

109
00:03:53,506 --> 00:03:55,886
会返回你的发声

110
00:03:55,886 --> 00:03:58,586
didFinish 也会做

111
00:03:58,586 --> 00:03:59,976
同样的事情

112
00:03:59,976 --> 00:04:01,736
而 willSpeakRangeOfSpeechString

113
00:03:59,976 --> 00:04:01,736
而 willSpeakRangeOfSpeechString

114
00:04:02,166 --> 00:04:03,186
则会返回一个 NSRange

115
00:04:03,226 --> 00:04:04,636
然后你可以

116
00:04:04,636 --> 00:04:06,966
把它转换成一个字符串范围

117
00:04:06,966 --> 00:04:08,306
并借助它打印输出到控制台

118
00:04:09,486 --> 00:04:12,606
现在我们来做一个小演示

119
00:04:15,166 --> 00:04:17,046
&gt;&gt; 你好 我的朋友们

120
00:04:17,426 --> 00:04:19,346
我在 iPhone 里面

121
00:04:19,836 --> 00:04:24,116
&gt;&gt; 很好 这些就是

122
00:04:24,116 --> 00:04:25,316
AVSpeechSynthesis 的基础

123
00:04:25,596 --> 00:04:27,286
如你所见

124
00:04:27,286 --> 00:04:28,386
这非常简单

125
00:04:29,246 --> 00:04:30,766
下一个话题是你如何

126
00:04:30,766 --> 00:04:31,746
选择正确的声音

127
00:04:31,986 --> 00:04:33,236
系统内置了许多种声音

128
00:04:33,236 --> 00:04:34,716
每种支持的语言都有一个声音

129
00:04:36,096 --> 00:04:37,516
需要注意的是这个 API

130
00:04:37,516 --> 00:04:39,446
无法使用 Siri 的声音

131
00:04:40,726 --> 00:04:42,356
但是 用户可以下载

132
00:04:42,356 --> 00:04:43,766
更高质量的声音

133
00:04:43,766 --> 00:04:44,716
当这些声音被下载时

134
00:04:44,716 --> 00:04:46,856
它们将出现在声音列表中

135
00:04:48,466 --> 00:04:50,846
你既可以通过标识符

136
00:04:50,956 --> 00:04:52,706
也可以通过语言来选择声音

137
00:04:53,246 --> 00:04:54,386
如果你通过语言选择声音

138
00:04:54,386 --> 00:04:55,486
则会选择

139
00:04:55,486 --> 00:04:56,606
用户的默认声音

140
00:04:57,776 --> 00:04:58,736
我们该怎么做呢

141
00:04:59,166 --> 00:05:00,356
首先声明一个发声

142
00:04:59,166 --> 00:05:00,356
首先声明一个发声

143
00:05:00,356 --> 00:05:01,406
然后使用

144
00:05:01,406 --> 00:05:02,506
AVSpeechSynthesisVoice

145
00:05:02,506 --> 00:05:03,886
设置声音属性

146
00:05:04,236 --> 00:05:07,286
如果想用

147
00:05:07,286 --> 00:05:09,296
标识符初始化器

148
00:05:09,296 --> 00:05:10,896
你可以获得所有的语音声音

149
00:05:11,536 --> 00:05:13,266
这其实是一个语音声音对象数组

150
00:05:13,266 --> 00:05:15,116
然后 比如

151
00:05:15,116 --> 00:05:16,546
选择第一个声音对象

152
00:05:16,546 --> 00:05:17,626
然后传入

153
00:05:17,626 --> 00:05:18,126
标识符属性

154
00:05:18,986 --> 00:05:22,136
以下是一些

155
00:05:22,256 --> 00:05:24,586
iOS 默认支持的一些语言

156
00:05:26,816 --> 00:05:30,026
现在让我们来谈谈

157
00:05:30,026 --> 00:05:31,096
你可以在 AVSpeechSynthesizer 上

158
00:05:31,096 --> 00:05:32,116
用到的一些属性

159
00:05:32,686 --> 00:05:34,096
使用速率属性

160
00:05:34,526 --> 00:05:36,336
可以控制语音速率

161
00:05:36,336 --> 00:05:37,406
范围是 0 到 1

162
00:05:38,226 --> 00:05:40,856
这能让语音

163
00:05:40,856 --> 00:05:42,496
变慢或者变快

164
00:05:43,166 --> 00:05:44,626
在 [0,.5] 这个区间内

165
00:05:44,626 --> 00:05:47,686
语音速率会从 0 倍速增长到 1 倍速

166
00:05:48,326 --> 00:05:50,206
这意味着如果你传入 “.5” 这个值

167
00:05:50,516 --> 00:05:51,776
你会得到默认的

168
00:05:51,776 --> 00:05:52,396
正常语音速率

169
00:05:53,736 --> 00:05:55,606
如果你想加快速度

170
00:05:55,606 --> 00:05:58,066
你可以将把数值设为 .5 到 1 之间的值

171
00:05:58,066 --> 00:05:59,806
这样可以将语音

172
00:05:59,806 --> 00:06:01,296
从正常的 1 倍语速

173
00:05:59,806 --> 00:06:01,296
从正常的 1 倍语速

174
00:06:01,296 --> 00:06:02,216
加速到最高 4 倍

175
00:06:03,096 --> 00:06:04,666
为此 你可以创建一个

176
00:06:04,666 --> 00:06:05,926
语音发声 然后将

177
00:06:05,926 --> 00:06:09,056
速率设置为浮点值

178
00:06:09,056 --> 00:06:10,366
或者可以使用一些常量

179
00:06:10,666 --> 00:06:13,526
来把速率设置为默认速率 最高速率 或最低速率

180
00:06:14,006 --> 00:06:16,836
我们来谈谈音高和音量

181
00:06:17,396 --> 00:06:18,316
这些也是

182
00:06:18,316 --> 00:06:19,446
你可以在语音发声中设置的属性

183
00:06:19,926 --> 00:06:23,076
音高控制声音的高低

184
00:06:23,166 --> 00:06:25,986
音量控制语音本身的音量

185
00:06:27,166 --> 00:06:28,496
因此 例如 我们可以

186
00:06:28,496 --> 00:06:30,146
将音高设置得非常高

187
00:06:30,666 --> 00:06:31,786
这时把值设为“1”

188
00:06:32,396 --> 00:06:33,706
将音量设置得较低

189
00:06:33,706 --> 00:06:35,286
这时把值设为“.25”

190
00:06:35,986 --> 00:06:37,116
请注意 降低语音音量

191
00:06:37,116 --> 00:06:38,996
不会影响系统音量

192
00:06:41,016 --> 00:06:43,466
最后 我们来讨论

193
00:06:43,466 --> 00:06:44,616
属性字符串

194
00:06:45,666 --> 00:06:46,936
属性字符串允许我们

195
00:06:46,936 --> 00:06:48,716
使用不用的属性

196
00:06:48,816 --> 00:06:49,866
来自定义语音声音

197
00:06:50,446 --> 00:06:52,136
我想讨论的一个可用属性

198
00:06:52,136 --> 00:06:53,896
是 IPA 符号

199
00:06:54,296 --> 00:06:58,256
IPA 代表 International Phonetic 

200
00:06:58,256 --> 00:07:00,796
Alphabet（国际音标） 它我们能够自定义

201
00:06:58,256 --> 00:07:00,796
Alphabet（国际音标） 它我们能够自定义

202
00:07:00,796 --> 00:07:03,266
某些特有名称 名词等是如何发音的

203
00:07:04,966 --> 00:07:06,766
它在这些语言中都可用

204
00:07:09,516 --> 00:07:10,886
这是一个例子

205
00:07:10,886 --> 00:07:11,566
可以大概展示一下它的样子

206
00:07:11,766 --> 00:07:15,286
要按我们习惯的方式来说 iPhone

207
00:07:15,286 --> 00:07:16,836
你要使用此 IPA 符号

208
00:07:18,176 --> 00:07:19,756
现在的问题是

209
00:07:19,756 --> 00:07:21,406
如何生成这个 IPA 符号呢

210
00:07:21,406 --> 00:07:23,346
用键盘输入并不容易

211
00:07:24,076 --> 00:07:26,306
一种方法是

212
00:07:26,446 --> 00:07:28,126
使用辅助功能中的

213
00:07:28,126 --> 00:07:29,306
发音编辑器

214
00:07:29,816 --> 00:07:30,886
当你前往“设置”-“通用”

215
00:07:30,886 --> 00:07:33,046
“辅助功能”-“语音”

216
00:07:33,046 --> 00:07:33,836
你会发现

217
00:07:33,836 --> 00:07:36,056
“发音”并找到这样的界面

218
00:07:36,746 --> 00:07:37,946
你可以输入

219
00:07:37,946 --> 00:07:41,066
你想纠正发音的短语

220
00:07:41,066 --> 00:07:42,666
轻点麦克风按钮

221
00:07:42,666 --> 00:07:43,136
然后读出来

222
00:07:44,246 --> 00:07:45,796
完成之后 你将

223
00:07:45,796 --> 00:07:47,516
看到可能的几个

224
00:07:47,516 --> 00:07:48,686
变体选项

225
00:07:48,686 --> 00:07:50,346
当你点击它们时

226
00:07:50,346 --> 00:07:51,036
它会大声朗读出来

227
00:07:51,316 --> 00:07:53,656
你可以选择听起来正确的那个 然后

228
00:07:53,656 --> 00:07:55,876
将你获得的这个值复制到

229
00:07:55,876 --> 00:07:56,366
你的代码中

230
00:07:57,006 --> 00:07:58,136
那么让我们看看这是如何做到的

231
00:07:58,636 --> 00:08:00,966
首先 我们创建一个属性字符串

232
00:07:58,636 --> 00:08:00,966
首先 我们创建一个属性字符串

233
00:08:00,966 --> 00:08:03,836
然后我们可以

234
00:08:03,836 --> 00:08:05,026
用我们从“设置”中获得的值

235
00:08:05,026 --> 00:08:07,236
为 accessibilitySpeechIPANotation

236
00:08:07,236 --> 00:08:09,256
添加属性

237
00:08:10,996 --> 00:08:12,686
最后 我们可以用

238
00:08:12,686 --> 00:08:17,116
属性字符串创建一个语音发声

239
00:08:17,246 --> 00:08:20,116
总而言之 AVSpeechSynthesis

240
00:08:20,116 --> 00:08:23,336
是增强你 App 体验的好方法

241
00:08:23,336 --> 00:08:24,266
前提是你要在合适的时间添加语音

242
00:08:24,766 --> 00:08:26,476
有多种语言和声音可用

243
00:08:26,476 --> 00:08:29,126
并且可以自定义

244
00:08:29,936 --> 00:08:31,336
最后 你还可以使用 IPA

245
00:08:31,336 --> 00:08:33,056
符号属性

246
00:08:33,056 --> 00:08:35,106
来为单词自定义发音

247
00:08:38,356 --> 00:08:40,226
若要获取更多信息

248
00:08:40,226 --> 00:08:43,366
请访问本章节的网址（URL） 感谢观看
