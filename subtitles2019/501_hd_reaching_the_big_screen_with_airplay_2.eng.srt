1
00:00:00,506 --> 0:00:03,500
[ Music ]

2
00:00:08,596 --> 0:00:09,426
&gt;&gt; All right.

3
00:00:10,026 --> 0:00:10,826
Good morning, everyone.

4
00:00:12,896 --> 0:00:14,496
My name is Jonathan Bennett and

5
00:00:14,496 --> 0:00:16,166
I work with the Connected Media

6
00:00:16,166 --> 0:00:16,966
team at Apple.

7
00:00:18,066 --> 0:00:19,416
And I'm happy to be here today

8
00:00:19,416 --> 0:00:20,706
helping kick off the conference,

9
00:00:20,706 --> 0:00:22,116
talking with you about AirPlay.

10
00:00:22,956 --> 0:00:25,036
So to start, let's talk about

11
00:00:25,466 --> 0:00:26,646
what you can do with AirPlay.

12
00:00:28,636 --> 0:00:30,326
You can use AirPlay to

13
00:00:30,326 --> 0:00:32,946
wirelessly send a video to watch

14
00:00:32,946 --> 0:00:35,916
on your TV or listen to music

15
00:00:35,916 --> 0:00:36,626
throughout your home.

16
00:00:37,606 --> 0:00:41,086
And you can also share pretty

17
00:00:41,176 --> 0:00:44,916
much anything from your iOS or

18
00:00:44,916 --> 0:00:46,556
macOS screen using AirPlay

19
00:00:46,666 --> 0:00:47,146
Mirroring.

20
00:00:48,436 --> 0:00:49,766
And so for today's talk, we're

21
00:00:49,766 --> 0:00:51,686
going to focus on video and

22
00:00:51,966 --> 0:00:52,796
we'll go over some of the

23
00:00:52,796 --> 0:00:55,756
enhancements we've made to make

24
00:00:55,756 --> 0:00:58,106
sure that you can find out about

25
00:00:58,106 --> 0:01:00,556
all the great TV destinations

26
00:00:58,106 --> 0:01:00,556
all the great TV destinations

27
00:01:00,636 --> 0:01:03,556
and AirPlay experiences on

28
00:01:04,256 --> 0:01:05,866
AirPlay sending devices.

29
00:01:09,536 --> 0:01:10,136
So when it comes to

30
00:01:10,136 --> 0:01:13,166
destinations, Apple TV used to

31
00:01:13,166 --> 0:01:14,086
be the only way that you could

32
00:01:14,086 --> 0:01:15,836
AirPlay a video to a TV, and

33
00:01:16,086 --> 0:01:17,336
it's still a great choice for

34
00:01:17,336 --> 0:01:18,426
many people.

35
00:01:18,886 --> 0:01:20,376
And as you heard earlier this

36
00:01:20,376 --> 0:01:23,556
year, we've been working with

37
00:01:23,666 --> 0:01:25,106
some of the largest TV

38
00:01:25,106 --> 0:01:29,106
manufacturers to build AirPlay

39
00:01:29,106 --> 0:01:31,856
support directly into the TVs.

40
00:01:32,226 --> 0:01:33,956
This dramatically increases the

41
00:01:33,956 --> 0:01:36,936
choices people have on where

42
00:01:36,936 --> 0:01:38,396
they can AirPlay their video to,

43
00:01:39,026 --> 0:01:41,126
and it adds a huge number of TVs

44
00:01:41,586 --> 0:01:44,266
that you can now take advantage

45
00:01:44,266 --> 0:01:44,466
of.

46
00:01:47,496 --> 0:01:49,436
So just look for this label on

47
00:01:49,436 --> 0:01:50,636
the box and you'll know that it

48
00:01:50,636 --> 0:01:52,776
supports AirPlay Mirroring,

49
00:01:53,186 --> 0:01:55,156
multi-room music and, of course,

50
00:01:55,156 --> 0:01:55,576
video.

51
00:01:56,146 --> 0:02:00,836
And this is a high-quality video

52
00:01:56,146 --> 0:02:00,836
And this is a high-quality video

53
00:02:00,836 --> 0:02:06,156
experience with both Apple TV

54
00:02:06,156 --> 0:02:08,156
and AirPlay capable TVs able to

55
00:02:08,156 --> 0:02:11,426
support up to 4K HDR video with

56
00:02:11,426 --> 0:02:12,236
a surround sound.

57
00:02:12,906 --> 0:02:15,976
So those are some of the great

58
00:02:15,976 --> 0:02:17,796
new additions that we've made to

59
00:02:17,796 --> 0:02:17,886
TVs.

60
00:02:18,456 --> 0:02:20,296
And when it comes to AirPlay

61
00:02:20,296 --> 0:02:22,726
sending devices, I'd like to go

62
00:02:22,726 --> 0:02:23,656
over some of the enhancements

63
00:02:23,656 --> 0:02:25,206
we've made to iOS to make it

64
00:02:25,206 --> 0:02:26,456
easier than ever for people to

65
00:02:26,456 --> 0:02:28,276
get the content they love from

66
00:02:28,276 --> 0:02:31,806
your app to the TV.

67
00:02:31,996 --> 0:02:34,426
So first, your video app can now

68
00:02:34,426 --> 0:02:36,486
sort TV destinations to the top

69
00:02:36,486 --> 0:02:38,266
of the AirPlay list, making it

70
00:02:38,266 --> 0:02:41,166
easier than ever to find the TV

71
00:02:41,166 --> 0:02:42,266
you want to play a video on.

72
00:02:43,706 --> 0:02:45,966
We've also made enhancements and

73
00:02:45,966 --> 0:02:47,286
enriched the remote controls

74
00:02:47,286 --> 0:02:50,976
available to allow people to

75
00:02:50,976 --> 0:02:53,316
interact with your video quickly

76
00:02:53,316 --> 0:02:53,996
and easily.

77
00:02:54,616 --> 0:02:57,246
And we've also made improvements

78
00:02:57,246 --> 0:02:58,076
to allow people to better

79
00:02:58,076 --> 0:02:59,816
multitask on their iOS devices

80
00:02:59,816 --> 0:03:02,046
so they can receive a phone call

81
00:02:59,816 --> 0:03:02,046
so they can receive a phone call

82
00:03:02,046 --> 0:03:04,556
or check out that cute video

83
00:03:04,556 --> 0:03:05,796
that they just got from an

84
00:03:05,796 --> 0:03:07,786
iMessage while your video

85
00:03:07,786 --> 0:03:09,066
continues playing on the TV.

86
00:03:11,086 --> 0:03:13,566
And lastly, iOS can now

87
00:03:13,566 --> 0:03:16,076
intelligently suggest to TV to

88
00:03:16,076 --> 0:03:17,666
AirPlay to using on-device

89
00:03:17,666 --> 0:03:18,006
learning.

90
00:03:18,386 --> 0:03:19,806
So I can just sit back on the

91
00:03:19,806 --> 0:03:21,566
couch, launch your video app,

92
00:03:22,186 --> 0:03:23,436
and just tap on my favorite show

93
00:03:23,436 --> 0:03:25,256
and have it automatically show

94
00:03:25,256 --> 0:03:25,906
on the TV.

95
00:03:26,566 --> 0:03:30,266
With great new TV destinations

96
00:03:30,266 --> 0:03:31,316
and all of these experience

97
00:03:31,316 --> 0:03:32,786
improvements, now is the time to

98
00:03:32,786 --> 0:03:34,346
make sure that your video apps

99
00:03:34,386 --> 0:03:35,536
fully support AirPlay.

100
00:03:36,446 --> 0:03:37,896
So I'd like to take the rest of

101
00:03:37,896 --> 0:03:40,486
this talk to go over five key

102
00:03:40,486 --> 0:03:43,296
areas that you can add this

103
00:03:43,296 --> 0:03:44,246
great experience.

104
00:03:45,256 --> 0:03:47,156
First, we'll make sure that you

105
00:03:47,156 --> 0:03:48,376
have high-quality video

106
00:03:48,376 --> 0:03:49,696
available for the TV.

107
00:03:51,376 --> 0:03:52,816
Then we'll provide a way for

108
00:03:52,816 --> 0:03:54,096
people to get that video onto

109
00:03:54,096 --> 0:03:55,716
the TV using an in-app picker.

110
00:03:56,326 --> 0:03:59,676
And once it's on the TV, we'll

111
00:03:59,676 --> 0:04:00,606
make sure that people can

112
00:03:59,676 --> 0:04:00,606
make sure that people can

113
00:04:00,606 --> 0:04:04,536
control it and we'll make sure

114
00:04:04,536 --> 0:04:05,986
that that video keeps on playing

115
00:04:06,936 --> 0:04:08,796
while they use their iOS device

116
00:04:08,796 --> 0:04:09,476
for other things.

117
00:04:10,096 --> 0:04:13,256
And lastly, if you have an app

118
00:04:13,306 --> 0:04:15,836
that plays primarily long-form

119
00:04:15,836 --> 0:04:18,786
video like movies or TV, there

120
00:04:18,786 --> 0:04:19,805
are some additional steps that

121
00:04:19,805 --> 0:04:20,796
you should take to make sure

122
00:04:20,796 --> 0:04:22,966
that your users benefit from

123
00:04:23,426 --> 0:04:25,356
intelligent AirPlay Suggestions.

124
00:04:25,946 --> 0:04:29,986
So let's start by talking about

125
00:04:30,256 --> 0:04:31,256
high-quality video.

126
00:04:33,126 --> 0:04:35,466
HTTP Live Streaming is a fast

127
00:04:35,466 --> 0:04:36,666
and adaptive way to stream

128
00:04:36,726 --> 0:04:37,916
high-quality video to any

129
00:04:37,916 --> 0:04:38,506
device.

130
00:04:38,686 --> 0:04:40,926
And you're likely already using

131
00:04:40,956 --> 0:04:43,476
HLS to deliver video to your iOS

132
00:04:43,476 --> 0:04:43,886
apps.

133
00:04:44,916 --> 0:04:46,256
Now, some of you might be

134
00:04:46,256 --> 0:04:48,286
curating your playlist to focus

135
00:04:48,286 --> 0:04:49,536
on those type of devices.

136
00:04:50,266 --> 0:04:52,096
So, an iPhone screen or an iPad

137
00:04:52,096 --> 0:04:52,576
screen.

138
00:04:53,996 --> 0:04:55,796
But remember at any time, a user

139
00:04:55,796 --> 0:04:57,656
could take that video and want

140
00:04:57,656 --> 0:04:59,036
to send it and AirPlay it to a

141
00:04:59,036 --> 0:04:59,656
TV.

142
00:04:59,656 --> 0:05:00,696
So it's important that you have

143
00:04:59,656 --> 0:05:00,696
So it's important that you have

144
00:05:00,696 --> 0:05:02,376
a full range of variants in your

145
00:05:02,376 --> 0:05:04,876
playlist that are appropriate

146
00:05:05,246 --> 0:05:07,036
for a TV, including variants

147
00:05:07,036 --> 0:05:10,196
that support 4K, HDR and

148
00:05:10,196 --> 0:05:10,946
surround sound.

149
00:05:12,656 --> 0:05:14,266
Now, if in your playlist you

150
00:05:14,266 --> 0:05:15,966
have multiple video codecs that

151
00:05:15,966 --> 0:05:17,626
you use to encode your content,

152
00:05:18,226 --> 0:05:19,766
be sure to also provide a full

153
00:05:19,766 --> 0:05:21,276
range of variants for each video

154
00:05:21,276 --> 0:05:21,696
codec.

155
00:05:22,426 --> 0:05:23,506
This makes sure that your video

156
00:05:23,506 --> 0:05:25,386
is fully supported on any device

157
00:05:25,386 --> 0:05:27,646
it plays back on and it also

158
00:05:27,646 --> 0:05:29,166
makes sure that the player can

159
00:05:29,246 --> 0:05:31,876
transition smoothly between

160
00:05:31,876 --> 0:05:33,576
variants using the same video

161
00:05:34,246 --> 0:05:34,406
codec.

162
00:05:36,386 --> 0:05:37,856
Now, one thing that I find

163
00:05:37,856 --> 0:05:40,536
myself doing frequently is fast

164
00:05:40,536 --> 0:05:41,696
forwarding or seeking through

165
00:05:41,696 --> 0:05:42,186
video.

166
00:05:42,426 --> 0:05:46,656
And whether that's to skip a

167
00:05:46,966 --> 0:05:48,676
scary part of a movie with--

168
00:05:48,676 --> 0:05:49,986
that I'm watching with my kids

169
00:05:49,986 --> 0:05:51,716
or to find that interesting

170
00:05:51,716 --> 0:05:53,306
topic in the middle of a WWDC

171
00:05:53,306 --> 0:05:57,386
video having fast, rapid, frame

172
00:05:57,386 --> 0:05:59,716
previews while seeking allows me

173
00:05:59,716 --> 0:06:01,886
to find what I want quickly and

174
00:05:59,716 --> 0:06:01,886
to find what I want quickly and

175
00:06:01,886 --> 0:06:02,476
confidently.

176
00:06:03,296 --> 0:06:04,896
So you can add the support in

177
00:06:04,896 --> 0:06:06,366
your videos by including an

178
00:06:06,426 --> 0:06:09,446
I-frame variant to your HLS

179
00:06:10,776 --> 0:06:11,046
playlist.

180
00:06:11,606 --> 0:06:13,946
And lastly, if you have

181
00:06:13,946 --> 0:06:15,426
high-value content that you need

182
00:06:15,426 --> 0:06:16,566
to protect and manage, you're

183
00:06:16,566 --> 0:06:18,196
likely using FairPlay Streaming

184
00:06:18,196 --> 0:06:18,726
to do that.

185
00:06:19,516 --> 0:06:21,106
And FairPlay Streaming is fully

186
00:06:21,106 --> 0:06:22,866
supported whenever and wherever

187
00:06:22,866 --> 0:06:24,626
you AirPlay, that includes

188
00:06:24,626 --> 0:06:25,926
AirPlaying to an Apple TV.

189
00:06:26,156 --> 0:06:28,296
And I'm also happy to say that

190
00:06:28,296 --> 0:06:29,526
FairPlay Streaming is supported

191
00:06:29,526 --> 0:06:31,506
on every smart TV with built-in

192
00:06:31,506 --> 0:06:32,276
AirPlay support.

193
00:06:32,806 --> 0:06:35,786
Now, there are more details

194
00:06:35,786 --> 0:06:37,496
about validating your HL streams

195
00:06:37,496 --> 0:06:38,706
for AirPlay than we can cover

196
00:06:38,706 --> 0:06:40,336
here today, so we've made a

197
00:06:40,336 --> 0:06:41,826
separate video associated with

198
00:06:41,826 --> 0:06:43,196
this session and I encourage you

199
00:06:43,196 --> 0:06:46,206
to check that out.

200
00:06:46,806 --> 0:06:48,826
So, having high-quality content

201
00:06:48,826 --> 0:06:50,266
is great but we also want to

202
00:06:50,266 --> 0:06:51,606
make sure that we have smooth

203
00:06:51,606 --> 0:06:52,296
playback.

204
00:06:53,376 --> 0:06:56,366
Now, if you have pre, mid or

205
00:06:56,366 --> 0:06:57,846
post-roll content that you need

206
00:06:57,846 --> 0:07:00,686
to insert into your video, use

207
00:06:57,846 --> 0:07:00,686
to insert into your video, use

208
00:07:00,686 --> 0:07:02,256
HLS's discontinuity tag to do

209
00:07:02,256 --> 0:07:02,896
that.

210
00:07:03,226 --> 0:07:05,126
This allows the player to remain

211
00:07:05,126 --> 0:07:06,486
intact and the estimated

212
00:07:06,486 --> 0:07:07,816
bandwidths to remain intact so

213
00:07:07,816 --> 0:07:09,086
both your interstitial video

214
00:07:09,086 --> 0:07:10,086
plays in high quality.

215
00:07:10,486 --> 0:07:11,646
And when it ends and you resume

216
00:07:11,646 --> 0:07:13,176
the main content, that content

217
00:07:13,176 --> 0:07:15,196
can immediately begin in high

218
00:07:15,196 --> 0:07:15,736
quality.

219
00:07:16,356 --> 0:07:19,406
It's, again, important to make

220
00:07:19,406 --> 0:07:20,536
sure that these interstitial

221
00:07:20,536 --> 0:07:21,656
videos have the same video

222
00:07:21,656 --> 0:07:23,366
formatting as the main content,

223
00:07:23,846 --> 0:07:25,316
such as the same video codec and

224
00:07:25,316 --> 0:07:26,556
this allows these transitions to

225
00:07:26,556 --> 0:07:30,026
happen quickly and smoothly.

226
00:07:30,166 --> 0:07:32,146
Now, if you can't use HLS

227
00:07:32,146 --> 0:07:33,286
discontinuity tag for some

228
00:07:33,286 --> 0:07:34,766
reason or you have multiple

229
00:07:34,766 --> 0:07:36,056
pieces of content that you want

230
00:07:36,056 --> 0:07:38,436
to play serially, we encourage

231
00:07:38,436 --> 0:07:39,816
you to use AVQueuePlayer when

232
00:07:39,816 --> 0:07:40,366
AirPlaying.

233
00:07:43,006 --> 0:07:45,276
And if you can't use

234
00:07:45,276 --> 0:07:47,286
AVQueuePlayer when AirPlaying,

235
00:07:47,286 --> 0:07:49,166
please use the same AVPlayer

236
00:07:49,166 --> 0:07:51,316
instance and just replace the

237
00:07:51,316 --> 0:07:52,326
current item with your new

238
00:07:52,326 --> 0:07:52,856
content.

239
00:07:53,216 --> 0:07:55,286
You don't want to destroy an

240
00:07:55,286 --> 0:07:56,756
AVPlayer and create a new one

241
00:07:57,066 --> 0:07:58,976
for every piece of video or swap

242
00:07:58,976 --> 0:08:01,026
between instances, because when

243
00:07:58,976 --> 0:08:01,026
between instances, because when

244
00:08:01,026 --> 0:08:02,536
AirPlaying, the system doesn't

245
00:08:02,536 --> 0:08:03,966
know that a new piece of video

246
00:08:03,966 --> 0:08:04,916
is going to be arriving.

247
00:08:05,206 --> 0:08:06,876
And so it might start tearing

248
00:08:06,876 --> 0:08:07,976
down the engine and you don't

249
00:08:08,516 --> 0:08:09,746
want to introduce this type of

250
00:08:09,746 --> 0:08:10,846
delay just because you're

251
00:08:10,846 --> 0:08:12,346
transitioning between videos.

252
00:08:14,896 --> 0:08:17,036
All right, we've got

253
00:08:17,226 --> 0:08:18,296
high-quality content.

254
00:08:18,386 --> 0:08:20,176
Now, let's give a way for people

255
00:08:20,176 --> 0:08:21,426
to get that to the TV.

256
00:08:22,676 --> 0:08:24,056
And you can do that by adding an

257
00:08:24,056 --> 0:08:25,446
AirPlay picker into your app.

258
00:08:26,506 --> 0:08:28,076
And new in iOS 13, you can

259
00:08:28,076 --> 0:08:29,586
decide how you want to order

260
00:08:29,736 --> 0:08:30,856
those destinations.

261
00:08:31,446 --> 0:08:35,366
To add an AirPlay picker, use

262
00:08:35,366 --> 0:08:36,385
AVRoutePickerView.

263
00:08:36,576 --> 0:08:38,256
It's been available since iOS 11

264
00:08:38,785 --> 0:08:40,836
and it's now available on macOS.

265
00:08:42,306 --> 0:08:43,566
Now, some of you might be using

266
00:08:43,635 --> 0:08:45,286
MPVolumeView's route button

267
00:08:45,286 --> 0:08:47,176
properties to get a picker in

268
00:08:47,176 --> 0:08:47,476
your app.

269
00:08:47,926 --> 0:08:50,906
And in iOS 13, the route button

270
00:08:50,906 --> 0:08:52,546
properties are now deprecated.

271
00:08:54,196 --> 0:08:55,346
Now, don't worry, you can still

272
00:08:55,346 --> 0:08:58,266
use MPVolumeView for putting

273
00:08:58,266 --> 0:08:59,796
volume UI into your app.

274
00:08:59,956 --> 0:09:00,736
But when it comes to route

275
00:08:59,956 --> 0:09:00,736
But when it comes to route

276
00:09:00,736 --> 0:09:02,766
buttons, use RoutePickerView.

277
00:09:08,496 --> 0:09:11,976
So let's see how you can add

278
00:09:11,976 --> 0:09:13,816
that, and it's really simple.

279
00:09:14,436 --> 0:09:16,566
All I have to do is create a

280
00:09:16,566 --> 0:09:17,876
AVRoutePickerView and add it to

281
00:09:17,876 --> 0:09:18,686
my view hierarchy.

282
00:09:20,376 --> 0:09:23,236
And in iOS 13, I can set

283
00:09:23,236 --> 0:09:25,166
prioritizesVideoDevices to true

284
00:09:25,646 --> 0:09:28,996
and that will give me a route

285
00:09:28,996 --> 0:09:31,516
button icon that is focused on

286
00:09:31,516 --> 0:09:33,176
video with the AirPlay video

287
00:09:33,176 --> 0:09:36,056
logo, and it also sorts those TV

288
00:09:36,056 --> 0:09:37,296
destinations to the top making

289
00:09:37,296 --> 0:09:39,366
it super easy to find that TV I

290
00:09:39,366 --> 0:09:40,756
want to play to.

291
00:09:44,436 --> 0:09:46,536
So now that I have video playing

292
00:09:46,536 --> 0:09:48,636
on the TV, let's make sure that

293
00:09:48,676 --> 0:09:49,836
people have a way to control it

294
00:09:49,836 --> 0:09:51,036
and this is really important.

295
00:09:51,036 --> 0:09:52,166
And so we've made sure that

296
00:09:52,166 --> 0:09:53,626
remote controls are more

297
00:09:53,626 --> 0:09:55,426
convenient and capable than ever

298
00:09:55,616 --> 0:09:56,526
throughout the system.

299
00:09:57,716 --> 0:09:59,556
For example, I can control my

300
00:09:59,556 --> 0:10:02,236
video with lock screen controls

301
00:09:59,556 --> 0:10:02,236
video with lock screen controls

302
00:10:02,236 --> 0:10:03,426
and we've added additional

303
00:10:03,426 --> 0:10:04,346
capabilities when you've

304
00:10:04,346 --> 0:10:06,876
targeted a TV.

305
00:10:07,046 --> 0:10:09,186
I can also use Siri and issue

306
00:10:09,186 --> 0:10:10,906
play commands and say, you know,

307
00:10:10,906 --> 0:10:12,276
play this on my TV.

308
00:10:16,666 --> 0:10:18,816
And it's not just about

309
00:10:18,816 --> 0:10:20,746
controlling what's on your iOS

310
00:10:20,746 --> 0:10:22,306
device but also the devices

311
00:10:22,306 --> 0:10:22,886
around you.

312
00:10:23,536 --> 0:10:24,576
For example, you can pull down

313
00:10:24,576 --> 0:10:25,846
Control Center and you can

314
00:10:25,846 --> 0:10:27,296
target HomePods that are playing

315
00:10:27,296 --> 0:10:29,086
music throughout your home or

316
00:10:29,086 --> 0:10:30,806
even a tvOS app that is playing

317
00:10:30,806 --> 0:10:32,136
a video and I can see what's

318
00:10:32,136 --> 0:10:33,606
playing and control it from

319
00:10:33,606 --> 0:10:34,686
almost any device.

320
00:10:39,136 --> 0:10:41,216
So, what happens if your app

321
00:10:41,216 --> 0:10:42,896
doesn't support remote controls?

322
00:10:42,896 --> 0:10:44,216
Well, here I have my app and

323
00:10:44,216 --> 0:10:45,566
it's AirPlaying to the TV.

324
00:10:46,006 --> 0:10:48,276
But if I were to lock the

325
00:10:48,276 --> 0:10:49,826
screen, I wouldn't know that the

326
00:10:49,826 --> 0:10:51,066
video is playing and, more

327
00:10:51,066 --> 0:10:52,306
importantly, I would have no way

328
00:10:52,306 --> 0:10:53,546
to interact with that video.

329
00:10:55,846 --> 0:10:56,866
So by supporting remote

330
00:10:56,866 --> 0:10:59,616
controls, you can know what's

331
00:10:59,616 --> 0:11:02,816
playing, how far along I am in

332
00:10:59,616 --> 0:11:02,816
playing, how far along I am in

333
00:11:02,816 --> 0:11:05,476
that video, a great way to

334
00:11:05,476 --> 0:11:07,646
interact with it quickly, and

335
00:11:07,996 --> 0:11:09,336
then there's even a way to get

336
00:11:09,336 --> 0:11:10,616
back to the app that's currently

337
00:11:10,616 --> 0:11:12,096
playing that video by just

338
00:11:12,096 --> 0:11:14,546
tapping the artwork or the

339
00:11:15,116 --> 0:11:15,316
title.

340
00:11:15,416 --> 0:11:18,246
So, let's go through how you can

341
00:11:18,246 --> 0:11:19,416
add these remote controls in

342
00:11:19,416 --> 0:11:20,836
your app and it starts with

343
00:11:20,836 --> 0:11:24,076
becoming the Now Playing app.

344
00:11:24,336 --> 0:11:25,716
You become the Now Playing app

345
00:11:25,716 --> 0:11:27,306
by doing two things, one is to

346
00:11:27,306 --> 0:11:28,886
at least support one remote

347
00:11:28,886 --> 0:11:30,736
control command and the other is

348
00:11:30,736 --> 0:11:32,046
to initiate playback with

349
00:11:32,046 --> 0:11:33,316
immediate configuration.

350
00:11:34,696 --> 0:11:36,356
And on iOS, that means

351
00:11:36,356 --> 0:11:38,056
activating your audio session

352
00:11:38,056 --> 0:11:40,066
with a non-mixable category.

353
00:11:40,246 --> 0:11:41,506
And for most video apps, that's

354
00:11:41,506 --> 0:11:42,286
going to be the playback

355
00:11:42,286 --> 0:11:42,856
category.

356
00:11:43,476 --> 0:11:47,006
On macOS and iOS code running on

357
00:11:47,006 --> 0:11:48,656
macOS, you'll do something

358
00:11:48,656 --> 0:11:49,896
slightly different.

359
00:11:49,896 --> 0:11:51,476
You're going to grab the

360
00:11:51,476 --> 0:11:53,856
MPNowPlayingInfoCenter and

361
00:11:54,486 --> 0:11:55,606
change the playback state

362
00:11:55,606 --> 0:11:57,956
whenever you start or end your

363
00:11:57,956 --> 0:11:59,086
video experience.

364
00:11:59,606 --> 0:12:03,286
When it comes to supporting

365
00:11:59,606 --> 0:12:03,286
When it comes to supporting

366
00:12:03,286 --> 0:12:04,986
remote controls, if you're using

367
00:12:04,986 --> 0:12:06,896
AVKit's AVPlayerViewController

368
00:12:06,896 --> 0:12:08,096
to present your video, it

369
00:12:08,406 --> 0:12:09,956
handles remote controls for you

370
00:12:10,016 --> 0:12:11,706
so you're all set.

371
00:12:13,256 --> 0:12:15,336
If you're using AVFoundation and

372
00:12:15,336 --> 0:12:16,736
a custom UI to present your

373
00:12:16,736 --> 0:12:18,766
video, you'll need to use

374
00:12:18,766 --> 0:12:19,846
MPRemoteCommandCenter and

375
00:12:19,926 --> 0:12:21,756
MPNowPlayingInfoCenter in order

376
00:12:21,756 --> 0:12:23,146
to get equivalent functionality.

377
00:12:23,596 --> 0:12:24,906
And so I'd like to spend some

378
00:12:24,976 --> 0:12:26,296
time going through step by step

379
00:12:26,296 --> 0:12:27,816
about how you use this media

380
00:12:27,816 --> 0:12:30,256
player APIs and build out this

381
00:12:30,256 --> 0:12:31,006
functionality.

382
00:12:31,616 --> 0:12:34,416
So here I am back at my lonely

383
00:12:34,416 --> 0:12:37,216
lock screen, and let's just add

384
00:12:37,216 --> 0:12:39,156
some basic support by supporting

385
00:12:39,156 --> 0:12:39,896
the play command.

386
00:12:40,526 --> 0:12:43,856
I can do that by creating a

387
00:12:43,856 --> 0:12:45,396
setup method for supporting

388
00:12:45,396 --> 0:12:46,286
remote controls.

389
00:12:46,906 --> 0:12:48,166
And we'll be coming back to this

390
00:12:48,166 --> 0:12:49,316
method again and again as we

391
00:12:49,316 --> 0:12:50,196
continue to build out our

392
00:12:50,196 --> 0:12:50,816
support.

393
00:12:51,346 --> 0:12:54,256
I first grab the shared instance

394
00:12:54,256 --> 0:12:55,256
of the remote command center.

395
00:12:55,916 --> 0:12:58,596
And the remote command center

396
00:12:58,896 --> 0:13:00,456
supports many different types of

397
00:12:58,896 --> 0:13:00,456
supports many different types of

398
00:13:00,676 --> 0:13:01,516
media commands.

399
00:13:02,096 --> 0:13:03,346
Here, we're supporting the play

400
00:13:03,346 --> 0:13:03,826
command.

401
00:13:03,996 --> 0:13:05,596
And to that, we'll add a target

402
00:13:05,596 --> 0:13:07,606
handler to receive that command

403
00:13:07,606 --> 0:13:08,686
and do something with it.

404
00:13:09,306 --> 0:13:10,616
So here, we'll start our

405
00:13:10,616 --> 0:13:10,936
playback.

406
00:13:10,936 --> 0:13:14,096
And once I've done that, I'll

407
00:13:14,096 --> 0:13:15,966
return a status on whether that

408
00:13:15,966 --> 0:13:17,346
command succeeded or failed.

409
00:13:18,266 --> 0:13:19,966
And this is the basic structure

410
00:13:19,966 --> 0:13:20,976
you're going to use for any

411
00:13:20,976 --> 0:13:22,276
remote command that you support.

412
00:13:22,846 --> 0:13:25,936
So to flash out our playback

413
00:13:25,936 --> 0:13:28,106
command handling, we'll support

414
00:13:28,106 --> 0:13:29,446
the pause command and the

415
00:13:29,446 --> 0:13:31,176
togglePlayPauseCommand by adding

416
00:13:31,176 --> 0:13:32,216
handlers for those.

417
00:13:32,786 --> 0:13:36,496
So this got me a platter with a

418
00:13:36,496 --> 0:13:38,926
play/pause button and I at least

419
00:13:38,926 --> 0:13:40,236
know what app is playing, but

420
00:13:40,236 --> 0:13:41,916
it'd be really great to know

421
00:13:42,176 --> 0:13:43,236
what video is playing.

422
00:13:43,856 --> 0:13:46,656
And you can do that by providing

423
00:13:46,656 --> 0:13:47,846
Now Playing info.

424
00:13:49,026 --> 0:13:50,296
And Now Playing info comes in

425
00:13:50,296 --> 0:13:53,266
two parts, one is the item

426
00:13:53,266 --> 0:13:54,616
metadata such as the artwork or

427
00:13:54,616 --> 0:13:56,896
title and then the playback

428
00:13:56,896 --> 0:13:58,326
state such as the duration and

429
00:13:58,326 --> 0:13:59,926
the current elapsed time.

430
00:14:00,366 --> 0:14:02,056
So in my code, there are two

431
00:14:02,056 --> 0:14:03,706
major events where I'll want to

432
00:14:03,706 --> 0:14:04,576
update this information.

433
00:14:05,196 --> 0:14:07,486
One is when a item changes, so

434
00:14:07,486 --> 0:14:09,336
going from episode one to

435
00:14:09,336 --> 0:14:10,936
episode two.

436
00:14:12,296 --> 0:14:14,016
The other is when I have a

437
00:14:14,016 --> 0:14:15,736
current item and the playback

438
00:14:15,736 --> 0:14:17,346
state changes so I-- my rate

439
00:14:17,346 --> 0:14:20,166
changes or I seek to a new

440
00:14:20,166 --> 0:14:21,256
position in the video.

441
00:14:21,886 --> 0:14:26,686
So when an item changes, I'm

442
00:14:26,686 --> 0:14:28,466
going to take a metadata that

443
00:14:28,466 --> 0:14:30,336
I've packaged up in my app with

444
00:14:30,336 --> 0:14:31,906
a structure just to pass it

445
00:14:31,906 --> 0:14:33,776
around through my app, I'm going

446
00:14:33,776 --> 0:14:34,986
to update that static Now

447
00:14:34,986 --> 0:14:36,686
Playing info such as the title

448
00:14:36,686 --> 0:14:37,366
and the artwork.

449
00:14:38,206 --> 0:14:41,436
And if I have it, I'm going to

450
00:14:41,646 --> 0:14:43,696
update the playback info at this

451
00:14:43,696 --> 0:14:44,616
time as well.

452
00:14:45,926 --> 0:14:47,056
Now, when a playback state

453
00:14:47,056 --> 0:14:50,416
change happens, all I need to do

454
00:14:50,416 --> 0:14:51,846
is update that playback info.

455
00:14:51,846 --> 0:14:54,496
I don't need to update artwork

456
00:14:54,496 --> 0:14:56,446
and spend time doing all of

457
00:14:57,216 --> 0:14:57,326
that.

458
00:14:57,446 --> 0:14:58,846
So let's see how you can update

459
00:14:58,846 --> 0:14:59,806
some of this information.

460
00:15:00,366 --> 0:15:02,806
And the first thing I'm going to

461
00:15:02,806 --> 0:15:04,296
do is grab the Now Playing info

462
00:15:04,296 --> 0:15:06,496
dictionary from the shared info

463
00:15:06,496 --> 0:15:06,956
center.

464
00:15:07,546 --> 0:15:11,036
And to this dictionary, I'm

465
00:15:11,036 --> 0:15:12,296
going to update my metadata.

466
00:15:12,296 --> 0:15:13,866
So here, I'm updating title and

467
00:15:13,866 --> 0:15:14,396
artwork.

468
00:15:14,676 --> 0:15:16,016
And there are many other types

469
00:15:16,016 --> 0:15:17,276
of metadata that are supported

470
00:15:17,276 --> 0:15:18,576
and that I might support in my

471
00:15:18,576 --> 0:15:18,826
app.

472
00:15:19,756 --> 0:15:21,266
Regardless of what I support,

473
00:15:21,266 --> 0:15:23,426
it's important to update this

474
00:15:23,426 --> 0:15:25,216
metadata or clear it out, nil it

475
00:15:25,216 --> 0:15:28,206
out if a particular item doesn't

476
00:15:28,206 --> 0:15:29,826
have that type of property.

477
00:15:30,636 --> 0:15:32,866
You don't want a mix of old and

478
00:15:32,866 --> 0:15:35,206
new metadata in the dictionary.

479
00:15:35,766 --> 0:15:38,606
Once I've updated it, though, I

480
00:15:38,606 --> 0:15:39,996
just pass it back to the info

481
00:15:39,996 --> 0:15:41,126
center for presentation.

482
00:15:41,746 --> 0:15:46,816
So, it's really simple to update

483
00:15:47,106 --> 0:15:48,276
Now Playing information.

484
00:15:48,446 --> 0:15:49,936
And now, let's see how we update

485
00:15:49,936 --> 0:15:50,896
the playback info.

486
00:15:51,956 --> 0:15:53,496
And it's done very similarly.

487
00:15:53,496 --> 0:15:54,836
I grab the Now Playing

488
00:15:54,836 --> 0:15:56,466
information, the info

489
00:15:56,466 --> 0:15:58,366
dictionary, and to that, I'm

490
00:15:58,366 --> 0:15:59,906
going to update the duration,

491
00:15:59,906 --> 0:16:01,376
the elapse playback time, and

492
00:15:59,906 --> 0:16:01,376
the elapse playback time, and

493
00:16:01,376 --> 0:16:02,076
the playback rate.

494
00:16:03,256 --> 0:16:05,846
And now, I only need to update

495
00:16:05,846 --> 0:16:07,106
this on significant change

496
00:16:07,106 --> 0:16:07,356
events.

497
00:16:07,356 --> 0:16:08,326
I don't need to update this

498
00:16:08,326 --> 0:16:10,006
every second to see progress

499
00:16:10,136 --> 0:16:10,886
through the remote UIs.

500
00:16:10,886 --> 0:16:12,906
As long as I update these three

501
00:16:12,966 --> 0:16:15,216
items when a rate changes or I

502
00:16:15,216 --> 0:16:16,776
have a significant jump, then

503
00:16:16,776 --> 0:16:18,816
the system can infer where you

504
00:16:18,816 --> 0:16:20,206
are in your video at any given

505
00:16:20,206 --> 0:16:22,236
moment and update the remote UIs

506
00:16:22,236 --> 0:16:22,816
accordingly.

507
00:16:23,406 --> 0:16:25,836
And again, once I've updated

508
00:16:25,836 --> 0:16:26,916
this, I'll just pass it back to

509
00:16:26,916 --> 0:16:29,206
the info center to get

510
00:16:30,276 --> 0:16:30,586
presented.

511
00:16:31,006 --> 0:16:32,686
So I know what video is playing

512
00:16:32,686 --> 0:16:34,216
and it's really nice to be able

513
00:16:34,216 --> 0:16:36,506
to navigate through that video.

514
00:16:37,156 --> 0:16:39,096
So you can add the support for a

515
00:16:39,096 --> 0:16:41,406
seeking with a playhead scrubber

516
00:16:42,726 --> 0:16:44,206
or skipping forward and backward

517
00:16:44,706 --> 0:16:45,386
in your video.

518
00:16:45,446 --> 0:16:47,666
So let's see how we do this.

519
00:16:48,976 --> 0:16:50,606
So we're back in our method for

520
00:16:50,606 --> 0:16:51,786
setting up remote control

521
00:16:51,786 --> 0:16:52,326
commands.

522
00:16:52,616 --> 0:16:55,046
And I'm going to add support for

523
00:16:55,046 --> 0:16:56,186
the skip forward command.

524
00:16:56,816 --> 0:16:58,386
And this is one of the commands

525
00:16:58,386 --> 0:16:59,206
that supports additional

526
00:16:59,206 --> 0:17:01,016
configuration, and here, I'm

527
00:16:59,206 --> 0:17:01,016
configuration, and here, I'm

528
00:17:01,016 --> 0:17:02,026
setting the preferred skip

529
00:17:02,026 --> 0:17:03,746
interval to 15 seconds.

530
00:17:04,526 --> 0:17:07,576
I then add a handler for that

531
00:17:07,576 --> 0:17:08,046
command.

532
00:17:09,506 --> 0:17:10,796
And it's important to note here

533
00:17:10,796 --> 0:17:12,646
that I'm using the interval

534
00:17:12,646 --> 0:17:13,556
that's passed to me through the

535
00:17:13,556 --> 0:17:14,396
commands event.

536
00:17:15,195 --> 0:17:16,366
Just because I set a preferred

537
00:17:16,366 --> 0:17:17,226
interval doesn't mean that's

538
00:17:17,226 --> 0:17:18,455
going to be used every time.

539
00:17:18,786 --> 0:17:20,816
For example, I could ask Siri to

540
00:17:20,816 --> 0:17:23,036
jump forward by 42 seconds.

541
00:17:23,106 --> 0:17:24,175
And that's the value that's

542
00:17:24,175 --> 0:17:25,326
going to get passed to me and

543
00:17:25,326 --> 0:17:26,356
the one that I should honor.

544
00:17:26,976 --> 0:17:30,446
I'll then round out my support

545
00:17:30,626 --> 0:17:32,576
by supporting the skip backward

546
00:17:32,576 --> 0:17:34,576
command and the change playback

547
00:17:34,576 --> 0:17:35,966
position command which is used

548
00:17:35,966 --> 0:17:36,616
when seeking.

549
00:17:37,206 --> 0:17:41,266
Now, for some apps and some

550
00:17:41,266 --> 0:17:42,396
types of video, you might need

551
00:17:42,396 --> 0:17:43,586
to temporarily disable

552
00:17:43,586 --> 0:17:45,636
navigation and you can easily do

553
00:17:45,636 --> 0:17:47,076
that by setting the isEnabled

554
00:17:47,076 --> 0:17:48,646
property on the commands that

555
00:17:48,646 --> 0:17:49,526
you need to disable.

556
00:17:49,966 --> 0:17:50,856
You don't need to remove the

557
00:17:50,856 --> 0:17:55,286
target handler and add it back.

558
00:17:56,066 --> 0:17:58,046
So one thing new this year that

559
00:17:58,046 --> 0:17:59,406
we've added to remote control

560
00:17:59,406 --> 0:18:01,866
UIs is the ability to select and

561
00:17:59,406 --> 0:18:01,866
UIs is the ability to select and

562
00:18:01,866 --> 0:18:03,496
change audio languages and

563
00:18:03,496 --> 0:18:04,246
subtitles.

564
00:18:04,446 --> 0:18:06,456
So if you have video with these

565
00:18:06,456 --> 0:18:08,326
types of options, you're going

566
00:18:08,326 --> 0:18:09,316
to want to add this type of

567
00:18:09,316 --> 0:18:11,866
support for remote controlling.

568
00:18:12,296 --> 0:18:14,746
This allows people to watch the

569
00:18:14,746 --> 0:18:19,636
video the way they want and need

570
00:18:19,636 --> 0:18:20,236
easily.

571
00:18:20,836 --> 0:18:22,766
So you can add this support by

572
00:18:22,766 --> 0:18:25,096
providing a list of audible and

573
00:18:25,096 --> 0:18:28,206
legible language options that

574
00:18:28,206 --> 0:18:29,406
represent the audio languages

575
00:18:29,406 --> 0:18:30,196
and subtitles.

576
00:18:30,746 --> 0:18:32,366
And you can also then identify

577
00:18:32,366 --> 0:18:33,376
the current selections in each

578
00:18:33,376 --> 0:18:34,176
of those groups.

579
00:18:34,736 --> 0:18:35,986
And lastly, you're going to want

580
00:18:35,986 --> 0:18:37,316
to handle changes to those

581
00:18:37,316 --> 0:18:39,156
selections via the remote UIs.

582
00:18:39,466 --> 0:18:42,706
So let's see how we provide this

583
00:18:42,706 --> 0:18:43,236
information.

584
00:18:43,836 --> 0:18:46,396
And it starts by creating a

585
00:18:46,396 --> 0:18:46,886
mapping.

586
00:18:47,076 --> 0:18:49,466
So I'm going to load the audible

587
00:18:49,466 --> 0:18:52,876
and legible language groups from

588
00:18:52,986 --> 0:18:54,006
my AVAsset.

589
00:18:54,006 --> 0:18:55,696
And I'm going to create a

590
00:18:55,696 --> 0:18:57,906
mapping of these by translating

591
00:18:57,906 --> 0:18:59,406
them into the media player

592
00:18:59,856 --> 0:19:02,466
objects that represent these

593
00:18:59,856 --> 0:19:02,466
objects that represent these

594
00:19:02,466 --> 0:19:03,186
options.

595
00:19:03,286 --> 0:19:04,296
And I can use convenience

596
00:19:04,296 --> 0:19:05,196
functions to do that.

597
00:19:05,196 --> 0:19:07,406
And I'll maintain this mapping

598
00:19:07,776 --> 0:19:10,286
in my app so that when I receive

599
00:19:10,286 --> 0:19:11,466
a language option from a remote

600
00:19:11,466 --> 0:19:12,476
command, I can eventually

601
00:19:12,476 --> 0:19:13,636
translate it into the

602
00:19:13,636 --> 0:19:15,656
AVFoundation object and set it

603
00:19:15,656 --> 0:19:17,446
on my AVPlayer item to change

604
00:19:17,446 --> 0:19:18,166
the selection.

605
00:19:19,596 --> 0:19:22,056
So once I have this mapping, I

606
00:19:22,056 --> 0:19:23,246
can update that info.

607
00:19:23,746 --> 0:19:25,626
And here, I'm doing that in the

608
00:19:25,626 --> 0:19:26,886
update method for my playback

609
00:19:26,886 --> 0:19:28,666
info, where I've already added

610
00:19:28,666 --> 0:19:31,116
the playback duration and elapse

611
00:19:31,226 --> 0:19:31,586
time.

612
00:19:32,536 --> 0:19:34,466
And to that, I'm going to add

613
00:19:34,466 --> 0:19:36,186
the list of available option

614
00:19:36,186 --> 0:19:38,876
groups and their current

615
00:19:38,876 --> 0:19:39,436
selections.

616
00:19:39,436 --> 0:19:43,026
So now, we have to handle

617
00:19:43,256 --> 0:19:44,696
changes to those selections.

618
00:19:45,336 --> 0:19:48,456
And I can do that in my setup

619
00:19:48,456 --> 0:19:50,466
method for remote controls or

620
00:19:50,466 --> 0:19:51,626
I'll add support for the

621
00:19:51,626 --> 0:19:54,016
enableLanguageOptionCommand.

622
00:19:54,946 --> 0:19:56,626
And this handler is going to

623
00:19:56,626 --> 0:19:58,036
first get the current playback

624
00:19:58,036 --> 0:19:58,306
item.

625
00:19:59,946 --> 0:20:01,406
And then use my mapping to take

626
00:19:59,946 --> 0:20:01,406
And then use my mapping to take

627
00:20:01,406 --> 0:20:02,226
the language option that I

628
00:20:02,226 --> 0:20:05,186
received and translate it to the

629
00:20:05,186 --> 0:20:06,376
AVFoundation objects.

630
00:20:08,636 --> 0:20:10,646
I'll then use AVPlayer items,

631
00:20:11,136 --> 0:20:12,886
select option and group method

632
00:20:13,696 --> 0:20:16,256
to select the new option on the

633
00:20:16,256 --> 0:20:16,896
current item.

634
00:20:17,476 --> 0:20:19,166
And I'll want to update my Now

635
00:20:19,166 --> 0:20:20,536
Playing info and other internal

636
00:20:20,536 --> 0:20:22,216
state and handle that playback

637
00:20:22,216 --> 0:20:22,696
change.

638
00:20:23,266 --> 0:20:27,126
Now, there are some types of

639
00:20:27,126 --> 0:20:28,356
option groups that could have

640
00:20:28,356 --> 0:20:29,166
nothing selected.

641
00:20:29,166 --> 0:20:30,426
For example, turning off

642
00:20:30,426 --> 0:20:31,996
subtitles and closed captions.

643
00:20:32,136 --> 0:20:33,416
And this comes through with the

644
00:20:33,416 --> 0:20:35,176
disableLanguageOptionCommand.

645
00:20:35,176 --> 0:20:35,956
So you want to make sure to

646
00:20:35,956 --> 0:20:37,676
support both the enable and

647
00:20:37,676 --> 0:20:38,796
disable commands.

648
00:20:39,646 --> 0:20:41,036
And the handler is very similar,

649
00:20:41,966 --> 0:20:43,216
first, getting the current item

650
00:20:44,456 --> 0:20:46,326
and using my mapping to find the

651
00:20:46,326 --> 0:20:46,716
group.

652
00:20:47,816 --> 0:20:49,856
But now, I'm going to check if

653
00:20:49,856 --> 0:20:51,086
that group allows empty

654
00:20:51,086 --> 0:20:53,016
selection and make sure that it

655
00:20:53,016 --> 0:20:53,406
can.

656
00:20:53,976 --> 0:20:57,676
And if it does, I'm going to use

657
00:20:57,676 --> 0:20:58,786
the same select method but

658
00:20:58,786 --> 0:21:00,226
passing nil as the option and

659
00:20:58,786 --> 0:21:00,226
passing nil as the option and

660
00:21:00,226 --> 0:21:01,316
this will deselect all the

661
00:21:01,316 --> 0:21:02,326
options in that group.

662
00:21:06,346 --> 0:21:07,676
So I've got a full set of remote

663
00:21:07,676 --> 0:21:09,296
controls that I can support.

664
00:21:09,456 --> 0:21:10,836
When do I register and

665
00:21:10,836 --> 0:21:11,986
deregister for these?

666
00:21:12,286 --> 0:21:13,766
For most video apps, you're

667
00:21:13,766 --> 0:21:15,046
going to register when you have

668
00:21:15,046 --> 0:21:16,746
content to play and that's when

669
00:21:16,746 --> 0:21:19,886
a user selects a video in your

670
00:21:19,886 --> 0:21:20,036
app.

671
00:21:21,136 --> 0:21:22,726
And you also want to deregister

672
00:21:22,726 --> 0:21:23,916
when you have nothing to play.

673
00:21:24,196 --> 0:21:27,116
So, a user exits your video.

674
00:21:27,756 --> 0:21:29,146
And you'll use that opportunity

675
00:21:29,146 --> 0:21:30,226
to also clear out the Now

676
00:21:30,226 --> 0:21:31,506
Playing info dictionary to make

677
00:21:31,506 --> 0:21:33,086
sure that there's no still data

678
00:21:33,086 --> 0:21:33,796
hanging around.

679
00:21:34,426 --> 0:21:37,986
Now, I mentioned that it's not

680
00:21:37,986 --> 0:21:38,986
just about controlling what's

681
00:21:39,236 --> 0:21:40,476
playing from your device but the

682
00:21:40,476 --> 0:21:41,536
devices around you.

683
00:21:42,036 --> 0:21:44,216
So if you have a tvOS app that

684
00:21:44,216 --> 0:21:46,426
you make, try playing some

685
00:21:46,626 --> 0:21:49,076
content on Apple TV and pulling

686
00:21:49,076 --> 0:21:50,976
down Control Center on an iPhone

687
00:21:51,466 --> 0:21:53,146
and target that Apple TV.

688
00:21:53,566 --> 0:21:56,236
See that you're seeing the video

689
00:21:56,236 --> 0:21:57,456
information that you expect and

690
00:21:57,456 --> 0:21:58,556
you're able to control it as you

691
00:21:58,556 --> 0:21:58,976
expect.

692
00:21:59,276 --> 0:22:00,826
The same goes for using Siri to

693
00:21:59,276 --> 0:22:00,826
The same goes for using Siri to

694
00:22:00,826 --> 0:22:01,646
control your TV.

695
00:22:05,336 --> 0:22:07,006
So the examples that I went

696
00:22:07,006 --> 0:22:08,656
through just now are all part of

697
00:22:08,656 --> 0:22:09,816
a sample project that we've made

698
00:22:09,816 --> 0:22:11,156
available associated with this

699
00:22:11,156 --> 0:22:11,496
session.

700
00:22:11,496 --> 0:22:12,656
And I encourage you to check

701
00:22:12,696 --> 0:22:13,706
that out.

702
00:22:16,196 --> 0:22:17,286
All right.

703
00:22:17,286 --> 0:22:18,626
We got high-quality content that

704
00:22:18,626 --> 0:22:19,856
we can get on the TV and we can

705
00:22:19,856 --> 0:22:20,806
control it.

706
00:22:21,136 --> 0:22:22,376
When it's playing on the TV,

707
00:22:22,376 --> 0:22:23,516
it's really nice to be able to

708
00:22:23,516 --> 0:22:25,366
use my phone or my iPad for

709
00:22:25,366 --> 0:22:26,226
other things.

710
00:22:27,086 --> 0:22:29,166
And there are two parts to

711
00:22:29,166 --> 0:22:30,736
supporting a great multitasking

712
00:22:30,736 --> 0:22:31,386
experience.

713
00:22:31,956 --> 0:22:33,026
One is to make sure that your

714
00:22:33,026 --> 0:22:35,256
video keeps on playing while the

715
00:22:35,256 --> 0:22:36,366
user multitasks.

716
00:22:36,796 --> 0:22:38,356
And the other is to make sure

717
00:22:38,356 --> 0:22:40,526
that if there's already video

718
00:22:40,526 --> 0:22:42,396
playing on the TV that your app

719
00:22:42,396 --> 0:22:43,336
and navigating through its UI

720
00:22:43,336 --> 0:22:46,086
doesn't accidentally interrupt

721
00:22:46,186 --> 0:22:47,126
that experience.

722
00:22:48,796 --> 0:22:51,556
So, when I'm watching a video on

723
00:22:51,556 --> 0:22:53,876
my phone, my video app is

724
00:22:53,876 --> 0:22:54,506
usually staying in the

725
00:22:54,506 --> 0:22:56,006
foreground because I need to

726
00:22:56,006 --> 0:22:57,226
look at it on the screen.

727
00:22:57,936 --> 0:23:00,896
But when I'm AirPlaying on the

728
00:22:57,936 --> 0:23:00,896
But when I'm AirPlaying on the

729
00:23:00,996 --> 0:23:02,746
TV, I'm now free to use my

730
00:23:02,746 --> 0:23:04,236
iPhone for other things like

731
00:23:04,236 --> 0:23:06,066
check my messages or mail, or

732
00:23:06,066 --> 0:23:06,766
social media.

733
00:23:10,056 --> 0:23:11,506
If I'm using a video app that

734
00:23:11,506 --> 0:23:13,406
doesn't support background

735
00:23:14,216 --> 0:23:16,346
media, the video is going to

736
00:23:16,346 --> 0:23:17,526
stop the moment I leave that

737
00:23:17,526 --> 0:23:17,806
app.

738
00:23:18,456 --> 0:23:19,686
And so we want to make sure that

739
00:23:19,686 --> 0:23:21,516
your video can continue playing.

740
00:23:22,136 --> 0:23:24,306
And you can do this by

741
00:23:24,306 --> 0:23:26,166
supporting the audio background

742
00:23:26,166 --> 0:23:27,836
mode in your app's Info.plist.

743
00:23:29,376 --> 0:23:30,946
And you'll also configure your

744
00:23:30,946 --> 0:23:32,456
AVAudioSession for background

745
00:23:32,456 --> 0:23:32,966
playback.

746
00:23:33,666 --> 0:23:35,556
For most video apps, that means

747
00:23:35,556 --> 0:23:36,906
using the playback category.

748
00:23:37,106 --> 0:23:38,776
And this provides media

749
00:23:38,926 --> 0:23:41,386
appropriate behaviors in your

750
00:23:41,386 --> 0:23:44,696
app, including playing in the

751
00:23:46,056 --> 0:23:46,416
background.

752
00:23:46,416 --> 0:23:47,786
Another thing about the playback

753
00:23:47,786 --> 0:23:48,786
category devices, it'll

754
00:23:48,786 --> 0:23:49,866
interrupt the other media.

755
00:23:49,996 --> 0:23:51,496
So it's really important to make

756
00:23:51,496 --> 0:23:53,286
sure that you only activate your

757
00:23:53,286 --> 0:23:54,656
audio session when a user

758
00:23:54,886 --> 0:23:56,596
presses play and begins playback

759
00:23:56,776 --> 0:23:58,816
on a primary piece of content in

760
00:23:58,816 --> 0:24:00,676
your app.

761
00:23:58,816 --> 0:24:00,676
your app.

762
00:24:01,046 --> 0:24:02,496
Now, once you go active, you can

763
00:24:02,496 --> 0:24:04,126
stay active.

764
00:24:05,116 --> 0:24:06,976
There's no need to deactivate

765
00:24:06,976 --> 0:24:08,256
your audio session just because

766
00:24:08,256 --> 0:24:12,826
the user paused the video.

767
00:24:13,226 --> 0:24:14,696
Now, media interruptions can

768
00:24:14,696 --> 0:24:16,666
happen at any time.

769
00:24:17,016 --> 0:24:18,916
And so, it's important to listen

770
00:24:18,916 --> 0:24:20,346
to those notifications on

771
00:24:20,346 --> 0:24:21,156
AVAudioSession.

772
00:24:22,046 --> 0:24:23,746
And when an interruption begins,

773
00:24:23,746 --> 0:24:25,466
you update your UI and internal

774
00:24:25,466 --> 0:24:26,056
state.

775
00:24:26,596 --> 0:24:28,426
And when it ends, check the

776
00:24:28,426 --> 0:24:30,456
notifications payload and make

777
00:24:30,456 --> 0:24:32,736
sure that you check the

778
00:24:32,736 --> 0:24:35,566
shouldResume key and honor that

779
00:24:35,566 --> 0:24:36,086
value.

780
00:24:36,576 --> 0:24:38,486
So, only automatically resume

781
00:24:38,486 --> 0:24:40,386
your video if it returns true.

782
00:24:41,006 --> 0:24:43,776
When you have video already

783
00:24:43,826 --> 0:24:45,046
playing on the TV, it's

784
00:24:45,046 --> 0:24:46,986
important to test your app and

785
00:24:46,986 --> 0:24:48,386
launching it, navigating to the

786
00:24:48,386 --> 0:24:49,976
UI and make sure that there's

787
00:24:49,976 --> 0:24:51,156
nothing that accidentally

788
00:24:51,156 --> 0:24:52,606
AirPlays that you didn't expect,

789
00:24:53,086 --> 0:24:54,796
or that it interrupts that

790
00:24:54,796 --> 0:24:56,146
current video experience.

791
00:24:57,216 --> 0:24:59,566
And I like to go over a couple

792
00:24:59,566 --> 0:25:01,106
examples that you might run

793
00:24:59,566 --> 0:25:01,106
examples that you might run

794
00:25:01,666 --> 0:25:01,796
into.

795
00:25:02,436 --> 0:25:04,896
For one, there's sometimes video

796
00:25:04,896 --> 0:25:05,926
that should never AirPlay.

797
00:25:06,186 --> 0:25:09,396
So if I have an animation on app

798
00:25:09,396 --> 0:25:11,406
launch that I achieved using a

799
00:25:11,406 --> 0:25:14,986
video asset, you don't want that

800
00:25:14,986 --> 0:25:16,056
interrupting the current

801
00:25:16,056 --> 0:25:16,906
experience.

802
00:25:17,306 --> 0:25:18,886
The same goes if I have video

803
00:25:18,886 --> 0:25:20,326
assets I use for other types of

804
00:25:20,326 --> 0:25:22,236
visual flourish or to promote

805
00:25:22,236 --> 0:25:24,176
content within my app.

806
00:25:24,526 --> 0:25:25,976
You can make sure that those

807
00:25:25,976 --> 0:25:26,916
videos don't interrupt the

808
00:25:26,916 --> 0:25:27,946
current experience and stay

809
00:25:27,946 --> 0:25:31,386
local on the device by setting

810
00:25:31,386 --> 0:25:33,456
allowsExternalPlayback to false.

811
00:25:33,986 --> 0:25:37,276
Your app should only AirPlay a

812
00:25:37,276 --> 0:25:38,896
video when a user has directly

813
00:25:38,896 --> 0:25:40,416
interacted with that video.

814
00:25:41,016 --> 0:25:46,326
And to that end, you should not

815
00:25:46,786 --> 0:25:48,746
auto-play primary content just

816
00:25:48,746 --> 0:25:50,156
because your app launched or

817
00:25:50,156 --> 0:25:51,266
came into the foreground.

818
00:25:51,866 --> 0:25:54,856
When it comes to media, people

819
00:25:54,856 --> 0:25:56,376
should always be in control of

820
00:25:56,376 --> 0:25:57,606
when playback begins.

821
00:25:58,866 --> 0:25:59,846
And this is really important,

822
00:25:59,846 --> 0:26:01,006
and I want to go over a couple

823
00:25:59,846 --> 0:26:01,006
and I want to go over a couple

824
00:26:01,006 --> 0:26:02,486
examples of why.

825
00:26:03,146 --> 0:26:06,136
So here, I am listening to music

826
00:26:06,136 --> 0:26:08,176
on my iPhone and I have a video

827
00:26:08,176 --> 0:26:10,126
app that supports on-demand

828
00:26:10,126 --> 0:26:11,766
video that I can watch but also

829
00:26:11,766 --> 0:26:13,666
auto-plays a live TV channel

830
00:26:14,356 --> 0:26:15,226
when the app comes to the

831
00:26:15,226 --> 0:26:15,856
foreground.

832
00:26:17,426 --> 0:26:18,566
So if I'm listening to music, I

833
00:26:18,566 --> 0:26:20,346
launch that app, that music is

834
00:26:20,346 --> 0:26:21,956
going to stop and I had no

835
00:26:21,956 --> 0:26:23,426
control over it.

836
00:26:24,216 --> 0:26:25,566
And I might have launched that

837
00:26:25,566 --> 0:26:27,136
app for a purpose other than

838
00:26:27,136 --> 0:26:28,366
watching that live video.

839
00:26:28,996 --> 0:26:32,076
You want to make sure that

840
00:26:32,076 --> 0:26:33,686
people can launch your app

841
00:26:33,686 --> 0:26:36,106
confidently knowing that their

842
00:26:36,106 --> 0:26:37,286
current experience won't get

843
00:26:37,286 --> 0:26:37,956
interrupted.

844
00:26:38,526 --> 0:26:41,046
And I like to call out one more

845
00:26:41,046 --> 0:26:42,306
important example that is new

846
00:26:42,306 --> 0:26:42,846
this year.

847
00:26:45,106 --> 0:26:47,106
For long-form video apps, iOS

848
00:26:47,106 --> 0:26:48,956
can suggest a TV to

849
00:26:48,956 --> 0:26:52,416
automatically play to when the

850
00:26:52,416 --> 0:26:53,316
video begins.

851
00:26:53,816 --> 0:26:55,326
And when this happens, the

852
00:26:55,326 --> 0:26:56,996
system provides a notification

853
00:26:56,996 --> 0:26:59,006
telling the user that the video

854
00:26:59,006 --> 0:27:00,096
will automatically play on the

855
00:26:59,006 --> 0:27:00,096
will automatically play on the

856
00:27:00,096 --> 0:27:00,596
TV.

857
00:27:01,376 --> 0:27:02,726
And people can tap that

858
00:27:02,726 --> 0:27:04,406
notification or the status bar

859
00:27:04,406 --> 0:27:05,966
icon to change that suggested

860
00:27:05,966 --> 0:27:06,746
destination.

861
00:27:07,326 --> 0:27:10,876
Now, if I have an app that

862
00:27:11,246 --> 0:27:13,626
auto-plays its content, it's

863
00:27:13,626 --> 0:27:15,116
possible that that video starts

864
00:27:15,116 --> 0:27:16,786
playing on the TV before I've

865
00:27:16,786 --> 0:27:18,256
had a chance to really see and

866
00:27:18,256 --> 0:27:20,106
interact with that notification.

867
00:27:21,336 --> 0:27:22,446
By requiring to use the action

868
00:27:22,446 --> 0:27:24,896
to begin playback, you can

869
00:27:24,896 --> 0:27:26,726
provide people the power to

870
00:27:26,726 --> 0:27:28,756
decide both when and where they

871
00:27:28,756 --> 0:27:30,376
play their video, and that

872
00:27:30,376 --> 0:27:31,386
creates a great media

873
00:27:31,386 --> 0:27:32,166
experience.

874
00:27:32,236 --> 0:27:34,316
And so, to talk with you more

875
00:27:34,316 --> 0:27:37,116
about long-form video apps and

876
00:27:37,386 --> 0:27:38,596
their integration with

877
00:27:38,596 --> 0:27:39,946
intelligent AirPlay Suggestions,

878
00:27:40,436 --> 0:27:41,496
I'd like to invite up on to the

879
00:27:41,496 --> 0:27:42,746
stage Marty Pye.

880
00:27:43,516 --> 0:27:49,606
[ Applause ]

881
00:27:50,106 --> 0:27:52,496
&gt;&gt; Thank you, Jonathan.

882
00:27:52,696 --> 0:27:53,446
Hello, everyone.

883
00:27:53,486 --> 0:27:54,416
My name is Marty Pye.

884
00:27:54,416 --> 0:27:55,916
I'm an AVKit engineer here at

885
00:27:55,916 --> 0:27:56,196
Apple.

886
00:27:56,816 --> 0:27:58,526
And I'm here today to tell you a

887
00:27:58,526 --> 0:27:59,356
little bit more about the

888
00:27:59,356 --> 0:28:00,536
advanced routing features we

889
00:27:59,356 --> 0:28:00,536
advanced routing features we

890
00:28:00,536 --> 0:28:03,246
built into iOS 13 and how your

891
00:28:03,246 --> 0:28:04,416
long-form video apps can take

892
00:28:04,416 --> 0:28:05,606
advantage of these features.

893
00:28:06,386 --> 0:28:08,376
So first, we'll talk about what

894
00:28:08,376 --> 0:28:10,086
a long-form video app actually

895
00:28:10,186 --> 0:28:10,296
is.

896
00:28:10,956 --> 0:28:12,666
Then I'll talk a bit more about

897
00:28:12,666 --> 0:28:14,396
what these specific routing

898
00:28:14,396 --> 0:28:15,606
behaviors are that we've built

899
00:28:15,606 --> 0:28:16,476
for long-form video apps.

900
00:28:17,066 --> 0:28:18,456
And finally, I'll show you how

901
00:28:18,456 --> 0:28:20,416
to integrate these features into

902
00:28:20,416 --> 0:28:20,906
your code.

903
00:28:22,166 --> 0:28:24,746
So what is a long-form video

904
00:28:25,356 --> 0:28:25,436
app?

905
00:28:25,436 --> 0:28:27,106
As the name suggests, any app

906
00:28:27,156 --> 0:28:28,626
that primarily plays long-form

907
00:28:28,626 --> 0:28:30,306
video content is considered a

908
00:28:30,306 --> 0:28:31,226
long-form video app.

909
00:28:31,336 --> 0:28:32,826
This content includes things

910
00:28:32,826 --> 0:28:35,456
such as movies or the TV type

911
00:28:35,496 --> 0:28:37,806
content like TV shows, sports,

912
00:28:37,806 --> 0:28:38,566
et cetera.

913
00:28:38,936 --> 0:28:41,206
If your app primarily plays

914
00:28:41,586 --> 0:28:44,036
content from social media or

915
00:28:44,036 --> 0:28:45,446
other types of short news clips,

916
00:28:45,666 --> 0:28:47,256
then it would not qualify as

917
00:28:47,256 --> 0:28:48,036
long-form video.

918
00:28:48,596 --> 0:28:51,876
We encourage you to assess your

919
00:28:51,876 --> 0:28:53,456
app holistically to decide in

920
00:28:53,456 --> 0:28:54,996
which category of movie it

921
00:28:54,996 --> 0:28:55,466
belongs.

922
00:28:56,526 --> 0:28:57,916
So once you've decided that your

923
00:28:57,916 --> 0:28:59,956
app is long-form video, how will

924
00:28:59,956 --> 0:29:01,136
the AirPlay routing behavior

925
00:28:59,956 --> 0:29:01,136
the AirPlay routing behavior

926
00:29:01,136 --> 0:29:02,486
differ for such apps?

927
00:29:03,456 --> 0:29:05,106
Let's take a look at an example.

928
00:29:06,996 --> 0:29:09,076
If-- Imagine you're watching a

929
00:29:09,076 --> 0:29:11,006
documentary on banana slugs and

930
00:29:11,006 --> 0:29:12,666
you're AirPlaying this content

931
00:29:12,666 --> 0:29:14,346
from your iPhone to an Apple TV.

932
00:29:15,286 --> 0:29:18,096
New in iOS 13, when your friend

933
00:29:18,096 --> 0:29:20,276
sends you his latest sweet dirt

934
00:29:20,276 --> 0:29:22,026
biking video, you can go ahead

935
00:29:22,026 --> 0:29:23,456
and watch this short content

936
00:29:23,456 --> 0:29:25,366
locally on your device without

937
00:29:25,366 --> 0:29:26,896
interrupting the banana slug

938
00:29:26,896 --> 0:29:28,466
documentary that's playing on

939
00:29:29,036 --> 0:29:31,216
the TV.

940
00:29:31,366 --> 0:29:32,596
Another feature we've built into

941
00:29:32,596 --> 0:29:35,036
iOS 13 is AirPlay Suggestions.

942
00:29:35,956 --> 0:29:38,066
If the user goes to play some

943
00:29:38,066 --> 0:29:39,806
content and the AirPlay routing

944
00:29:39,806 --> 0:29:42,186
system detects a nearby likely

945
00:29:42,186 --> 0:29:44,816
AirPlay device, then the system

946
00:29:44,816 --> 0:29:47,266
may prompt the user and suggest

947
00:29:47,586 --> 0:29:48,886
to AirPlay to this device.

948
00:29:48,886 --> 0:29:50,726
Or, depending on the confidence,

949
00:29:50,866 --> 0:29:52,016
the system might also

950
00:29:52,016 --> 0:29:53,756
automatically route playback to

951
00:29:53,756 --> 0:29:54,436
that device.

952
00:29:55,816 --> 0:29:57,006
So now that you know about these

953
00:29:57,006 --> 0:29:58,856
features, how to take advantage

954
00:29:58,856 --> 0:29:59,976
of them in your app?

955
00:30:00,846 --> 0:30:01,986
Well, there's two things you

956
00:30:01,986 --> 0:30:02,526
need to do.

957
00:30:02,696 --> 0:30:04,206
And the first thing is

958
00:30:04,256 --> 0:30:05,496
registering your app as a

959
00:30:05,496 --> 0:30:06,616
long-form video app.

960
00:30:07,616 --> 0:30:08,596
So how do we do this?

961
00:30:09,456 --> 0:30:10,566
It's really very simple.

962
00:30:11,536 --> 0:30:12,876
All you need to do is add the

963
00:30:12,876 --> 0:30:14,836
AVInitialRouteSharingPolicy key

964
00:30:14,836 --> 0:30:16,796
to your app's Info.plist and set

965
00:30:16,796 --> 0:30:17,956
it to a long-form video.

966
00:30:19,256 --> 0:30:21,046
By setting this on the plist, we

967
00:30:21,046 --> 0:30:22,496
can ensure that your app behaves

968
00:30:22,496 --> 0:30:24,146
like every other long-form video

969
00:30:24,146 --> 0:30:25,846
app on the system before you

970
00:30:25,846 --> 0:30:27,176
create any of your playback

971
00:30:27,176 --> 0:30:28,876
objects and the moment it gets

972
00:30:28,876 --> 0:30:29,366
launched.

973
00:30:33,056 --> 0:30:34,756
Now, the second thing you need

974
00:30:34,756 --> 0:30:36,936
to do in order to leverage the

975
00:30:36,936 --> 0:30:38,656
AirPlay Suggestions is prepare

976
00:30:38,656 --> 0:30:39,916
the routing system prior to

977
00:30:39,916 --> 0:30:40,486
playback.

978
00:30:40,486 --> 0:30:43,016
I'm first going to give you a

979
00:30:43,016 --> 0:30:44,576
little conceptual overview of

980
00:30:44,776 --> 0:30:46,326
how that works, and then we'll

981
00:30:46,326 --> 0:30:48,726
dive into how to achieve it in

982
00:30:51,476 --> 0:30:51,606
code.

983
00:30:51,806 --> 0:30:53,416
So in your app, you most likely

984
00:30:53,416 --> 0:30:54,666
have some sort of browsing UI

985
00:30:54,996 --> 0:30:57,016
where users can scroll through

986
00:30:57,016 --> 0:30:58,266
different pieces of content,

987
00:30:58,806 --> 0:31:00,246
select the piece of content they

988
00:30:58,806 --> 0:31:00,246
select the piece of content they

989
00:31:00,246 --> 0:31:01,646
would like to play, and hit

990
00:31:01,646 --> 0:31:01,876
Play.

991
00:31:02,736 --> 0:31:04,256
Well, it's at this transition

992
00:31:04,256 --> 0:31:06,316
from browsing to actual playback

993
00:31:06,516 --> 0:31:07,996
where you should prepare the

994
00:31:07,996 --> 0:31:09,156
AirPlay routing system.

995
00:31:09,686 --> 0:31:11,316
And what happens when you

996
00:31:11,316 --> 0:31:12,436
prepare the routing system?

997
00:31:13,466 --> 0:31:15,756
Well, it may decide to

998
00:31:16,106 --> 0:31:17,556
automatically play the content

999
00:31:17,556 --> 0:31:19,996
locally on the device or route

1000
00:31:19,996 --> 0:31:21,926
it to an external screen, be it

1001
00:31:21,926 --> 0:31:23,876
via a likely nearby AirPlay

1002
00:31:23,876 --> 0:31:25,446
device, or if you have an

1003
00:31:25,446 --> 0:31:28,046
external screen wired into the

1004
00:31:29,076 --> 0:31:29,236
device.

1005
00:31:29,306 --> 0:31:30,646
However, depending on the level

1006
00:31:30,646 --> 0:31:32,256
of confidence, the system may

1007
00:31:32,256 --> 0:31:34,246
also prompt the user asking

1008
00:31:34,246 --> 0:31:36,506
whether they would like to play

1009
00:31:36,506 --> 0:31:38,006
to a nearby AirPlay device.

1010
00:31:38,936 --> 0:31:41,086
And then depending on the user's

1011
00:31:41,086 --> 0:31:42,416
choice, control will then be

1012
00:31:42,416 --> 0:31:43,826
handed back to your app with

1013
00:31:43,826 --> 0:31:45,196
information about where the

1014
00:31:45,196 --> 0:31:47,916
content is going to play.

1015
00:31:48,936 --> 0:31:50,156
So let's take a look at how to

1016
00:31:50,156 --> 0:31:51,026
do this in code.

1017
00:31:52,346 --> 0:31:55,036
When the user decides to hit

1018
00:31:55,036 --> 0:31:56,696
Play, you should call

1019
00:31:56,696 --> 0:31:58,546
prepareRouteSelectionForPlayback

1020
00:31:58,696 --> 0:32:00,016
on the AVAudioSession.

1021
00:31:58,696 --> 0:32:00,016
on the AVAudioSession.

1022
00:32:00,626 --> 0:32:01,866
And this method takes a

1023
00:32:01,866 --> 0:32:02,706
completion handler.

1024
00:32:04,106 --> 0:32:05,286
Now, this completion handler

1025
00:32:05,286 --> 0:32:06,836
will be called right away if the

1026
00:32:06,836 --> 0:32:08,146
AirPlay can-- if the AirPlay

1027
00:32:08,146 --> 0:32:09,596
routing system can make an

1028
00:32:09,596 --> 0:32:10,646
automatic decision.

1029
00:32:11,636 --> 0:32:13,796
However, there may also be a

1030
00:32:13,796 --> 0:32:15,566
prompt shown asking the user

1031
00:32:16,296 --> 0:32:17,286
whether they would like to play

1032
00:32:17,286 --> 0:32:18,756
to this nearby AirPlay device.

1033
00:32:19,436 --> 0:32:20,776
If the user decides they would

1034
00:32:20,776 --> 0:32:22,416
like to play the content

1035
00:32:22,416 --> 0:32:24,756
locally, then your completion

1036
00:32:24,756 --> 0:32:26,296
handler will be called with

1037
00:32:26,296 --> 0:32:27,796
route selection type local.

1038
00:32:27,796 --> 0:32:30,656
Now, you can go ahead and

1039
00:32:30,656 --> 0:32:31,676
present your playback UI.

1040
00:32:31,676 --> 0:32:32,936
For example,

1041
00:32:32,936 --> 0:32:35,226
AVPlayerViewController, or you

1042
00:32:35,226 --> 0:32:36,736
can present your own custom

1043
00:32:36,736 --> 0:32:37,276
playback UI.

1044
00:32:38,836 --> 0:32:40,736
If the user instead decides they

1045
00:32:40,736 --> 0:32:41,696
would like to AirPlay the

1046
00:32:41,696 --> 0:32:43,456
content and they select the

1047
00:32:43,456 --> 0:32:45,106
living room, then your

1048
00:32:45,106 --> 0:32:46,026
completion handler will be

1049
00:32:46,026 --> 0:32:47,656
called with route selection type

1050
00:32:47,656 --> 0:32:48,256
external.

1051
00:32:49,506 --> 0:32:50,786
And here, you have the

1052
00:32:50,786 --> 0:32:52,536
opportunity to present some sort

1053
00:32:52,536 --> 0:32:54,826
of custom remote playback UI

1054
00:32:55,146 --> 0:32:57,596
with controls dedicated to

1055
00:32:57,596 --> 0:32:58,706
controlling something that's

1056
00:32:58,706 --> 0:33:00,216
playing on an external screen.

1057
00:32:58,706 --> 0:33:00,216
playing on an external screen.

1058
00:33:00,826 --> 0:33:02,176
Lastly, don't forget to handle

1059
00:33:02,176 --> 0:33:03,566
the case that the user decides

1060
00:33:03,906 --> 0:33:05,386
to cancel playback.

1061
00:33:06,296 --> 0:33:08,246
Now, in order to test your app

1062
00:33:08,246 --> 0:33:09,826
and how it behaves in the

1063
00:33:09,826 --> 0:33:12,316
various different scenarios with

1064
00:33:12,316 --> 0:33:14,116
AirPlay Suggestions, we've built

1065
00:33:14,326 --> 0:33:15,786
some toggles into the developer

1066
00:33:15,786 --> 0:33:16,256
settings.

1067
00:33:17,016 --> 0:33:18,736
If you drill down to settings

1068
00:33:18,736 --> 0:33:20,396
developer, you'll find this new

1069
00:33:20,396 --> 0:33:21,846
entry, AirPlay Suggestions.

1070
00:33:23,136 --> 0:33:25,426
And in here, you have the choice

1071
00:33:25,426 --> 0:33:26,716
of three distinct modes.

1072
00:33:28,236 --> 0:33:30,096
The Default mode is just the

1073
00:33:30,096 --> 0:33:31,376
default system behavior.

1074
00:33:32,176 --> 0:33:34,616
You can also select between a

1075
00:33:34,616 --> 0:33:36,926
mode where the system will

1076
00:33:36,926 --> 0:33:38,556
always prompt the user and ask

1077
00:33:39,056 --> 0:33:41,246
whether a content should AirPlay

1078
00:33:41,246 --> 0:33:42,476
to a specific device.

1079
00:33:43,286 --> 0:33:44,716
Or you can force the system into

1080
00:33:44,716 --> 0:33:46,086
a mode where it will always

1081
00:33:46,086 --> 0:33:47,936
automatically route to a

1082
00:33:47,936 --> 0:33:48,756
specific device.

1083
00:33:49,386 --> 0:33:50,946
And you can select which device

1084
00:33:50,946 --> 0:33:53,456
this applies to in the nearby

1085
00:33:53,456 --> 0:33:55,406
list of routes below.

1086
00:33:56,056 --> 0:33:57,716
Once you've forced the system

1087
00:33:57,716 --> 0:33:59,756
into a specific mode, make sure

1088
00:33:59,756 --> 0:34:00,866
that you reset the media

1089
00:33:59,756 --> 0:34:00,866
that you reset the media

1090
00:34:00,866 --> 0:34:01,436
services.

1091
00:34:02,956 --> 0:34:04,166
If you're concerned about

1092
00:34:04,166 --> 0:34:06,026
whether AirPlay Suggestions will

1093
00:34:06,026 --> 0:34:07,806
handle every possible use case

1094
00:34:07,806 --> 0:34:08,906
where your users might want to

1095
00:34:08,906 --> 0:34:11,016
AirPlay, then don't worry.

1096
00:34:11,326 --> 0:34:13,136
At the end of the day, you're

1097
00:34:13,136 --> 0:34:15,085
still fully in control when and

1098
00:34:15,085 --> 0:34:16,786
where things will AirPlay.

1099
00:34:17,406 --> 0:34:20,356
You can always select to change

1100
00:34:20,356 --> 0:34:21,886
which device you're AirPlaying

1101
00:34:21,886 --> 0:34:23,886
to via AVRoutePickerView inside

1102
00:34:23,886 --> 0:34:26,106
of your app via the controls

1103
00:34:26,106 --> 0:34:27,676
inside of AVPlayerViewController

1104
00:34:27,976 --> 0:34:29,386
or via control center.

1105
00:34:31,346 --> 0:34:32,536
These new features just make it

1106
00:34:32,536 --> 0:34:34,835
even easier for your users to

1107
00:34:35,216 --> 0:34:36,795
get your content onto the device

1108
00:34:36,795 --> 0:34:37,556
of their choosing.

1109
00:34:38,416 --> 0:34:39,706
We encourage you to check out

1110
00:34:39,706 --> 0:34:41,755
the associated sample code where

1111
00:34:41,755 --> 0:34:43,456
we demonstrate in a simple test

1112
00:34:43,456 --> 0:34:45,235
app how to integrate the

1113
00:34:45,466 --> 0:34:46,835
behaviors we've described today.

1114
00:34:47,916 --> 0:34:49,036
So what have we learned today?

1115
00:34:49,746 --> 0:34:51,206
We've learned how to integrate

1116
00:34:51,206 --> 0:34:52,396
an AirPlay picker into our app

1117
00:34:52,646 --> 0:34:53,936
via AVRoutePickerView.

1118
00:34:54,906 --> 0:34:57,036
We've learned how to handle and

1119
00:34:57,226 --> 0:34:58,656
register for remote controls

1120
00:34:58,656 --> 0:34:59,526
commands via

1121
00:34:59,526 --> 0:35:01,576
MPRemoteCommandCenter, and how

1122
00:34:59,526 --> 0:35:01,576
MPRemoteCommandCenter, and how

1123
00:35:01,576 --> 0:35:03,606
to populate system UI with

1124
00:35:03,606 --> 0:35:04,416
relevant Now Playing

1125
00:35:04,416 --> 0:35:05,016
information.

1126
00:35:06,736 --> 0:35:07,706
We've learned how to take

1127
00:35:07,706 --> 0:35:08,576
advantage of AirPlay

1128
00:35:08,576 --> 0:35:10,636
multitasking and how to register

1129
00:35:10,636 --> 0:35:11,936
your app as a long-form video

1130
00:35:12,776 --> 0:35:12,846
app.

1131
00:35:13,796 --> 0:35:15,546
And lastly, we've learned how to

1132
00:35:15,546 --> 0:35:17,056
prepare the routing system prior

1133
00:35:17,056 --> 0:35:18,556
to playback in order to fully

1134
00:35:18,556 --> 0:35:19,956
leverage AirPlay Suggestions.

1135
00:35:21,196 --> 0:35:23,246
With that, I would like to thank

1136
00:35:23,246 --> 0:35:24,406
you all for joining us on

1137
00:35:24,406 --> 0:35:25,516
today's session.

1138
00:35:26,136 --> 0:35:28,136
We can't wait to see these new

1139
00:35:28,136 --> 0:35:29,876
AirPlay features integrated into

1140
00:35:29,876 --> 0:35:30,466
your apps.

1141
00:35:31,296 --> 0:35:32,046
Enjoy the rest of the

1142
00:35:32,046 --> 0:35:32,616
conference.

1143
00:35:33,516 --> 0:35:38,500
[ Applause ]
